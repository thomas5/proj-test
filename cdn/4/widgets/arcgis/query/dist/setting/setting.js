System.register(["jimu-core","jimu-for-builder","jimu-ui/advanced/data-source-selector","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-theme","jimu-ui/advanced/resource-selector","jimu-ui/advanced/sql-expression-builder","jimu-ui/basic/sql-expression-runtime","jimu-ui/advanced/expression-builder"],(function(e,t){var a={},i={},l={},s={},n={},o={},r={},c={},u={},d={},p={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.CONSTANTS=e.CONSTANTS,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.React=e.React,a.ReactRedux=e.ReactRedux,a.appConfigUtils=e.appConfigUtils,a.classNames=e.classNames,a.css=e.css,a.dataSourceUtils=e.dataSourceUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.polished=e.polished,a.urlUtils=e.urlUtils},function(e){i.getAppConfigAction=e.getAppConfigAction},function(e){l.DataSourceRemoveWaringReason=e.DataSourceRemoveWaringReason,l.DataSourceRemoveWarningPopup=e.DataSourceRemoveWarningPopup,l.DataSourceSelector=e.DataSourceSelector,l.FieldSelector=e.FieldSelector,l.dataComponentsUtils=e.dataComponentsUtils},function(e){s.Button=e.Button,s.ButtonGroup=e.ButtonGroup,s.Checkbox=e.Checkbox,s.Collapse=e.Collapse,s.Icon=e.Icon,s.Modal=e.Modal,s.ModalBody=e.ModalBody,s.ModalFooter=e.ModalFooter,s.MultiSelect=e.MultiSelect,s.NumericInput=e.NumericInput,s.PanelHeader=e.PanelHeader,s.Popper=e.Popper,s.Select=e.Select,s.Switch=e.Switch,s.TextArea=e.TextArea,s.TextInput=e.TextInput,s.Tooltip=e.Tooltip,s.defaultMessages=e.defaultMessages,s.getFallbackPlacementsModifier=e.getFallbackPlacementsModifier},function(e){n.DirectionSelector=e.DirectionSelector,n.MapWidgetSelector=e.MapWidgetSelector,n.SettingCollapse=e.SettingCollapse,n.SettingRow=e.SettingRow,n.SettingSection=e.SettingSection,n.SidePopper=e.SidePopper},function(e){o.List=e.List,o.TreeItemActionType=e.TreeItemActionType},function(e){r.withTheme=e.withTheme},function(e){c.IconPicker=e.IconPicker},function(e){u.Sort=e.Sort,u.SqlExpressionBuilderPopup=e.SqlExpressionBuilderPopup},function(e){d.getJimuFieldNamesBySqlExpression=e.getJimuFieldNamesBySqlExpression},function(e){p.ExpressionBuilder=e.ExpressionBuilder,p.ExpressionBuilderType=e.ExpressionBuilderType}],execute:function(){e((()=>{var e={34700:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#fff" d="M14.417 0H0v12.888h5.607v-.805H.8V.806h12.815V6.04h.801z"></path><path fill="#fff" fill-rule="evenodd" d="M10.413 14.902a4.37 4.37 0 0 0 2.867-1.067L15.434 16l.566-.57-2.161-2.173c.612-.761.979-1.73.979-2.785 0-2.447-1.973-4.43-4.405-4.43s-4.406 1.983-4.406 4.43 1.973 4.43 4.406 4.43m0-.805c1.99 0 3.604-1.623 3.604-3.625s-1.614-3.625-3.604-3.625c-1.991 0-3.605 1.623-3.605 3.625s1.614 3.625 3.605 3.625" clip-rule="evenodd"></path><path fill="#fff" d="M2.403 2.417h9.611v.805H2.403zM7.209 4.833H2.403v.806h4.806zM2.403 7.25h2.403v.805H2.403zM4.806 9.666H2.403v.806h2.403z"></path></svg>'},33345:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 14"><path fill="#000" d="M7.467 0h1.066v2H7.467zM14.308 2l.755.707-1.509 1.414-.754-.707zM13.867 7H16v1h-2.133zM1.82 2l-.753.707 1.508 1.414.754-.707zM0 7v1h2.133V7z"></path><path fill="#000" fill-rule="evenodd" d="M12.8 7.5c0 1.56-.847 2.935-2.133 3.742V14H5.333v-2.758C4.047 10.435 3.2 9.06 3.2 7.5 3.2 5.015 5.349 3 8 3s4.8 2.015 4.8 4.5m-2.727 2.911-.473.297V13H6.4v-2.292l-.473-.297c-1.004-.63-1.66-1.698-1.66-2.911C4.267 5.567 5.938 4 8 4s3.733 1.567 3.733 3.5c0 1.213-.657 2.282-1.66 2.911" clip-rule="evenodd"></path></svg>'},31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},98427:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15 3.5v9c0 1.933-3.134 3.5-7 3.5s-7-1.567-7-3.5v-9C1 1.567 4.134 0 8 0s7 1.567 7 3.5M2 5.304V6.5C2 7.692 4.615 9 8 9s6-1.308 6-2.5V5.304C12.775 6.32 10.546 7 8 7s-4.775-.68-6-1.696M8 10c2.546 0 4.775-.68 6-1.696V9.5c0 1.192-2.615 2.5-6 2.5s-6-1.308-6-2.5V8.304C3.225 9.32 5.454 10 8 10m6 1.304C12.775 12.32 10.546 13 8 13s-4.775-.68-6-1.696V12.5C2 13.692 4.615 15 8 15s6-1.308 6-2.5zM14 3.5C14 4.692 11.385 6 8 6S2 4.692 2 3.5 4.615 1 8 1s6 1.308 6 2.5" clip-rule="evenodd"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},30655:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .54.54 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.54.54 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},52943:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M4.653 13.854a.485.485 0 0 1 0-.708L10.24 8 4.653 2.854a.485.485 0 0 1 0-.708.54.54 0 0 1 .738 0l5.956 5.5a.485.485 0 0 1 0 .708l-5.956 5.5a.54.54 0 0 1-.738 0" clip-rule="evenodd"></path></svg>'},94064:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M13.854 11.347a.486.486 0 0 1-.708 0L8 5.76l-5.146 5.587a.485.485 0 0 1-.708 0 .54.54 0 0 1 0-.738l5.5-5.956a.485.485 0 0 1 .708 0l5.5 5.956a.54.54 0 0 1 0 .738" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},60846:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m1 0a7 7 0 0 0 7 7 7.01 7.01 0 0 0 7-7A7 7 0 1 0 1 8" clip-rule="evenodd"></path></svg>'},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},42588:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 3.429V16h14V0L6.833 6.857zM14 2v13H2V5.114l4.182 2.51a1.2 1.2 0 0 0 1.398-.118z" clip-rule="evenodd"></path></svg>'},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},2985:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.002 1H14A1 1 0 0 1 15 2.002v11.997A1 1 0 0 1 14 15H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1.002-1M2 14h12V2H2z" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},22167:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M4 4.796 4.796 4 8.02 7.224l3.184-3.184.796.796L8.816 8.02l3.144 3.144-.796.796L8.02 8.816 4.836 12l-.796-.796L7.224 8.02z"></path><path fill="#000" fill-rule="evenodd" d="m0 4 4-4h8l4 4v8l-4 4H4l-4-4zm1 .414L4.414 1h7.172L15 4.414v7.172L11.586 15H4.414L1 11.586z" clip-rule="evenodd"></path></svg>'},5618:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgNjggNjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQo8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iNjAiIGhlaWdodD0iMTUiIHJ4PSIxIiBmaWxsPSIjMjgyODI4Ii8+DQo8cmVjdCB4PSI4IiB5PSI4IiB3aWR0aD0iMTUiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM2QTZBNkEiLz4NCjxyZWN0IHg9IjI1IiB5PSI4IiB3aWR0aD0iMTkiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM1MjUyNTIiLz4NCjxwYXRoIGQ9Ik00IDI0LjEyNzRDNCAyMy41NzUyIDQuNDQ3NzIgMjMuMTI3NCA1IDIzLjEyNzRINDdDNDcuNTUyMyAyMy4xMjc0IDQ4IDIzLjU3NTIgNDggMjQuMTI3NFY2M0M0OCA2My41NTIzIDQ3LjU1MjMgNjQgNDcgNjRINUM0LjQ0NzcxIDY0IDQgNjMuNTUyMyA0IDYzVjI0LjEyNzRaIiBmaWxsPSIjMzYzNjM2Ii8+DQo8cmVjdCB4PSI4IiB5PSIyNiIgd2lkdGg9IjIxIiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBkPSJNNDEuNzA3MSAyNkw0MSAyNi43MDcxTDQyLjQxNDIgMjguMTIxM0w0MSAyOS41MzU1TDQxLjcwNzEgMzAuMjQyNkw0My4xMjEzIDI4LjgyODRMNDQuNTM1NSAzMC4yNDI2TDQ1LjI0MjYgMjkuNTM1NUw0My44Mjg0IDI4LjEyMTNMNDUuMjQyNiAyNi43MDcxTDQ0LjUzNTUgMjZMNDMuMTIxMyAyNy40MTQyTDQxLjcwNzEgMjZaIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSIzNSIgd2lkdGg9IjM2IiBoZWlnaHQ9IjMiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjgiIHk9IjQyIiB3aWR0aD0iMzYiIGhlaWdodD0iMyIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iNDkiIHdpZHRoPSIzNiIgaGVpZ2h0PSIzIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSI1NiIgd2lkdGg9IjI5IiBoZWlnaHQ9IjMiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjQ2IiB5PSI4IiB3aWR0aD0iMTQiIGhlaWdodD0iOCIgcng9IjIiIGZpbGw9IiM1MjUyNTIiLz4NCjwvc3ZnPg0K"},37957:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgNjggNjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQo8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iOCIgaGVpZ2h0PSI4IiByeD0iMiIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZD0iTTQgMTZDNCAxNS40NDc3IDQuNDQ3NzIgMTUgNSAxNUg2M0M2My41NTIzIDE1IDY0IDE1LjQ0NzcgNjQgMTZWNjNDNjQgNjMuNTUyMyA2My41NTIzIDY0IDYzIDY0SDVDNC40NDc3MSA2NCA0IDYzLjU1MjMgNCA2M1YxNloiIGZpbGw9IiMyODI4MjgiLz4NCjxyZWN0IHg9IjgiIHk9IjE5IiB3aWR0aD0iMjEiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGQ9Ik01NS43MDcxIDE5TDU1IDE5LjcwNzFMNTYuNDE0MiAyMS4xMjEzTDU1IDIyLjUzNTVMNTUuNzA3MSAyMy4yNDI2TDU3LjEyMTMgMjEuODI4NEw1OC41MzU1IDIzLjI0MjZMNTkuMjQyNiAyMi41MzU1TDU3LjgyODQgMjEuMTIxM0w1OS4yNDI2IDE5LjcwNzFMNTguNTM1NSAxOUw1Ny4xMjEzIDIwLjQxNDJMNTUuNzA3MSAxOVoiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjgiIHk9IjI5IiB3aWR0aD0iNTIiIGhlaWdodD0iOCIgcng9IjEiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjEwIiB5PSIzMSIgd2lkdGg9IjI2IiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTU2LjY0NjQgMzNMNTUgMzEuMzUzNkw1NS43MDcxIDMwLjY0NjVMNTguMDYwNyAzM0w1NS43MDcxIDM1LjM1MzZMNTUgMzQuNjQ2NUw1Ni42NDY0IDMzWiIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iNDAiIHdpZHRoPSI1MiIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTAiIHk9IjQyIiB3aWR0aD0iMjYiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYuNjQ2NCA0NEw1NSA0Mi4zNTM2TDU1LjcwNzEgNDEuNjQ2NUw1OC4wNjA3IDQ0TDU1LjcwNzEgNDYuMzUzNkw1NSA0NS42NDY1TDU2LjY0NjQgNDRaIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSI1MSIgd2lkdGg9IjUyIiBoZWlnaHQ9IjgiIHJ4PSIxIiBmaWxsPSIjMzYzNjM2Ii8+DQo8cmVjdCB4PSIxMCIgeT0iNTMiIHdpZHRoPSIyNiIgaGVpZ2h0PSI0IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik01Ni42NDY0IDU1TDU1IDUzLjM1MzZMNTUuNzA3MSA1Mi42NDY1TDU4LjA2MDcgNTVMNTUuNzA3MSA1Ny4zNTM2TDU1IDU2LjY0NjVMNTYuNjQ2NCA1NVoiIGZpbGw9IiM1MjUyNTIiLz4NCjwvc3ZnPg0K"},7680:e=>{e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgd2lkdGg9IjY4IiBoZWlnaHQ9IjY4IiB2aWV3Qm94PSIwIDAgNjggNjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQo8cmVjdCB4PSI0IiB5PSI0IiB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHJ4PSIxIiBmaWxsPSIjMjgyODI4Ii8+DQo8cmVjdCB4PSI4IiB5PSI4IiB3aWR0aD0iNTIiIGhlaWdodD0iOCIgcng9IjEiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjEwIiB5PSIxMCIgd2lkdGg9IjI2IiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTU2LjY0NjQgMTJMNTUgMTAuMzUzNkw1NS43MDcxIDkuNjQ2NDhMNTguMDYwNyAxMkw1NS43MDcxIDE0LjM1MzZMNTUgMTMuNjQ2NUw1Ni42NDY0IDEyWiIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iMTkiIHdpZHRoPSI1MiIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTAiIHk9IjIxIiB3aWR0aD0iMjYiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYuNjQ2NCAyM0w1NSAyMS4zNTM2TDU1LjcwNzEgMjAuNjQ2NUw1OC4wNjA3IDIzTDU1LjcwNzEgMjUuMzUzNkw1NSAyNC42NDY1TDU2LjY0NjQgMjNaIiBmaWxsPSIjNTI1MjUyIi8+DQo8cmVjdCB4PSI4IiB5PSIzMCIgd2lkdGg9IjUyIiBoZWlnaHQ9IjgiIHJ4PSIxIiBmaWxsPSIjMzYzNjM2Ii8+DQo8cmVjdCB4PSIxMCIgeT0iMzIiIHdpZHRoPSIyNiIgaGVpZ2h0PSI0IiByeD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik01Ni42NDY0IDM0TDU1IDMyLjM1MzZMNTUuNzA3MSAzMS42NDY1TDU4LjA2MDcgMzRMNTUuNzA3MSAzNi4zNTM2TDU1IDM1LjY0NjVMNTYuNjQ2NCAzNFoiIGZpbGw9IiM1MjUyNTIiLz4NCjxyZWN0IHg9IjgiIHk9IjQxIiB3aWR0aD0iNTIiIGhlaWdodD0iOCIgcng9IjEiIGZpbGw9IiMzNjM2MzYiLz4NCjxyZWN0IHg9IjEwIiB5PSI0MyIgd2lkdGg9IjI2IiBoZWlnaHQ9IjQiIHJ4PSIxIiBmaWxsPSIjNkE2QTZBIi8+DQo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTU2LjY0NjQgNDVMNTUgNDMuMzUzNkw1NS43MDcxIDQyLjY0NjVMNTguMDYwNyA0NUw1NS43MDcxIDQ3LjM1MzZMNTUgNDYuNjQ2NUw1Ni42NDY0IDQ1WiIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iOCIgeT0iNTIiIHdpZHRoPSI1MiIgaGVpZ2h0PSI4IiByeD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTAiIHk9IjU0IiB3aWR0aD0iMjYiIGhlaWdodD0iNCIgcng9IjEiIGZpbGw9IiM2QTZBNkEiLz4NCjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNNTYuNjQ2NCA1Nkw1NSA1NC4zNTM2TDU1LjcwNzEgNTMuNjQ2NUw1OC4wNjA3IDU2TDU1LjcwNzEgNTguMzUzNkw1NSA1Ny42NDY1TDU2LjY0NjQgNTZaIiBmaWxsPSIjNTI1MjUyIi8+DQo8L3N2Zz4NCg=="},79244:e=>{"use strict";e.exports=a},4108:e=>{"use strict";e.exports=i},1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=s},13089:e=>{"use strict";e.exports=l},84845:e=>{"use strict";e.exports=p},35809:e=>{"use strict";e.exports=c},79298:e=>{"use strict";e.exports=n},71442:e=>{"use strict";e.exports=u},98640:e=>{"use strict";e.exports=o},76117:e=>{"use strict";e.exports=d}},t={};function g(a){var i=t[a];if(void 0!==i)return i.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,g),l.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var a in t)g.o(t,a)&&!g.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var m={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(m),g.d(m,{__set_webpack_public_path__:()=>$e,default:()=>Je});var e,t,a,i,l,s=g(79244),n=g(4108),o=g(13089),r=g(14321),c=g(79298);!function(e){e.Point="Point",e.Polyline="Polyline",e.Polygon="Polygon",e.Rectangle="Rectangle",e.Circle="Circle"}(e||(e={})),function(e){e.NewSelection="NEW_SELECTION",e.AddToSelection="ADD_TO_CURRENT_SELECTION",e.RemoveFromSelection="REMOVE_FROM_CURRENT_SELECTION",e.SubsetSelection="SUBSET_FROM_CURRENT_SELECTION",e.SwitchSelction="SWITCH_CURRENT_SELECTION"}(t||(t={})),function(e){e.Block="BLOCK",e.Inline="INLINE",e.Popper="POPPER"}(a||(a={})),function(e){e.CurrentMapExtent="CurrentMapExtent",e.InteractiveDrawMode="InteractiveDrawMode",e.None=""}(i||(i={})),function(e){e.Intersect="intersects",e.Contain="contains",e.Cross="crosses",e.EnvelopeIntersect="envelope-intersects",e.IndexIntersect="index-intersects",e.Overlap="overlaps",e.Touch="touches",e.Within="within"}(l||(l={}));l.Intersect,l.Contain,l.Cross,l.EnvelopeIntersect,l.IndexIntersect,l.Overlap,l.Touch,l.Within;var u;!function(e){e.Miles="Miles",e.Kilometers="Kilometers",e.Feet="Feet",e.Meters="Meters",e.NauticalMiles="NauticalMiles"}(u||(u={}));u.Miles,u.Kilometers,u.Feet,u.Meters,u.NauticalMiles;var d,p,I,S,y,v;!function(e){e.Horizontal="Horizontal",e.Vertical="Vertical"}(d||(d={})),function(e){e.MultiPage="MultiPage",e.LazyLoad="LazyLoad"}(p||(p={})),function(e){e.PopupSetting="PopupSetting",e.SelectAttributes="SelectAttributes"}(I||(I={})),function(e){e.Asc="Asc",e.Desc="Desc"}(S||(S={})),function(e){e.Single="Single",e.Multiple="Multiple"}(y||(y={})),function(e){e.DefaultSymbol="DefaultSymbol",e.CustomSymbol="CustomSymbol"}(v||(v={}));const h={queryItem:"Query item",outputDsLabel:"{label} result",addNewQueryAndCustomOptions:"Add new query and custom options.",newQuery:"New query",newFilterLayer:"Add filter layer",arrangementStyle:"Arrangement style",wrapItems:"Wrap items",setQuery:"Set query",attributeFilter:"Attribute filter",addSQLExpressionsToYourQuery:"Add SQL expressions to your query",pleaseAddYourSQLExpressionsFirst:"Please add your SQL expressions first.",spatialFilter:"Spatial filter",mapRequirement_MapNotRequired:"Map widget not required ",mapRequirement_MapIsRequired:"Requires a Map widget",typesOfFilter:"Filter by",featureFromDs:"Selected features from data source",featureFromMap:"Geometries from a map",selectionViewOnly:"Support selected features view only",geometryTypes:"Geometry types",spatialFilterType_CurrentMapExtent:"Current map extent",spatialFilterType_InteractiveDrawMode:"Drawn graphic",spatialFilterType_SpatialRelationship:"Use other layers",results:"Results",listDirection:"List direction",pagingStyle:"Paging Style",pagingStyle_MultiPage:"Multipage",pagingStyle_LazyLoad:"Single-page",field_PopupSetting:"Use webmap settings",field_SelectAttributes:"Customize",selectDisplayFields:"Select fields to display ",symbolType_DefaultSymbol:"Default",symbolType_CustomSymbol:"Custom",allowToChangeSymbolAtRuntime:"Allow to change symbol at runtime",allowToExport:"Allow to export",interactiveDrawMode:"Interactive draw mode",chooseSelectionTools:"Tools",sketchTool_point:"Point",sketchTool_polyline:"Line",sketchTool_polygon:"Polygon",sketchTool_rectangle:"Rectangle",sketchTool_circle:"Circle",spatialRelationship:"Spatial relationship",chooseSpatialRelationshipRules:"Spatial relationship rules",enableSelectTool:"Enable select tool",queryMessage:"Message",atLeastOneItemIsRequired:"At least one item is required.",configureQuery:"Configure query",hintQueryArgumentsSetting:"A query can have an attribute filter, spatial filter, or both.",noQueryTip:'Click the "{newQuery}" button to add and configure queries.',openTip:"Open tip",expressionBuilder:"Expression Builder",chooseMode:"Configure each record",configTitle:"Heading",configFields:"Display fields",resultStyle:"Result style",sortRecords:"Sort records",describeTheFilter:"Please describe the filter.",expandByDefault:"Expand by default",defaultPageSize:"Number of records per page"},j=(e,t=[])=>t.includes(e)?t.filter((t=>t!==e)):[...t,e];const f=e=>e?e.type===s.DataSourceTypes.SceneLayer||e.type===s.DataSourceTypes.BuildingComponentSubLayer?e.getAssociatedDataSource():e:null;var x=g(98640),b=g(1888);const{useState:N}=s.React;(0,b.withTheme)((e=>{const{theme:t,panelVisible:a,setPanelVisible:i,getI18nMessage:l,isModal:n=!0,title:o=l("queryMessage"),bodyContent:c="",hasHeader:u=!0,hasFooter:d=!0}=e,p=()=>{i(!1)},g=()=>(0,s.jsx)(s.React.Fragment,null,u&&(0,s.jsx)(r.PanelHeader,{className:"py-2",title:o,onClose:p}),(0,s.jsx)(r.ModalBody,null,c),d&&(0,s.jsx)(r.ModalFooter,null,(0,s.jsx)(r.Button,{onClick:p},l("ok")))),m="ui-unit-dialog-panel";return n?(0,s.jsx)(r.Modal,{className:`${m}`,isOpen:a,toggle:p,backdrop:"static"},g()):(0,s.jsx)("div",{className:`${m} modal-dialog ${a?"":"collapse"}`,css:s.css`
      &.ui-unit-dialog-panel.modal-dialog {
        margin: 0;
        width: 100%;
        .modal-content {
          background-color: ${t.ref.palette.neutral[600]};
          color: ${t.ref.palette.black};
          font-size: .75rem;
          font-weight: 400;
          border: none;
          .panel-header {
            font-size: .8125rem;
            padding: .625rem;
          }
          .modal-body {
            padding: 0 .625rem .75rem;
            white-space: normal;
          }
        }
      }
    `},(0,s.jsx)("div",{className:"modal-content"},g()))}));var w;!function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(w||(w={}));const D=(0,b.withTheme)((e=>{const{theme:t,className:a,title:i,statusType:l}=e;return l&&(0,s.jsx)("div",{className:`${null!=a?a:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${l}`,title:i,css:s.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(o=null===(n=null==t?void 0:t.ref.palette)||void 0===n?void 0:n.neutral)||void 0===o?void 0:o[500]};
          border-radius: 50%;
          border-top: 1px solid ${null===(c=null===(r=null==t?void 0:t.sys.color)||void 0===r?void 0:r.primary)||void 0===c?void 0:c.main};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var n,o,r,c}));var M=g(28996),T=g.n(M),C=g(22167),R=g.n(C);function O(e){const{widgetId:t,useDataSourceId:a}=e;return s.ReactRedux.useSelector((e=>{var i;let l;l=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(i=l.widgets[t].useDataSources)&&void 0!==i?i:[]).some((e=>e.dataSourceId===a))}))}function z(e){var t,a,i;const{widgetId:l,useDataSource:n,onStatusChange:o,onDataSourceCreated:c,showMessage:u=!1}=e,d=s.hooks.useTranslation(r.defaultMessages),p=O({widgetId:l,useDataSourceId:n.dataSourceId}),[g,m]=s.React.useState(null),[I,S]=s.React.useState(null),y=s.React.useCallback((e=>{if(e){const{status:t,instanceStatus:a}=e;a===s.DataSourceStatus.NotCreated?(m("creating"),null==o||o(!1)):a===s.DataSourceStatus.CreateError||t===s.DataSourceStatus.LoadError?(m("error"),null==o||o(!1)):t===s.DataSourceStatus.NotReady?(m("warning"),null==o||o(!1)):(m(null),null==o||o(!0))}}),[o]),v=s.React.useCallback((e=>{S(e),null==c||c(e)}),[c]),h=s.React.useCallback((()=>{S(null),m("error"),null==o||o(!1)}),[o]);let j,f,x;if("creating"===g)j=R(),f=d("loading");else if(p&&"error"!==g){if("warning"===g){let e="";const l=null===(t=null==I?void 0:I.getOriginDataSources())||void 0===t?void 0:t[0];l?e=l.getLabel()||l.getDataSourceJson().sourceLabel:I&&(e=I.getLabel()||I.getDataSourceJson().label);const o=s.appConfigUtils.getWidgetIdByOutputDataSource(n),r=null===(i=((null===(a=null===window||void 0===window?void 0:window.jimuConfig)||void 0===a?void 0:a.isBuilder)?(0,s.getAppStore)().getState().appStateInBuilder:(0,s.getAppStore)().getState()).appConfig.widgets[o])||void 0===i?void 0:i.label;x="var(--warning-700)",j=T(),f=d("outputDataIsNotGenerated",{outputDsLabel:null!=e?e:"",sourceWidgetName:null!=r?r:""})}}else j=R(),f=d("dataSourceCreateError"),x="var(--danger-500)";return(0,s.jsx)(s.React.Fragment,null,p&&(0,s.jsx)(s.DataSourceComponent,{useDataSource:n,onDataSourceInfoChange:y,onDataSourceCreated:v,onCreateDataSourceFailed:h}),"creating"===g&&(0,s.jsx)(D,{statusType:w.Loading,title:f}),(!p||"error"===g||"warning"===g)&&(0,s.jsx)("div",{className:"d-flex align-items-center"},(0,s.jsx)(r.Tooltip,{title:f},(0,s.jsx)(r.Button,{size:"sm",type:"tertiary",icon:!0},(0,s.jsx)(r.Icon,{icon:j,color:x}))),u&&(0,s.jsx)("div",{className:"status-message"},f)))}var P=g(62838),A=g.n(P),B=g(23662),L=g.n(B),Q=g(93303),k=g.n(Q),E=g(30655),U=g.n(E),Z=g(94064),F=g.n(Z),W=g(96300),G=g.n(W),V=g(52943),H=g.n(V),q=g(31027),Y=g.n(q);const _={iconQuery:g(34700),iconTipBulb:g(33345),iconClose:A(),iconAdd:L(),iconSetting:k(),arrowDown:U(),arrowUp:F(),arrowLeft:G(),arrowRight:H(),iconEmpty:Y()},J={iconMap:_,iconPropMap:{defaultIconResult:{svg:_.iconQuery,properties:{color:"",filename:"filter-16.svg",originalName:"filter-16.svg",inlineSvg:!0,path:["general","filter"],size:14}}},arrangementStyleMap:{[a.Block]:{getTitle:e=>e("vertical"),icon:g(7680)},[a.Inline]:{getTitle:e=>e("horizontal"),icon:g(5618)},[a.Popper]:{getTitle:e=>e("icon"),icon:g(37957)}}};var $=g(35809),K=g(71442),X=g(76117);const ee={icon:null,displayLabel:!0,sqlExprObj:null,useAttributeFilter:!0,useSpatialFilter:!0,spatialMapWidgetIds:[],spatialFilterTypes:[],spatialInteractiveCreateToolTypes:[e.Point,e.Polyline,e.Polygon,e.Rectangle,e.Circle],spatialInteractiveEnableBuffer:!1,spatialInteractiveBufferDistance:0,spatialInteractiveBufferUnit:u.Meters,spatialRelations:[l.Intersect],spatialRelationUseDataSources:[],spatialRelationEnableSelectTool:!1,spatialRelationEnableBuffer:!1,spatialRelationBufferDistance:0,spatialRelationBufferUnit:u.Meters,resultListDirection:d.Vertical,resultPagingStyle:p.MultiPage,resultFieldsType:I.PopupSetting,resultSymbolType:v.DefaultSymbol,resultCustomSymbol:{angle:0,color:[255,255,255,255],outline:{color:[255,255,255,255],style:"esriSLSSolid",type:"esriSLS",width:1},size:6,style:"esriSMSCircle",type:"esriSMS",xoffset:0,yoffset:0},resultAllowChangeSymbol:!1,allowExport:!1,sortOptions:[],itemSizeMap:{arrangementHorizontalPopper:{minSize:{width:300,height:300},defaultSize:{width:360,height:480}}}};function te(e){const{enabled:t,label:a,onChange:i}=e,l=s.hooks.useTranslation(h);return(0,s.jsx)("div",{className:"d-flex align-items-center"},(0,s.jsx)("div",{className:"text-break text-wrap d-inline",css:s.css`width: 184px; padding-right: 16px`},l(a)),(0,s.jsx)("div",{className:"ml-auto"},(0,s.jsx)(r.Switch,{checked:t,onChange:i})))}function ae(e){var t,a,i,l;const{queryItem:n,onQueryItemChanged:o,onPropertyChanged:u}=e,[d,p]=s.React.useState(!1),g=s.hooks.useTranslation(h),m=Object.assign({},ee,n),I=m.useAttributeFilter,S=null!=(null===(t=m.useDataSource)||void 0===t?void 0:t.dataSourceId),y=s.DataSourceManager.getInstance().getDataSource(null===(a=m.useDataSource)||void 0===a?void 0:a.dataSourceId),[v,j]=s.React.useState(null!==(i=m.attributeFilterLabel)&&void 0!==i?i:g("attributeFilter")),[f,x]=s.React.useState(m.attributeFilterDesc);s.React.useEffect((()=>{var e,t;j(null!==(e=null==n?void 0:n.attributeFilterLabel)&&void 0!==e?e:g("attributeFilter")),x(null!==(t=null==n?void 0:n.attributeFilterDesc)&&void 0!==t?t:"")}),[n,g]);const b=s.React.useCallback((()=>{p(!0)}),[p]),N=s.React.useCallback((()=>{p(!1)}),[p]),w=e=>{var t;const{dataSourceId:a,mainDataSourceId:i,dataViewId:l,rootDataSourceId:r}=n.useDataSource,c=(null===(t=null==e?void 0:e.parts)||void 0===t?void 0:t.length)>0?e:null;let u=n.set("sqlExprObj",c);const d={dataSourceId:a,mainDataSourceId:i,dataViewId:l,rootDataSourceId:r,fields:(0,X.getJimuFieldNamesBySqlExpression)((0,s.Immutable)(c))};u=u.set("useDataSource",d),o(u,!0)},D=(0,s.jsx)(te,{label:"attributeFilter",enabled:I,onChange:e=>{u("useAttributeFilter",e.target.checked)}});return(0,s.jsx)(c.SettingSection,{role:"group","aria-label":g("attributeFilter"),title:D},(0,s.jsx)(r.Collapse,{isOpen:I},(0,s.jsx)(c.SettingRow,{flow:"wrap",label:g("label")},(0,s.jsx)(r.TextInput,{"aria-label":g("label"),className:"w-100",size:"sm",value:v,onChange:e=>{j(e.target.value)},onAcceptValue:e=>{((e,t,a)=>{u(e,t===a?null:t)})("attributeFilterLabel",e,g("attributeFilter"))}})),(0,s.jsx)(c.SettingRow,{flow:"wrap",truncateLabel:!0,label:g("addSQLExpressionsToYourQuery")},(0,s.jsx)(r.Button,{className:"w-100 text-default set-link-btn",type:S?"primary":"secondary",disabled:!S,onClick:b},g("sqlExpressionBuilder"))),(0,s.jsx)(c.SettingRow,null,(0,s.jsx)(r.TextArea,{css:s.css`
              flex: 1;
            `,height:80,value:null!==(l=s.dataSourceUtils.getArcGISSQL(m.sqlExprObj,y).displaySQL)&&void 0!==l?l:"",spellCheck:!1,readOnly:!0,onClick:e=>{e.currentTarget.select()},placeholder:g("pleaseAddYourSQLExpressionsFirst")})),(0,s.jsx)(c.SettingRow,{label:g("description"),flow:"wrap"},(0,s.jsx)(r.TextArea,{"aria-label":g("description"),height:80,value:f,placeholder:g("describeTheFilter"),onChange:e=>{x(e.target.value)},onAcceptValue:e=>{u("attributeFilterDesc",e)}}))),(0,s.jsx)(s.DataSourceComponent,{useDataSource:m.useDataSource},(e=>{if(m.sqlExprObj){const t=s.dataSourceUtils.getArcGISSQL(m.sqlExprObj,e);t.displaySQL!==m.sqlExprObj.displaySQL&&w(Object.assign({},m.sqlExprObj,t))}return(0,s.jsx)(K.SqlExpressionBuilderPopup,{dataSource:e,isOpen:d,toggle:N,expression:m.sqlExprObj,onChange:e=>{w(e)}})})))}const{iconMap:ie}=J;function le(e){var t;const{queryItem:a,handleStageChange:i,onPropertyChanged:l}=e,n=Object.assign({},ee,a),o=s.hooks.useTranslation(h),u=n.useSpatialFilter,[d,p]=s.React.useState(null!==(t=n.spatialFilterLabel)&&void 0!==t?t:o("spatialFilter")),[g,m]=s.React.useState(n.spatialFilterDesc);s.React.useEffect((()=>{var e,t;p(null!==(e=null==a?void 0:a.spatialFilterLabel)&&void 0!==e?e:o("spatialFilter")),m(null!==(t=null==a?void 0:a.spatialFilterDesc)&&void 0!==t?t:"")}),[a,o]);const I=(0,s.jsx)(te,{label:"spatialFilter",enabled:u,onChange:e=>{l("useSpatialFilter",e.target.checked)}});return(0,s.jsx)(s.DataSourceComponent,{useDataSource:n.useDataSource},(e=>null==e.getGeometryType()?null:(0,s.jsx)(c.SettingSection,{role:"group","aria-label":o("spatialFilter"),title:I},(0,s.jsx)(r.Collapse,{isOpen:u},(0,s.jsx)(c.SettingRow,{flow:"wrap",label:o("label")},(0,s.jsx)(r.TextInput,{"aria-label":o("label"),className:"w-100",size:"sm",value:d,onChange:e=>{p(e.target.value)},onAcceptValue:e=>{((e,t,a)=>{l(e,t===a?null:t)})("spatialFilterLabel",e,o("spatialFilter"))}})),(0,s.jsx)(c.SettingRow,{role:"group","aria-label":o("typesOfFilter"),flow:"wrap",label:o("typesOfFilter")},(0,s.jsx)("div",{className:"setting-ui-unit-check-input-item w-100 d-flex align-items-center"},(0,s.jsx)("label",{className:"setting-ui-unit-check-input-label my-1"},(0,s.jsx)("span",{id:"queryItemDataMode"},o("featureFromDs"))),(0,s.jsx)(r.Button,{"aria-describedby":"queryItemDataMode",className:"ml-auto",size:"sm",type:"tertiary",icon:!0,onClick:e=>{i(2,e)}},(0,s.jsx)(r.Icon,{size:16,icon:ie.arrowRight,autoFlip:!0}))),(0,s.jsx)("div",{className:"setting-ui-unit-check-input-item w-100 d-flex align-items-center"},(0,s.jsx)("label",{className:"setting-ui-unit-check-input-label my-1"},(0,s.jsx)("span",{id:"queryItemMapMode"},o("featureFromMap"))),(0,s.jsx)(r.Button,{"aria-describedby":"queryItemMapMode",className:"ml-auto",size:"sm",type:"tertiary",icon:!0,onClick:e=>{i(1,e)}},(0,s.jsx)(r.Icon,{size:16,icon:ie.arrowRight,autoFlip:!0})))),(0,s.jsx)(c.SettingRow,{label:o("description"),flow:"wrap"},(0,s.jsx)(r.TextArea,{"aria-label":o("description"),height:80,value:g,placeholder:o("describeTheFilter"),onChange:e=>{m(e.target.value)},onAcceptValue:e=>{l("spatialFilterDesc",e)}}))))))}var se=g(84845);const ne={overrideItemBlockInfo:()=>({name:x.TreeItemActionType.RenderOverrideItem,children:[{name:x.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:x.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:x.TreeItemActionType.RenderOverrideItemBody,children:[{name:x.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:x.TreeItemActionType.RenderOverrideItemDragHandle},{name:x.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:x.TreeItemActionType.RenderOverrideItemTitle},{name:x.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};const oe=(0,b.withTheme)((function(e){const{useDataSource:t,selectedFields:a,label:i,theme:l,onFieldsChanged:n}=e,r=s.React.useMemo((()=>(0,s.Immutable)([t])),[t]),u=s.React.useMemo((()=>{const e=s.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);if(!e)return[];const a=null==e?void 0:e.getSchema();return(null==a?void 0:a.fields)?Object.values(a.fields):[]}),[t]),d=s.React.useMemo((()=>{var e,a,i,l,n,o;const r=s.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);if(r){const t=r,s=null===(a=null===(e=t.layer)||void 0===e?void 0:e.popupTemplate)||void 0===a?void 0:a.content;let c=null!==(n=null===(l=null===(i=t.layer)||void 0===i?void 0:i.popupTemplate)||void 0===l?void 0:l.fieldInfos)&&void 0!==n?n:[];(null==s?void 0:s.length)>0&&"fields"===s[0].type&&(c=null!==(o=s[0].fieldInfos)&&void 0!==o?o:[]);const d=c.map((e=>e.fieldName));return u.filter((e=>null==d?void 0:d.includes(e.name)))}return[]}),[t,u]),p=s.React.useMemo((()=>null!=a?a.map((e=>u.find((t=>t.jimuName===e)))):d),[d,u,a]),g=null!=a?a:d.map((e=>e.jimuName));return(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(c.SettingRow,{flow:"wrap",label:i},(0,s.jsx)(o.FieldSelector,{useDataSources:r,onChange:e=>{if(e){const t=e.filter((e=>e)).map((e=>e.jimuName)),i=null!=a?a.filter((e=>t.includes(e))):t,l=null!=a?t.filter((e=>!a.includes(e))):[];n(i.concat(l))}},selectedFields:(0,s.Immutable)(g),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),g.length>1&&(0,s.jsx)(c.SettingRow,null,(0,s.jsx)(x.List,Object.assign({className:"selected-fields-list w-100",itemsJson:Array.from(p).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateIcon:o.dataComponentsUtils.getIconFromFieldType(e.type,l),itemStateTitle:e.alias||e.jimuName||e.name,itemStateCommands:[]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a,l=i.map((e=>e.itemStateDetailContent));n(l.map((e=>e.jimuName)))}},ne))))}));var re=g(98427),ce=g.n(re),ue=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const de=e=>{const t=window.SVG,{className:a}=e,i=ue(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:ce()},i)):s.React.createElement("svg",Object.assign({className:l},i))},pe=[{name:"preventOverflow",options:{altAxis:!0}},(0,r.getFallbackPlacementsModifier)(["left-start","left-end"],!0)];function ge(e){var t,a,i;const{widgetId:l,queryItem:n,onQueryItemChanged:o,onPropertyChanged:u}=e,[d,p]=s.React.useState(!1),[g,m]=s.React.useState(!1),S=s.React.useRef(),v=s.React.useRef(),j=s.hooks.useTranslation(h),[f,x]=s.React.useState(n.resultTitleExpression),b=Object.assign({},ee,n),N=s.React.useCallback((()=>{p(!0)}),[p]),w=s.React.useCallback((()=>{p(!1)}),[p]),D=s.React.useCallback((()=>{var e;!g&&v.current&&(null===(e=v.current)||void 0===e||e.focus()),m(!g)}),[g]),M=s.hooks.useEventCallback((e=>{x(e.target.value)})),T=s.hooks.useEventCallback((e=>{u("resultTitleExpression",e,!0)})),C=s.hooks.useEventCallback((e=>{var t;e.parts.length>0&&(x(null!=f?`${f} {${e.parts[0].jimuFieldName}}`:`{${e.parts[0].jimuFieldName}}`),null===(t=v.current)||void 0===t||t.focus())}));return(0,s.jsx)(c.SettingCollapse,{role:"group","aria-label":j("results"),label:j("results"),className:"p-4",isOpen:d,onRequestOpen:N,onRequestClose:w},(0,s.jsx)(c.SettingRow,{flow:"wrap",label:j("label")},(0,s.jsx)(r.TextInput,{"aria-label":j("label"),className:"w-100",size:"sm",value:null!==(t=b.resultsLabel)&&void 0!==t?t:j("results"),onChange:e=>{var t,a,i;t="resultsLabel",a=e.target.value,i=j("results"),u(t,a===i?null:a)}})),(0,s.jsx)(c.SettingRow,{flow:"wrap",label:j("selectMode")},(0,s.jsx)(r.Select,{"aria-label":j("selectMode"),className:"w-100",size:"sm",value:null!==(a=b.resultSelectMode)&&void 0!==a?a:y.Single,onChange:e=>{u("resultSelectMode",e.target.value,!1)}},(0,s.jsx)("option",{value:y.Single},j("single")),(0,s.jsx)("option",{value:y.Multiple},j("multiple")))),(0,s.jsx)(c.SettingRow,{flow:"wrap",label:j("chooseMode")},(0,s.jsx)(r.Select,{"aria-label":j("chooseMode"),className:"w-100",size:"sm",value:b.resultFieldsType,onChange:e=>{u("resultFieldsType",e.target.value,!0)}},(0,s.jsx)("option",{value:I.PopupSetting},j("field_PopupSetting")),(0,s.jsx)("option",{value:I.SelectAttributes},j("field_SelectAttributes")))),(0,s.jsx)(c.SettingRow,null,(0,s.jsx)("label",null,(0,s.jsx)(r.Checkbox,{className:"mr-2",checked:null!==(i=b.resultExpandByDefault)&&void 0!==i&&i,onChange:(e,t)=>{u("resultExpandByDefault",t)}}),(0,s.jsx)("span",null,j("expandByDefault")))),b.resultFieldsType===I.SelectAttributes&&(0,s.jsx)(c.SettingRow,{flow:"wrap",label:j("configTitle")},(0,s.jsx)(r.TextArea,{"aria-label":j("configTitle"),className:"mt-2 w-100",css:s.css`
              background-color: var(--ref-palette-neutral-300);
              z-index: 1;
            `,height:80,onChange:M,onAcceptValue:T,spellCheck:!1,value:f,ref:v}),(0,s.jsx)("div",{className:"w-100",css:s.css`height: 32px; background-color: var(--ref-palette-neutral-300);`},(0,s.jsx)(r.Button,{"aria-label":j("configTitle"),ref:S,onClick:D,type:"tertiary",icon:!0},(0,s.jsx)(de,{size:"s"}))),(0,s.jsx)(r.Popper,{open:g,disableResize:!0,placement:"left-start",reference:S.current,modifiers:pe,showArrow:!0,toggle:()=>{m(!1)},trapFocus:!1,autoFocus:!1},(0,s.jsx)("div",{css:s.css`
              width: 240px;
              height: 360px;
              .component-main-data-and-view {
                display: none;
              }
              .field-list {
                height: calc(100% - 60px) !important;
              }
            `},(0,s.jsx)(se.ExpressionBuilder,{widgetId:l,types:(0,s.Immutable)([se.ExpressionBuilderType.Attribute]),useDataSources:(0,s.Immutable)([n.useDataSource]),expression:null,onChange:C})))),b.resultFieldsType===I.SelectAttributes&&(0,s.jsx)(oe,{useDataSource:n.useDataSource,label:j("configFields"),selectedFields:n.resultDisplayFields,onFieldsChanged:e=>{u("resultDisplayFields",e,!0)}}),(0,s.jsx)(c.SettingRow,{role:"group","aria-label":j("sortRecords"),flow:"wrap",label:j("sortRecords"),css:s.css`.no-sort-remind {margin-top: 0 !important;}`},(0,s.jsx)(K.Sort,{onChange:e=>{(e=>{const{dataSourceId:t,mainDataSourceId:a,dataViewId:i,rootDataSourceId:l}=n.useDataSource,s={dataSourceId:t,mainDataSourceId:a,dataViewId:i,rootDataSourceId:l,fields:n.useDataSource.fields};let r=n.set("sortOptions",e);r=r.set("useDataSource",s),o(r,!0)})(e)},value:(0,s.Immutable)(b.sortOptions),useDataSource:b.useDataSource})))}const me=(0,s.Immutable)([s.AllDataSourceTypes.FeatureLayer,s.AllDataSourceTypes.SceneLayer,s.AllDataSourceTypes.BuildingComponentSubLayer,s.AllDataSourceTypes.OrientedImageryLayer,s.AllDataSourceTypes.ImageryLayer]);function Ie(e){var t;const{index:i,total:l,arrangeType:n,widgetId:u,queryItem:d,onQueryItemAdded:p,onQueryItemChanged:g,handleStageChange:m,visible:I}=e,S=s.hooks.useTranslation(h),[y,v]=s.React.useState(""),j=Object.assign({},ee,d),x=s.React.useRef(),b=null!=j.useDataSource?(0,s.Immutable)([j.useDataSource]):void 0,N=O({widgetId:u,useDataSourceId:null===(t=j.useDataSource)||void 0===t?void 0:t.dataSourceId});s.React.useEffect((()=>{(null==d?void 0:d.name)&&y!==d.name&&v(d.name)}),[null==d?void 0:d.name]),s.React.useEffect((()=>{I&&x.current&&x.current.focus()}),[I]);const w=s.React.useCallback(((e,t)=>{x.current=t.target,m(e)}),[m]),D=e=>{e&&s.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,s.Immutable)(e)).then((e=>{const t=f(e);return t||Promise.reject(Error("")),t})).then((t=>{if(null==d){const a=function(e,t,a){const i=`${Math.random()}`.slice(2),l=null==a?void 0:a.getLabel();return(0,s.Immutable)({configId:i,name:l,useDataSource:t,outputDataSourceId:`${e}_output_${i}`,spatialRelationUseDataSources:[]})}(u,e,t);p(a)}else{const a=(0,s.Immutable)({configId:d.configId,name:null==t?void 0:t.getLabel(),useDataSource:e,outputDataSourceId:d.outputDataSourceId,spatialRelationUseDataSources:[]});g(i,a,!0)}}))},M=s.React.useCallback(((e,t,a=!1)=>{let l;l=null==t?d.without(e):d.set(e,t),g(i,l,a)}),[g,i,d]),T=(e,t=!1)=>{g(i,e,t)},C=s.React.useCallback((e=>{v(e.target.value)}),[]),R=s.React.useCallback((e=>{e.trim().length>0?M("name",e,!0):v(d.name)}),[null==d?void 0:d.name,M]);return(0,s.jsx)("div",{className:(0,s.classNames)("h-100",{"d-none":!I})},(0,s.jsx)("div",{css:s.css`height: 100%;overflow: auto;`},(0,s.jsx)(c.SettingSection,{role:"group","aria-label":S("data"),title:S("data"),className:"pt-0"},(0,s.jsx)(c.SettingRow,null,(0,s.jsx)(o.DataSourceSelector,{widgetId:u,disableRemove:()=>!0,mustUseDataSource:!0,closeDataSourceListOnChange:!0,types:me,isMultiple:!1,useDataSources:b,onChange:e=>{D(null==e?void 0:e[0])}}))),d&&N&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(c.SettingSection,{role:"group","aria-label":S("label"),title:S("label")},(0,s.jsx)(c.SettingRow,null,(0,s.jsx)(r.TextInput,{"aria-label":S("label"),className:"w-100",size:"sm",value:y,onChange:C,onAcceptValue:R})),l<2&&n!==a.Inline&&(0,s.jsx)(c.SettingRow,{label:S("displayLabel")},(0,s.jsx)(r.Switch,{"aria-label":S("displayLabel"),checked:j.displayLabel,onChange:e=>{M("displayLabel",e.target.checked)}}))),(0,s.jsx)(c.SettingSection,{role:"group","aria-label":S("icon")},(0,s.jsx)(c.SettingRow,{label:S("icon"),truncateLabel:!0},(0,s.jsx)($.IconPicker,{icon:j.icon,onChange:e=>{M("icon",e)},configurableOption:"none",setButtonUseColor:!1}))),(0,s.jsx)(ae,{queryItem:d,onPropertyChanged:M,onQueryItemChanged:T}),(0,s.jsx)(le,{queryItem:d,onPropertyChanged:M,handleStageChange:w}),(0,s.jsx)(ge,{widgetId:u,queryItem:d,onPropertyChanged:M,onQueryItemChanged:T}))))}var Se=g(86058),ye=g.n(Se),ve=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};var he=g(42588),je=g.n(he),fe=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};var xe=g(2985),be=g.n(xe),Ne=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};var we=g(60846),De=g.n(we),Me=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};function Te(e){const{enabled:t,distance:a,unit:i,onEnableChanged:l,onDistanceChanged:n,onUnitChanged:o}=e,d=s.hooks.useTranslation(r.defaultMessages,h);return(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(c.SettingRow,{label:d("enableBuffer")},(0,s.jsx)(r.Switch,{"aria-label":d("enableBuffer"),checked:t,onChange:e=>{l(e.target.checked)}})),t&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(c.SettingRow,{label:d("defaultDistance")},(0,s.jsx)(r.NumericInput,{css:s.css`
                flex: 0 0 40%;
              `,"aria-label":d("defaultDistance"),className:"w-100",size:"sm",value:a,onChange:e=>{n(e)}})),(0,s.jsx)(c.SettingRow,{label:d("defaultUnit")},(0,s.jsx)(r.Select,{css:s.css`
                flex: 0 0 40%;
              `,size:"sm",value:i,"aria-label":d("defaultUnit"),onChange:e=>{o(e.target.value)}},Object.values(u).map((e=>(0,s.jsx)("option",{key:e,value:e},d(`unit_${e}`))))))))}var Ce=g(74919),Re=g.n(Ce),Oe=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};var ze=function(e,t){var a={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(a[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(i=Object.getOwnPropertySymbols(e);l<i.length;l++)t.indexOf(i[l])<0&&Object.prototype.propertyIsEnumerable.call(e,i[l])&&(a[i[l]]=e[i[l]])}return a};const Pe=e=>{const t=window.SVG,{className:a}=e,i=ze(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:G()},i)):s.React.createElement("svg",Object.assign({className:l},i))},Ae=[{type:e.Point,drawToolName:"point",icon:(0,s.jsx)((e=>{const t=window.SVG,{className:a}=e,i=Oe(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:Re()},i)):s.React.createElement("svg",Object.assign({className:l},i))}),null)},{type:e.Polyline,drawToolName:"polyline",icon:(0,s.jsx)((e=>{const t=window.SVG,{className:a}=e,i=ve(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:ye()},i)):s.React.createElement("svg",Object.assign({className:l},i))}),null)},{type:e.Polygon,drawToolName:"polygon",icon:(0,s.jsx)((e=>{const t=window.SVG,{className:a}=e,i=fe(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:je()},i)):s.React.createElement("svg",Object.assign({className:l},i))}),null)},{type:e.Rectangle,drawToolName:"rectangle",icon:(0,s.jsx)((e=>{const t=window.SVG,{className:a}=e,i=Ne(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:be()},i)):s.React.createElement("svg",Object.assign({className:l},i))}),null)},{type:e.Circle,drawToolName:"circle",icon:(0,s.jsx)((e=>{const t=window.SVG,{className:a}=e,i=Me(e,["className"]),l=(0,s.classNames)("jimu-icon jimu-icon-component",a);return t?s.React.createElement(t,Object.assign({className:l,src:De()},i)):s.React.createElement("svg",Object.assign({className:l},i))}),null)}],Be=s.css`
  border-top: 1px solid var(--ref-palette-neutral-700);
  .title {
    font-weight: 500;
    font-size: 0.875rem;
    color: var(--ref-palette-neutral-1000);
  }
`;function Le(e){const{index:t,handleStageChange:a,queryItem:l,onQueryItemChanged:n,visible:o}=e,u=Object.assign({},h,r.defaultMessages),d=s.hooks.useTranslation(u),p=s.React.useRef(),g=Object.assign({},ee,l),m=s.ReactRedux.useSelector((e=>{var t;if((null===(t=l.spatialMapWidgetIds)||void 0===t?void 0:t.length)>0){const t=l.spatialMapWidgetIds[0];return null!=e.appStateInBuilder.appConfig.widgets[t]}return!1})),I=s.React.useCallback(((e,a,i=!1)=>{const s=l.set(e,a);n(t,s,i)}),[n,l,t]);s.React.useEffect((()=>{o&&p.current.focus()}),[o]);const S=s.React.useCallback((e=>{const t=j(e,l.spatialFilterTypes?[...l.spatialFilterTypes]:[]);I("spatialFilterTypes",t)}),[I,l]),y=s.React.useCallback((e=>{let a=l.set("spatialMapWidgetIds",e);e&&0!==e.length||(a=a.set("spatialFilterTypes",[])),n(t,a,!1)}),[n,t,l]);return l?(0,s.jsx)("div",{className:(0,s.classNames)({"d-none":!o})},(0,s.jsx)("div",{className:"d-flex align-items-center px-4 pt-4",css:Be},(0,s.jsx)(r.Button,{ref:p,"aria-label":d("back"),type:"tertiary",size:"sm",icon:!0,className:"p-0 action-btn",onClick:()=>{a(0)}},(0,s.jsx)(Pe,{autoFlip:!0})),(0,s.jsx)("div",{className:"title flex-grow-1 text-truncate ml-2",title:d("featureFromMap")},d("featureFromMap"))),(0,s.jsx)(c.SettingSection,{role:"group",title:d("selectMapWidget"),className:"text-truncate"},(0,s.jsx)(c.SettingRow,null,(0,s.jsx)(c.MapWidgetSelector,{onSelect:y,useMapWidgetIds:g.spatialMapWidgetIds}))),m&&(0,s.jsx)(c.SettingSection,{role:"group","aria-label":d("geometryTypes"),title:d("geometryTypes")},(0,s.jsx)(c.SettingRow,null,(0,s.jsx)("label",null,(0,s.jsx)(r.Checkbox,{className:"mr-2",checked:g.spatialFilterTypes.includes(i.CurrentMapExtent),onChange:()=>{S(i.CurrentMapExtent)}}),(0,s.jsx)("span",null,d("spatialFilterType_CurrentMapExtent")))),(0,s.jsx)(c.SettingRow,null,(0,s.jsx)("label",null,(0,s.jsx)(r.Checkbox,{className:"mr-2",checked:g.spatialFilterTypes.includes(i.InteractiveDrawMode),onChange:()=>{S(i.InteractiveDrawMode)}}),(0,s.jsx)("span",null,d("spatialFilterType_InteractiveDrawMode")))),g.spatialFilterTypes.includes(i.InteractiveDrawMode)&&(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(c.SettingRow,{role:"group","aria-label":d("chooseSelectionTools"),flow:"wrap",className:"d-block",label:d("chooseSelectionTools")},Ae.map((e=>{const{type:t,icon:a,drawToolName:i}=e,l=g.spatialInteractiveCreateToolTypes,n=l.includes(t);return(0,s.jsx)("div",{key:t,className:"d-flex mt-2"},a,(0,s.jsx)("label",{className:"ml-2"},d(`sketchTool_${i}`)),(0,s.jsx)(r.Switch,{"aria-label":d(`sketchTool_${i}`),className:"ml-auto",checked:n,onChange:()=>{const e=j(t,[...l]);I("spatialInteractiveCreateToolTypes",e)}}))}))),(0,s.jsx)(Te,{enabled:g.spatialInteractiveEnableBuffer,distance:g.spatialInteractiveBufferDistance,unit:g.spatialInteractiveBufferUnit,onEnableChanged:e=>{I("spatialInteractiveEnableBuffer",e)},onDistanceChanged:e=>{I("spatialInteractiveBufferDistance",e)},onUnitChanged:e=>{I("spatialInteractiveBufferUnit",e)}})))):null}const Qe=s.css`
  border-top: 1px solid var(--ref-palette-neutral-700);
  .title {
    font-weight: 500;
    font-size: 0.875rem;
    color: var(--ref-palette-neutral-1000);
  }
`,ke=(0,s.Immutable)([s.AllDataSourceTypes.FeatureLayer]),Ee={overrideItemBlockInfo:()=>({name:x.TreeItemActionType.RenderOverrideItem,children:[{name:x.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:x.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:x.TreeItemActionType.RenderOverrideItemBody,children:[{name:x.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:x.TreeItemActionType.RenderOverrideItemDragHandle},{name:x.TreeItemActionType.RenderOverrideItemTitle}]}]}]}]}]})};function Ue(e){var t;return!(null===(t=s.DataSourceManager.getInstance().getDataSource(e.id))||void 0===t?void 0:t.getGeometryType())}function Ze(e){var t,a;const{index:i,widgetId:n,handleStageChange:u,queryItem:d,onQueryItemChanged:p,visible:g}=e,m=s.hooks.useTranslation(h),I=s.React.useRef(),S=s.React.useMemo((()=>(0,s.Immutable)(Object.entries(l).map((([e,t])=>({value:t,label:m(`spatialRelation_${e}`)}))))),[m]);s.React.useEffect((()=>{g&&I.current.focus()}),[g]);const y=(e,t,a=!1)=>{const l=d.set(e,t);p(i,l,a)},v=s.React.useCallback((e=>m("numSelected",{number:e.length})),[m]),j=s.hooks.useEventCallback(((e,t,a)=>{y("spatialRelations",a)})),f=s.hooks.useEventCallback((e=>{const t=e.map((e=>e.dataViewId!==s.CONSTANTS.SELECTION_DATA_VIEW_ID?Object.assign(Object.assign({},e),{dataSourceId:s.DataSourceManager.getInstance().getDataSource(e.mainDataSourceId).getDataView(s.CONSTANTS.SELECTION_DATA_VIEW_ID).id,dataViewId:s.CONSTANTS.SELECTION_DATA_VIEW_ID}):e));y("spatialRelationUseDataSources",t,!0)})),b=Object.assign({},ee,d),N=(0,s.Immutable)(null!==(t=b.spatialRelationUseDataSources)&&void 0!==t?t:[]),w=(0,s.Immutable)(null===(a=b.spatialRelations)||void 0===a?void 0:a.filter((e=>Object.values(l).includes(e))));return d?(0,s.jsx)("div",{className:(0,s.classNames)({"d-none":!g})},(0,s.jsx)("div",{className:"d-flex align-items-center px-4 pt-4",css:Qe},(0,s.jsx)(r.Button,{ref:I,"aria-label":m("back"),type:"tertiary",size:"sm",icon:!0,className:"p-0 action-btn",onClick:()=>{u(0)}},(0,s.jsx)(Pe,{autoFlip:!0})),(0,s.jsx)("div",{className:"title flex-grow-1 text-truncate ml-2",title:m("featureFromDs")},m("featureFromDs"))),(0,s.jsx)("div",{css:s.css`height: calc(100% - 30px); overflow: auto;`},(0,s.jsx)(c.SettingSection,{role:"group","aria-label":m("selectionViewOnly")},(0,s.jsx)(c.SettingRow,{flow:"wrap",truncateLabel:!0,label:m("selectionViewOnly")},(0,s.jsx)(o.DataSourceSelector,{widgetId:n,buttonLabel:m("newFilterLayer"),disableRemove:()=>!1,disableDataView:!0,mustUseDataSource:!0,types:ke,isMultiple:!0,hideDs:Ue,isMultipleDataView:!1,useDataSources:N,onChange:f}))),(0,s.jsx)(c.SettingSection,null,(0,s.jsx)(c.SettingRow,{flow:"wrap",label:m("chooseSpatialRelationshipRules")},(0,s.jsx)(r.MultiSelect,{"aria-label":m("chooseSpatialRelationshipRules"),items:S,values:w,fluid:!0,onClickItem:j,displayByValues:v,size:"sm"})),(null==w?void 0:w.length)>0&&(0,s.jsx)(c.SettingRow,null,(0,s.jsx)(x.List,Object.assign({className:"selected-fields-list w-100",itemsJson:Array.from(w).map(((e,t)=>{const a=S.find((t=>t.value===e)).label;return{itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:a,itemStateCommands:[]}})),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a,l=i.map((e=>e.itemStateDetailContent));y("spatialRelations",l)}},Ee)))),(0,s.jsx)(c.SettingSection,null,(0,s.jsx)(Te,{enabled:b.spatialRelationEnableBuffer,distance:b.spatialRelationBufferDistance,unit:b.spatialRelationBufferUnit,onEnableChanged:e=>{y("spatialRelationEnableBuffer",e)},onDistanceChanged:e=>{y("spatialRelationBufferDistance",e)},onUnitChanged:e=>{y("spatialRelationBufferUnit",e)}})))):null}function Fe(e){const{widgetId:t,index:a,queryItem:i,onQueryItemChanged:l}=e,[n,o]=s.React.useState(0);s.React.useEffect((()=>{(null==i?void 0:i.useDataSource)||o(0)}),[null==i?void 0:i.useDataSource]);const r=e=>{e>=0&&o(e)};return(0,s.jsx)("div",{className:"h-100"},(0,s.jsx)(Ie,Object.assign({},e,{visible:0===n,handleStageChange:r})),i&&(0,s.jsx)(Le,{index:a,queryItem:i,visible:1===n,onQueryItemChanged:l,handleStageChange:r}),i&&(0,s.jsx)(Ze,{index:a,widgetId:t,queryItem:i,visible:2===n,onQueryItemChanged:l,handleStageChange:r}))}const{iconMap:We,iconPropMap:Ge}=J,Ve=s.css`
  position: relative;
  overflow: hidden;
  & > div {
    top: 50%;
    width: 100%;
    transform: translateY(-50%);
    color: var(--ref-palette-neutral-800);
  }
  p {
    color: var(--ref-palette-neutral-1000);
    font-size: 0.875rem;
    margin: ${s.polished.rem(16)} auto 0;
    line-height: 1.5;
    width: ${s.polished.rem(228)};
  }
`;function He(e){const{queryItems:t=[],onNewQueryItemAdded:a,onQueryItemChanged:i,onQueryItemRemoved:l,onOrderChanged:n}=e,o=s.React.useRef(null),u=s.React.useRef(null),[d,p]=s.React.useState(-1),g=s.hooks.useTranslation(h),m=s.hooks.useLatest(d),I=s.React.useCallback((()=>{p(t.length)}),[t.length]),S=s.React.useCallback((()=>{p(-1)}),[]),y={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:x.TreeItemActionType.RenderOverrideItem,children:[{name:x.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:x.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:x.TreeItemActionType.RenderOverrideItemBody,children:[{name:x.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:x.TreeItemActionType.RenderOverrideItemDragHandle},{name:x.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:x.TreeItemActionType.RenderOverrideItemTitle},{name:x.TreeItemActionType.RenderOverrideItemDetailToggle},{name:x.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,s.jsx)("div",{ref:o,css:s.css`
        border-bottom: 1px solid var(--ref-palette-neutral-700);
        &.h-100 > .jimu-widget-setting--section {
          border-bottom: none;
        }
      `,className:(0,s.classNames)("d-flex flex-column",{"h-100":0===t.length})},(0,s.jsx)(c.SettingSection,{role:"group","aria-label":g("queryItem"),title:g("queryItem")},(0,s.jsx)(c.SettingRow,{flow:"wrap"},(0,s.jsx)(r.Button,{"aria-describedby":0===t.length?"noQueryItemDesc":void 0,className:"w-100 text-default set-link-btn",onClick:I,type:"primary",ref:u},(0,s.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,s.jsx)(r.Icon,{icon:We.iconAdd,className:"mr-1",size:14}),g("newQuery")))),(0,s.jsx)("div",{className:"setting-ui-unit-list mt-4"},(0,s.jsx)(x.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:t.map(((e,t)=>{var a;return{itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:d===t,itemStateIcon:{icon:null===(a=e.icon)||void 0===a?void 0:a.svg},itemStateTitle:e.name,itemStateCommands:[{label:g("remove"),iconProps:()=>({icon:We.iconClose,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e;l(+t.itemKey)}}]}})),dndEnabled:!0,renderOverrideItemDetailToggle:(t,a)=>{var i;const{itemJsons:l}=a.props,[n]=l,o=null===(i=null==n?void 0:n.itemStateDetailContent)||void 0===i?void 0:i.useDataSource;return(0,s.jsx)(z,{widgetId:e.widgetId,useDataSource:o})},onUpdateItem:(e,t)=>{const{itemJsons:a}=t.props,[,i]=a;n(i.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[a]}=t.props;var i;i=+a.itemKey,m.current===i?p(-1):p(i)}},y)),t.length===d&&(0,s.jsx)(x.List,Object.assign({className:"setting-ui-unit-list-new pt-1",css:s.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{icon:Ge.defaultIconResult,name:"......"}].map((e=>{var t;return{itemStateDetailContent:e,itemKey:`${d}`,itemStateChecked:!0,itemStateIcon:{icon:null===(t=e.icon)||void 0===t?void 0:t.svg},itemStateTitle:e.name,itemStateCommands:[]}})),dndEnabled:!1},y)))),0===t.length&&t.length!==d&&(0,s.jsx)("div",{className:"text-center flex-grow-1",css:Ve},(0,s.jsx)("div",{className:"position-absolute"},(0,s.jsx)(r.Icon,{size:48,icon:We.iconEmpty}),(0,s.jsx)("p",{id:"noQueryItemDesc",className:"trigger-tip"},g("noQueryTip",{newQuery:g("newQuery")})))),(0,s.jsx)(c.SidePopper,{isOpen:d>=0&&!s.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:S,position:"right",trigger:o.current,title:g("setQuery"),backToFocusNode:u.current},(0,s.jsx)("div",{className:"setting-query__query-item-panel w-100 h-100"},(0,s.jsx)(Fe,{widgetId:e.widgetId,index:d,total:t.length,arrangeType:e.arrangeType,queryItem:t[d],onQueryItemAdded:a,onQueryItemChanged:i}))))}const{arrangementStyleMap:qe}=J,Ye=s.css`
  .icon-btn {
    padding: 0;
    &.active {
      outline: 2px solid var(--sys-color-primary-light) !important;
    }
    img {
      background-color: var(--ref-palette-neutral-300);
    }
  }
`;function _e(e){const{arrangeType:t,arrangeWrap:i=!1,onArrangeTypeChanged:l,onArrangeWrapChanged:n}=e,o=s.hooks.useTranslation(h);return(0,s.jsx)(c.SettingSection,{role:"group","aria-label":o("arrangementStyle"),title:o("arrangementStyle"),css:Ye},(0,s.jsx)(c.SettingRow,{flow:"wrap"},(0,s.jsx)(r.ButtonGroup,{className:"w-100 d-flex justify-content-between"},Object.entries(qe).map((([e,a])=>(0,s.jsx)(r.Tooltip,{key:e,title:a.getTitle(o),placement:"bottom"},(0,s.jsx)(r.Button,{onClick:()=>{l(e)},icon:!0,size:"sm",type:"tertiary",active:t===e,"aria-pressed":t===e},(0,s.jsx)(r.Icon,{width:68,height:68,icon:a.icon,autoFlip:!0}))))))),t===a.Inline&&(0,s.jsx)(c.SettingRow,{label:o("wrapItems")},(0,s.jsx)(r.Switch,{"aria-label":o("wrapItems"),checked:i,onChange:e=>{n(e.target.checked)}})))}class Je extends s.React.PureComponent{constructor(e){super(e),this.getI18nMessage=function(e){const{intl:t,defaultMessages:a={}}=e||{};return(e,i)=>{const{messages:l,values:s}=i||{};return t.formatMessage({id:e,defaultMessage:(l||a)[e]},s)}}({intl:this.props.intl,defaultMessages:h}),this.updateWidgetJson=(...e)=>{const[t,...a]=e,i=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(i,...a)},this.updateConfigForOptions=(...e)=>{let t=null;const a=e.reduce(((e,[a,i,l])=>("queryItems"===a&&(null==l?void 0:l.dsUpdateRequired)&&(t=this.getAllDataSources(i)),e.set(a,i))),this.props.config);t?this.updateWidgetJson({config:a,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources):this.updateWidgetJson({config:a})},this.handleArrangeTypeChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("arrangeType",e)})},this.handleArrangeWrapChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("arrangeWrap",e)})},this.handleResultDirectionChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultListDirection",e?d.Vertical:d.Horizontal)})},this.handleResultPageStyleChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultPagingStyle",e.target.value)})},this.handleDefaultPageSizeChange=e=>{null!=e&&this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultPageSize",e)})},this.tryRemoveQueryItem=e=>{const t=this.props.config.queryItems[e],a=(0,n.getAppConfigAction)().appConfig;0===o.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(t.outputDataSourceId,a.widgets).length?this.doRemoveQueryItem(e,!0):this.setState({showRemoveQueryItemWarning:!0,indexOfQueryItemToRemove:e,dsToRemove:t.outputDataSourceId})},this.beforeRemovingDataSource=()=>{this.doRemoveQueryItem(this.state.indexOfQueryItemToRemove)},this.doRemoveQueryItem=(e,t=!1)=>{const a={dsUpdateRequired:t},i=this.props.config.queryItems.asMutable({deep:!0});i.splice(e,1),this.updateConfigForOptions(["queryItems",i,a])},this.afterRemovingDataSource=()=>{this.setState({showRemoveQueryItemWarning:!1,indexOfQueryItemToRemove:-1,dsToRemove:null})},this.addQueryItem=e=>{var t,a;this.updateQueryItem(null!==(a=null===(t=this.props.config.queryItems)||void 0===t?void 0:t.length)&&void 0!==a?a:0,e,!0)},this.updateQueryItem=(e,t,a=!1)=>{var i;let l=null!==(i=this.props.config.queryItems)&&void 0!==i?i:(0,s.Immutable)([]);l=s.Immutable.set(l,e,t),this.updateConfigForOptions(["queryItems",l,{dsUpdateRequired:a}])},this.reOrderQueryItems=e=>{this.updateConfigForOptions(["queryItems",e])},this.getAllDataSources=e=>{const t={};return(0,s.Immutable)(e).asMutable({deep:!0}).reduce(((e,a)=>{var i,l;[a.useDataSource,...a.spatialRelationUseDataSources].forEach((i=>{var l,n,o,r;const c=i.dataSourceId;e.useDataSourceMap[c]=e.useDataSourceMap[c]||i;const u=(a.sortOptions||[]).filter((e=>e.jimuFieldName)).map((e=>e.jimuFieldName)),d=null===(l=a.resultTitleExpression)||void 0===l?void 0:l.match(/\{(\w*)\}/g),p=[];if((null==d?void 0:d.length)>0){const e=s.DataSourceManager.getInstance().getDataSource(c),t=null!==(o=null===(n=null==e?void 0:e.getSchema())||void 0===n?void 0:n.fields)&&void 0!==o?o:{};d.forEach((e=>{const a=e.substring(1,e.length-1);t[a]&&p.push(a)}))}const g=null!==(r=t[c])&&void 0!==r?r:new Set;e.useDataSourceMap[c].fields=Array.from(new Set([...Array.from(g),...i.fields||[],...p,...a.resultFieldsType===I.SelectAttributes&&a.resultDisplayFields?a.resultDisplayFields:[],...u])),t[c]=e.useDataSourceMap[c].fields,a.resultFieldsType!==I.SelectAttributes&&(e.useDataSourceMap[c].useFieldsInPopupInfo=!0)}));const n=s.DataSourceManager.getInstance().getDataSource(null===(i=a.useDataSource)||void 0===i?void 0:i.dataSourceId);if(n){const t=null===(l=f(n))||void 0===l?void 0:l.getDataSourceJson(),i={id:a.outputDataSourceId,label:this.getI18nMessage("outputDsLabel",{values:{label:`${a.name}`}}),type:null==t?void 0:t.type,geometryType:null==t?void 0:t.geometryType,url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,originDataSources:[a.useDataSource],layerId:null==t?void 0:t.layerId,isDataInDataSourceInstance:null==t?void 0:t.isDataInDataSourceInstance};e.outputDataSources.push(i)}return e}),{useDataSourceMap:{},outputDataSources:[]})},this.hideRemovePopup=()=>{this.setState({showRemoveQueryItemWarning:!1})},this.state={showRemoveQueryItemWarning:!1,indexOfQueryItemToRemove:-1,dsToRemove:null}}render(){var e,t,a,i,l,n;const{config:u}=this.props;let{resultListDirection:g,resultPagingStyle:m,defaultPageSize:I}=u;return g||(g=null!==(a=null===(t=null===(e=u.queryItems)||void 0===e?void 0:e[0])||void 0===t?void 0:t.resultListDirection)&&void 0!==a?a:d.Vertical),m||(m=null!==(n=null===(l=null===(i=u.queryItems)||void 0===i?void 0:i[0])||void 0===l?void 0:l.resultPagingStyle)&&void 0!==n?n:p.MultiPage),(0,s.jsx)("div",{className:"setting-query h-100"},(0,s.jsx)("div",{className:"jimu-widget-setting setting-query__setting-content"},(0,s.jsx)(He,{widgetId:this.props.id,arrangeType:this.props.config.arrangeType,queryItems:this.props.config.queryItems,onNewQueryItemAdded:this.addQueryItem,onQueryItemRemoved:this.tryRemoveQueryItem,onQueryItemChanged:this.updateQueryItem,onOrderChanged:this.reOrderQueryItems}),this.props.config.queryItems.length>0&&(0,s.jsx)(_e,{arrangeType:u.arrangeType,arrangeWrap:u.arrangeWrap,onArrangeTypeChanged:this.handleArrangeTypeChange,onArrangeWrapChanged:this.handleArrangeWrapChange}),this.props.config.queryItems.length>0&&(0,s.jsx)(c.SettingSection,{role:"group","aria-label":this.getI18nMessage("resultStyle"),title:this.getI18nMessage("resultStyle")},(0,s.jsx)(c.SettingRow,{label:this.getI18nMessage("listDirection")},(0,s.jsx)(c.DirectionSelector,{"aria-label":this.getI18nMessage("listDirection"),vertical:g===d.Vertical,onChange:this.handleResultDirectionChange})),(0,s.jsx)(c.SettingRow,{flow:"wrap",label:this.getI18nMessage("pagingStyle")},(0,s.jsx)(r.Select,{"aria-label":this.getI18nMessage("pagingStyle"),className:"w-100",size:"sm",value:m,onChange:this.handleResultPageStyleChange},(0,s.jsx)("option",{value:p.MultiPage},this.getI18nMessage("pagingStyle_MultiPage")),(0,s.jsx)("option",{value:p.LazyLoad},this.getI18nMessage("pagingStyle_LazyLoad")))),m===p.MultiPage&&(0,s.jsx)(c.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultPageSize")},(0,s.jsx)(r.NumericInput,{className:"w-100",value:null!=I?I:100,precision:0,min:10,max:1e3,onAcceptValue:this.handleDefaultPageSizeChange})))),(0,s.jsx)(o.DataSourceRemoveWarningPopup,{dataSourceId:this.state.dsToRemove,isOpen:this.state.showRemoveQueryItemWarning,toggle:this.hideRemovePopup,reason:o.DataSourceRemoveWaringReason.DataSourceRemoved,afterRemove:this.afterRemovingDataSource,beforeRemove:this.beforeRemovingDataSource}))}}function $e(e){g.p=e}})(),m})())}}}));