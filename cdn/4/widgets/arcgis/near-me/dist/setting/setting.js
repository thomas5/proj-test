System.register(["jimu-core","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme","jimu-ui/advanced/style-setting-components","jimu-ui/advanced/rich-text-editor","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder"],(function(e,t){var s={},i={},a={},l={},o={},n={},r={},d={},p={},h={},u={},c={};return{setters:[function(e){s.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.EsriFieldType=e.EsriFieldType,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.JimuMapViewStatus=e.JimuMapViewStatus,s.OrderRule=e.OrderRule,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.lodash=e.lodash,s.polished=e.polished,s.urlUtils=e.urlUtils},function(e){i.MapWidgetSelector=e.MapWidgetSelector,i.MultipleJimuMapConfig=e.MultipleJimuMapConfig,i.SettingRow=e.SettingRow,i.SettingSection=e.SettingSection,i.SidePopper=e.SidePopper},function(e){a.BaseWidgetSetting=e.BaseWidgetSetting},function(e){l.Alert=e.Alert,l.AlertPopup=e.AlertPopup,l.Button=e.Button,l.Checkbox=e.Checkbox,l.CollapsablePanel=e.CollapsablePanel,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Label=e.Label,l.NumericInput=e.NumericInput,l.Option=e.Option,l.Popper=e.Popper,l.Radio=e.Radio,l.Select=e.Select,l.Switch=e.Switch,l.TextArea=e.TextArea,l.TextInput=e.TextInput,l.Tooltip=e.Tooltip,l.defaultMessages=e.defaultMessages},function(e){o.MapViewManager=e.MapViewManager},function(e){n.ThemeColorPicker=e.ThemeColorPicker},function(e){r.getTheme2=e.getTheme2},function(e){d.FontStyle=e.FontStyle,d.InputUnit=e.InputUnit},function(e){p.FontFamily=e.FontFamily},function(e){h.List=e.List,h.TreeItemActionType=e.TreeItemActionType},function(e){u.AllDataSourceTypes=e.AllDataSourceTypes,u.DataSourceSelector=e.DataSourceSelector,u.FieldSelector=e.FieldSelector},function(e){c.ExpressionBuilder=e.ExpressionBuilder,c.ExpressionBuilderType=e.ExpressionBuilderType}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},93303:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35q.227 1.084.316 1.852.562.242 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 22 22 0 0 1-1.49 1.194q.03.27.03.552 0 .32-.038.63l1.465 1.12a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 23 23 0 0 1-1.807-.66q-.49.35-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21 21 0 0 1-.317-1.853 5.3 5.3 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546q.85-.735 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196q1.078.35 1.807.66c.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994zm-.365 1H6.985l-.28 1.866-.467.19q-.353.144-.672.34l-.207.136-.42.293-.476-.197q-.492-.205-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4 4 0 0 0-.021.816l.014.144.058.492-.419.294q-.433.304-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29q.307.219.645.384l.228.103.474.199.059.49q.06.507.19 1.177l.043.219h2.088l.282-1.867.466-.19q.354-.144.672-.34l.207-.136.419-.293.476.198q.495.204 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4 4 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18 18 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.5 4.5 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49q-.049-.405-.14-.916zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6m0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4" clip-rule="evenodd"></path></svg>'},37568:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.54.54 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.54.54 0 0 1 .738 0" clip-rule="evenodd"></path></svg>'},14962:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 3a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zM1 6.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5M1.5 9a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zM1.5 12a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},54578:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 13a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1zM1 9.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5M1.5 7a.5.5 0 0 1 0-1h10a.5.5 0 0 1 0 1zM1.5 4a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1z"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},12046:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.227 1.312c-.404-.404-1.045-.417-1.432-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431zm-8.114 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1z"></path></svg>'},74919:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7 2h2a2 2 0 0 1 2 2v7.817l-3 2.812-3-2.812V4a2 2 0 0 1 2-2m5 2v8.25L8 16l-4-3.75V4a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3M9 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0m1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0" clip-rule="evenodd"></path></svg>'},42588:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 3.429V16h14V0L6.833 6.857zM14 2v13H2V5.114l4.182 2.51a1.2 1.2 0 0 0 1.398-.118z" clip-rule="evenodd"></path></svg>'},86058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M14.582 5 11 10.949V12H9v-1.274L5.316 7h-.515L2 12.383V14H0v-2h1.073L4 6.374V5h2v1.27L9.688 10h.716L14 4.029V3h2v2z"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},27931:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgOCA4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgZmlsbD0nIzI4MjgyOCc+DQogICAgPHBhdGggZD0iTTMuNSAzLjV2LTNhLjUuNSAwIDAxMSAwdjNoM2EuNS41IDAgMDEwIDFoLTN2M2EuNS41IDAgMDEtMSAwdi0zaC0zYS41LjUgMCAwMTAtMWgzeiIgZmlsbC1ydWxlPSJldmVub2RkIj48L3BhdGg+DQo8L3N2Zz4="},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=s},4108:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=l},13089:e=>{"use strict";e.exports=u},84845:e=>{"use strict";e.exports=c},33949:e=>{"use strict";e.exports=p},79298:e=>{"use strict";e.exports=i},15562:e=>{"use strict";e.exports=d},54337:e=>{"use strict";e.exports=n},98640:e=>{"use strict";e.exports=h}},t={};function m(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,m),a.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var s in t)m.o(t,s)&&!m.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var y={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(y),m.d(y,{__set_webpack_public_path__:()=>Qe,default:()=>Ye});var e=m(79244),t=m(79298),s=m(4108),i=m(14321),a=m(62686);const l={selectMapWidgetLabel:"Select a map widget",warningMsgIfNoLayersOnMap:"This map does not contain any feature layers. Select a map with at least one feature layer.",generalSettingsLabel:"General Settings",highlightColor:"Sketch color",highlightColorTooltip:"Indicate the desired color for sketching on the map",onlyShowResults:"Filter layers to only show results",onlyShowResultsTooltip:"Filter the data source to only show features from the analysis results. Other widgets connected to this data source will be filtered.",noResultsFoundLabel:"No results found message",noDataMessageDefaultText:"No results found.",promptMessageLabel:"Custom welcome message",promptMessageLabelToolTip:"Provide users with instructions on how to start the workflow.",headingLabel:"Heading label",locationLabel:"Location",currentMapAreaLabel:"Explore features within current map area",disabledDefineSearchAreaLabel:"Explore all features",defineSearchAreaTooltip:"Assess all features within the map area, or specify a location using sketch tools or the output from another widget.",defineSearchAreaLabel:"Search Method",featuresOutsideMapArea:"Include features outside map area",searchAreaHint:"No search area is defined and all the features will be displayed. Any configured Closest Feature analysis will be ignored.",point:"Point",polyline:"Polyline",polygon:"Polygon",showSketchTools:"Sketch tools",bufferDistance:"Search distance",distanceUnits:"Distance units",meters:"Meters",feet:"Feet",kilometers:"Kilometers",miles:"Miles",yards:"Yards",searchByActiveMapArea:"Current map area",searchByLocation:"Specify a location",showDistanceSettings:"Distance settings",showDistFromInputLoc:"Approximate distance",inputAddress:"Input location label",mapSettingsHintMsg:"Click a map below to configure the analysis settings.",analysisSettingsLabel:"Analysis Settings",addAnalysisLabel:"Add Analysis",configureAnalysisTooltip:"Configure closest feature, proximity, or summary analysis for layers in the map. Configured layers will be used for analysis regardless of their visibility in the map.",selectLayer:"Select layer",closest:"Closest Feature",analysisTypeLabel:"Analysis Type",highlightResultsOnMapLabel:"Highlight results on map",highlightColorLabel:"Highlight color",closestAnalysisTypeTooltip:"Find the closest feature.",closestFeatureMaxDistLabel:"Maximum distance",warningMsgIfActiveMapArea:'"Current map area" is defined as the search method. No results will be shown for this analysis type.',proximity:"Proximity",proximityAnalysisTypeTooltip:"Find features within a specified distance.",displayFieldLabel:"Display field",sortFeaturesLabel:"Sort features",distanceLabel:"Distance",noSelectionItemLabel:"- Select -",groupFeaturesLabel:"Group features",groupFeaturesInfoToolTip:"Group features based on multiple field values",sortGroupsByCount:"Sort groups by count",noValueGroupLabel:'"No value" group label',expandOnOpen:"Expand analysis results",expandFeatureDetails:"Expand feature details",expandListTooltip:"Use with caution: performance may be impacted for analysis results with a large number of features.",configureFieldsLabel:"Configure fields to export",includeApproxDistance:"Include approximate distance",summary:"Summary",summaryAnalysisTypeTooltip:"Summarize numeric values.",addSummaryFields:"Add Summary",editSummaryField:"Edit Summary Field",editExpression:"Edit Expression",editAnalysis:"Edit Analysis",editSumOfIntersectedArea:"Edit sum of intersected area",editSumOfIntersectedLength:"Edit sum of intersected length",showSeparator:"Show thousand separator",sumOfIntersectedArea:"Sum of intersected area",sumOfIntersectedLength:"Sum of intersected length",sumOfAreaTooltip:"Sum of intersected area calculates the area of polygon intersected by search geometry",sumOfLengthTooltip:"Sum of intersected length calculates the length of polyline intersected by search geometry",noFormatting:"No formatting",round:"Round",truncate:"Truncate",significantDigitsLabel:"Significant digits",singleColor:"Single color",byCategory:"By category",summaryFieldColor:"Define summary colors",applyColors:"Apply colors",colorStrip:"Color strip",displayFeatureCountLabel:"Feature count",displayAnalysisIconLabel:"Analysis icons",mapSymbolsLabel:"Map symbols",addSummaryHintMsg:"Add new summary expressions or only display the feature count.",noAnalysisConfiguredMsg:"Analysis is not configured for layers in this map.",resultsCollapsible:"Results",inputsCollapsible:"Inputs",analysisLabel:"Analysis"};function o(t,s){return e.css`
  .alignTooltip {
    margin-right: -6px;
  }
  
  .disabled-label{
    color: ${t.ref.palette.neutral[700]};
  }

  .nearme-analysis-list-items {
    .analysis-item {
      padding: 4px 2px 8px 2px;

      .layer-analysis-name {
        font-size: ${e.polished.rem(14)};
        font-weight: 400;
        width: ${s?"150px":"165px"};
       }

      .analysis-type-name {
        font-size: ${e.polished.rem(13)};
        padding-top: 10px;
        width: 165px;
      }
    }

    .cursor-pointer {
      cursor: pointer;
    }
  }

  .sort-field-section {
    display: flex;
    align-items: center;
    flex: 1;
    .sort-field-selector {
      background:${t.sys.color.secondary.light};
      border-radius: 2px;
      flex: 1;
      width: 0
    }

    .order-button {
        cursor: pointer;
        text-align:right;
        margin-left: ${e.polished.rem(2)};
    }

    .order-button svg {
        margin-right:0;
    }
  }

  .sort-icon {
    & {
        margin-left:5px;
    }

    .sort-button-l {
      border-radius: 2px 0 0 2px;
      border-right:none;
    }

    .sort-button-r {
      border-radius: 0px 2px 2px 0px;
      border-left:none;
    }

    .sort-button {
      border-color: ${t.sys.color.divider.primary};
    }

    svg {
      margin-right:0;
    }
  }

  .cursor-pointer {
    cursor: pointer;
  }

  .add-summary-field {
    height: ${e.polished.rem(40)};
    width: 100%;
    color: ${t.sys.color.primary.light};
    font-size: ${e.polished.rem(14)};
    cursor: pointer;
    &:hover {
      .add-summary-field-icon-container {
        background-color: ${e.polished.rgba(t.sys.color.primary.light,.8)};
      }
      color: ${e.polished.rgba(t.sys.color.primary.light,.8)};
    }
    .add-summary-field-icon-container {
      width: 20px;
      height: 20px;
      background-color: ${t.sys.color.primary.light};
      border-radius: 10px;
    }
    .add-summary-field-icon {
      color: ${t.ref.palette.neutral[400]};
    }
  }

  .fieldName {
    width: 180px;
  }

  .nearme-summary-fields-list-items {
    flex: 1;
    max-height: 290px;
    overflow-y: auto;
    margin-bottom: 10px;
    margin-top: 3px;

    .labelAlign {
      width: calc(100% - 65px);
      max-width: 155px;
    }

    .jimu-tree-item.jimu-tree-item_dnd-true {
      height: auto;
      padding-top: 0rem;
  
      .jimu-tree-item__body {
        padding: 4px 0px 4px 0px;
      }
    }
  }

  .colorModesWidth {
    width: calc(100% - 30px);
  }

  .analysisTypeWidth { 
    width: calc(100% - 16px);
  }
  `}function n(t){return e.css`
    position: absolute;
    top: 0;
    bottom: 0;
    width: 259px;
    height: 100%;
    padding-bottom: 1px;
    border-right: 1px solid ${t.ref.palette.white};
    border-bottom: 1px solid ${t.ref.palette.white};

    .setting-container {
      height: calc(100% - 52px);
      overflow: auto;
    }
`}function r(t){return e.css`
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: var(--ref-palette-neutral-1100);
    > .color-list {
      width: 100%;
      flex-grow: 1;
      overflow-y: auto;
      max-height: 562px;
    }
    > .footer {
      height: 57px;
      width: 100%;
      border-top: 1px solid #6a6a6a;
      > div {
        display: flex;
        width: 100%;
        justify-content: space-between;
      }
    }

    .colorItemStyle {
      display: flex;
      width: 100%;
      justify-content: space-between;
      label {
        width: 88%;
        flex-grow: 1;
        display: inline-flex;
        justify-content: space-between;
        .label {
          max-width: 70%;
        }
      }
    }
`}var d;!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(d||(d={}));var p=m(31027),h=m.n(p),u=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const c=t=>{const s=window.SVG,{className:i}=t,a=u(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:h()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var g=function(e,t,s,i){return new(s||(s=Promise))((function(a,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function n(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,n)}r((i=i.apply(e,t||[])).next())}))};const f=(e,t=0)=>{if(!(null==e?void 0:e.length))return;return e[t%e.length]},S=t=>e.DataSourceManager.getInstance().getDataSource(t);var x;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(x||(x={}));const b=e=>{switch(e){case"feet":return x.Feet;case"miles":return x.Miles;case"kilometers":return x.Kilometers;case"meters":return x.Meters;case"yards":return x.Yards;default:return 1e3}},v=t=>g(void 0,void 0,void 0,(function*(){let s=null;const i=[];let l=!1;const o=a.MapViewManager.getInstance().getJimuMapViewById(t),n=yield null==o?void 0:o.whenAllJimuLayerViewLoaded();for(const t in n){const a=yield o.whenJimuLayerViewLoaded(t);if(s=S(a.layerDataSourceId),s)if((null==s?void 0:s.type)===e.DataSourceTypes.MapService||(null==s?void 0:s.type)===e.DataSourceTypes.GroupLayer){const t=s=>{s.getChildDataSources().forEach((s=>{(null==s?void 0:s.type)===e.DataSourceTypes.GroupLayer?t(s):i.push(s)}))};t(s)}else if(i.length>0){i.find((e=>e.id===s.id))||(l=!0),l&&i.push(s)}else i.push(s)}return i})),F=e=>{var t;let s="";return s=(null==e?void 0:e.objectIdField)?e.objectIdField:(null==e?void 0:e.displayField)?e.displayField:null===(t=null==e?void 0:e.fields)||void 0===t?void 0:t[0].name,s},C=(e,t,s)=>`${e}_output_${t}_${s}`,w=()=>`${Math.random()}`.slice(2).toString(),I=e=>{const t=S(e),s=t&&t.getSchema(),i=(null==s?void 0:s.fields)?Object.values(null==s?void 0:s.fields):[],a=[];return i&&i.length>0&&i.forEach((e=>{a.push(e.jimuName)})),a},L=e=>{const t=e;let s=[];s||(s=[]);for(const e in t){const i=t[e].analysisSettings.layersInfo;null==i||i.forEach((t=>{var i,a,l,o,n,r,p,h,u;const c=t.analysisInfo,m=s.filter((e=>e.dataSourceId===t.useDataSource.dataSourceId)),y=(null==m?void 0:m.length)>0?m[0]:{dataSourceId:t.useDataSource.dataSourceId,mainDataSourceId:t.useDataSource.dataSourceId,rootDataSourceId:e,fields:[]};(c.analysisType===d.Closest||c.analysisType===d.Proximity||c.analysisType===d.Summary)&&(null===(i=c.fieldsToExport)||void 0===i?void 0:i.length)>0&&c.fieldsToExport.forEach((e=>{!y.fields.includes(e)&&"esriCTApproxDistance"!==e&&y.fields.push(e)})),c.analysisType===d.Proximity&&(null===(a=c.displayField)||void 0===a?void 0:a.length)>0&&!y.fields.includes(c.displayField)&&y.fields.push(c.displayField),(null===(o=null===(l=c.sortFeatures)||void 0===l?void 0:l.sortFeaturesByField)||void 0===o?void 0:o.length)>0&&!y.fields.includes(c.sortFeatures.sortFeaturesByField)&&y.fields.push(c.sortFeatures.sortFeaturesByField),(null===(r=null===(n=c.groupFeatures)||void 0===n?void 0:n.groupFeaturesByField)||void 0===r?void 0:r.length)>0&&!y.fields.includes(c.groupFeatures.groupFeaturesByField)&&y.fields.push(c.groupFeatures.groupFeaturesByField),(null===(h=null===(p=c.subGroupFeatures)||void 0===p?void 0:p.subGroupFeaturesByField)||void 0===h?void 0:h.length)>0&&!y.fields.includes(c.subGroupFeatures.subGroupFeaturesByField)&&y.fields.push(c.subGroupFeatures.subGroupFeaturesByField),c.analysisType===d.Summary&&(null===(u=c.summaryFields)||void 0===u||u.forEach((e=>{e.summaryFieldInfo.parts.forEach((e=>{e.jimuFieldName&&!y.fields.includes(e.jimuFieldName)&&y.fields.push(e.jimuFieldName)}))}))),0===m.length&&s.push(y)}))}return s};var A=m(54337),O=m(45508),j=m.n(O),D=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const T=t=>{const s=window.SVG,{className:i}=t,a=D(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:j()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var M=m(1888),N=m(15562),k=m(33949);class R extends e.React.PureComponent{constructor(e){var t,s,i,a,o,n,r;super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>{e.hintMessage!==this.props.hintMessage&&this.setState({promptMessage:this.props.hintMessage})},this.onTextAccept=e=>{this.props.noResultFound?this.props.onTextMessageChange(e,this.props.noResultFound):this.props.onTextMessageChange(e,this.props.promptTextMessage)},this.onTextChange=e=>{this.setState({promptMessage:e})},this.textStyleObj=(e,t,s,i,a,l,o)=>{const n={fontFamily:e,fontBold:t,fontItalic:s,fontUnderline:i,fontStrike:a,fontColor:l,fontSize:o};this.props.noResultFound?this.props.onTextFormatChange(n,this.props.noResultFound):this.props.onTextFormatChange(n,this.props.promptTextMessage)},this.handleFontChange=e=>{this.setState({fontFamily:e},(()=>{this.textStyleObj(e,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.setFontStyleValues=()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)},this.handleFontStyleChange=(e,t)=>{switch(e){case"bold":this.setState({fontBold:t},(()=>{this.setFontStyleValues()}));break;case"italic":this.setState({fontItalic:t},(()=>{this.setFontStyleValues()}));break;case"underline":this.setState({fontUnderline:t,fontStrike:!1},(()=>{this.setFontStyleValues()}));break;case"strike":this.setState({fontUnderline:!1,fontStrike:t},(()=>{this.setFontStyleValues()}))}},this.handleColorChange=e=>{this.setState({fontColor:e||"var(--black)"},(()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.handleFontSizeChange=e=>{!e||e.distance<4||this.setState({fontSize:e.distance+e.unit},(()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.state={promptMessage:this.props.hintMessage,fontFamily:null===(t=this.props.textStyle)||void 0===t?void 0:t.fontFamily,fontBold:null===(s=this.props.textStyle)||void 0===s?void 0:s.fontBold,fontItalic:null===(i=this.props.textStyle)||void 0===i?void 0:i.fontItalic,fontUnderline:null===(a=this.props.textStyle)||void 0===a?void 0:a.fontUnderline,fontStrike:null===(o=this.props.textStyle)||void 0===o?void 0:o.fontStrike,fontColor:null===(n=this.props.textStyle)||void 0===n?void 0:n.fontColor,fontSize:null===(r=this.props.textStyle)||void 0===r?void 0:r.fontSize}}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%"}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.TextArea,{tabIndex:0,className:"w-100",spellCheck:!1,"aria-label":this.state.promptMessage,value:this.state.promptMessage,onChange:e=>{this.onTextChange(e.target.value)},onAcceptValue:this.onTextAccept})),(0,e.jsx)("div",{className:"w-100 pt-2"},(0,e.jsx)(k.FontFamily,{className:"w-100",font:this.state.fontFamily,onChange:this.handleFontChange}),(0,e.jsx)("div",{className:"d-flex justify-content-between mt-2"},(0,e.jsx)(N.FontStyle,{style:{width:"103px"},onChange:this.handleFontStyleChange,bold:this.state.fontBold,italic:this.state.fontItalic,underline:this.state.fontUnderline,strike:this.state.fontStrike}),(0,e.jsx)(A.ThemeColorPicker,{style:{width:"25px"},specificTheme:(0,M.getTheme2)(),value:this.state.fontColor,onChange:this.handleColorChange}),(0,e.jsx)(N.InputUnit,{style:{width:"76px"},min:4,max:72,value:this.state.fontSize,onChange:this.handleFontSizeChange}))))}}class B extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>{e.theme.sys.color.primary.dark!==this.props.theme.sys.color.primary.dark&&this.setState({highlightColor:this.props.theme.sys.color.primary.dark},(()=>{this.props.onGeneralSettingsUpdated("highlightColor",this.state.highlightColor)}))},this.onHighlightColorChange=e=>{this.setState({highlightColor:e},(()=>{this.props.onGeneralSettingsUpdated("highlightColor",this.state.highlightColor)}))},this.updateOnTextStyleChange=(e,t)=>{"noResultFound"===t?this.props.onGeneralSettingsUpdated("noResultMsgStyleSettings",e):this.props.onGeneralSettingsUpdated("promptTextMsgStyleSettings",e)},this.updateTextMessage=(e,t)=>{"noResultFound"===t?this.props.onGeneralSettingsUpdated("noResultsFoundText",e):this.props.onGeneralSettingsUpdated("promptTextMessage",e)},this.props.config&&(this.state={noResultsFoundMessage:this.props.config.noResultsFoundText,highlightColor:this.props.config.highlightColor?this.props.config.highlightColor:"#00FFFF",promptMessage:this.props.config.promptTextMessage})}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default"},this.nls("highlightColor"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("highlightColor")+" "+this.nls("highlightColorTooltip"),title:this.nls("highlightColorTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline"},(0,e.jsx)(T,null))),(0,e.jsx)(A.ThemeColorPicker,{"aria-label":this.nls("highlightColor"),specificTheme:(0,M.getTheme2)(),value:this.state.highlightColor?this.state.highlightColor:"#00FFFF",onChange:e=>{this.onHighlightColorChange(e)}})),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{"aria-label":this.nls("noResultsFoundLabel"),title:this.nls("noResultsFoundLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("noResultsFoundLabel"))),(0,e.jsx)(R,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.noResultsFoundMessage,noResultFound:"noResultFound",textStyle:this.props.config.noResultMsgStyleSettings,onTextMessageChange:this.updateTextMessage,onTextFormatChange:this.updateOnTextStyleChange})),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{"aria-label":this.nls("promptMessageLabel"),title:this.nls("promptMessageLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"w-100 flex-grow-1 title3 hint-default"},this.nls("promptMessageLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("promptMessageLabelToolTip"),title:this.nls("promptMessageLabelToolTip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default ml-2 d-inline"},(0,e.jsx)(T,null)))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(R,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.promptMessage,promptTextMessage:"promtMessage",textStyle:this.props.config.promptTextMsgStyleSettings,onTextMessageChange:this.updateTextMessage,onTextFormatChange:this.updateOnTextStyleChange})))}}const E=[{value:"feet",label:"Feet"},{value:"meters",label:"Meters"},{value:"kilometers",label:"Kilometers"},{value:"miles",label:"Miles"},{value:"yards",label:"Yards"}],G=[d.Closest,d.Proximity,d.Summary],P="#f507f5",V="#FFFFFF00",U=[{analysisId:"",analysisType:G[0],highlightResultsOnMap:!0,highlightColorOnMap:P,expandOnOpen:!0,fieldsToExport:[],includeApproxDistance:!1},{analysisId:"",analysisType:G[1],displayField:"",sortFeaturesByDistance:!0,sortFeatures:{sortFeaturesByField:"",sortFeaturesOrder:"ASC"},groupFeaturesEnabled:!1,groupFeatures:{groupFeaturesByField:"",groupFeaturesOrder:"ASC",sortGroupsByCount:!1,noValueGroupLabel:""},subGroupFeatures:{subGroupFeaturesByField:"",subGroupFeaturesOrder:"ASC",sortSubGroupsByCount:!1,noValueSubGroupLabel:""},highlightResultsOnMap:!0,highlightColorOnMap:P,expandOnOpen:!1,expandFeatureDetails:!1,fieldsToExport:[],includeApproxDistance:!1},{analysisId:"",analysisType:G[2],isSingleColorMode:!0,singleFieldColor:V,summaryFields:[],highlightResultsOnMap:!0,highlightColorOnMap:P,expandOnOpen:!1,fieldsToExport:[]}],z={analysisSettings:{layersInfo:[],displayFeatureCount:!0,displayAnalysisIcon:!1,displayMapSymbols:!1,showDistFromInputLocation:!0,onlyShowLayersResult:!1},searchSettings:{headingLabel:"",bufferDistance:1,distanceUnits:"",showDistanceSettings:!0,sketchTools:{showPoint:!0,showPolyline:!0,showPolygon:!0},searchByActiveMapArea:!1,includeFeaturesOutsideMapArea:!1,headingLabelStyle:{fontFamily:"Avenir Next",fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1,fontColor:"var(--black)",fontSize:"13px"},showInputAddress:!0}};var W,_;!function(e){e.NoFormatting="noFormatting",e.Round="round",e.Truncate="truncate"}(W||(W={})),function(e){e.SumOfIntersectedArea="sumOfIntersectedArea",e.SumOfIntersectedLength="sumOfIntersectedLength"}(_||(_={}));_.SumOfIntersectedLength,W.NoFormatting,_.SumOfIntersectedArea,W.NoFormatting;var H;!function(e){e.SingleColor="singleColor",e.ByCategory="byCategory"}(H||(H={}));const J=["#5E8FD0","#77B484","#DF6B35","#DBCF4E","#41546D","#8257C2","#D6558B"],$=[J,["#596A90","#85C2E4","#DEB3D9","#9FB6E1","#BBE4EF","#C5B2E1","#8482D0"],["#A6382F","#47707A","#F0CF35","#D18332","#B9C143","#E38B67","#AAC86A"],["#E49DAF","#B1F2D0","#F5F49A","#94CAFC","#E9C7A3","#C9A7E8","#DDF3AA"],["#004CA3","#005ECA","#076FE5","#2C8FFF","#65ADFF","#ACD3FF","#E6F2FF"],["#7D5D00","#AA7F00","#DDA400","#FFC300","#FFCE2F","#FFDE72","#FFEDB1"],["#4E427E","#6A5A9E","#8E7AC3","#A293D9","#B0A3E7","#C4B7EB","#DFD9F1"],["#BA4300","#ED5500","#FF7121","#FF8D4C","#FFA878","#FFC4A3","#FFE0CE"]];var K=m(74919),q=m.n(K),Z=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Y=t=>{const s=window.SVG,{className:i}=t,a=Z(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:q()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var Q=m(86058),X=m.n(Q),ee=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const te=t=>{const s=window.SVG,{className:i}=t,a=ee(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:X()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var se=m(42588),ie=m.n(se),ae=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const le=t=>{const s=window.SVG,{className:i}=t,a=ae(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:ie()},a)):e.React.createElement("svg",Object.assign({className:l},a))};class oe extends e.React.PureComponent{constructor(t){var s,a,o;if(super(t),this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onHeadingLabelChange=e=>{this.setState({headingLabelText:e})},this.onHeadingLabelAcceptValue=e=>{this.props.onSearchSettingsUpdated("headingLabel",e)},this.updateOnHeadingStyleChange=e=>{this.props.onSearchSettingsUpdated("headingLabelStyle",e)},this.onIncludeFeaturesMapAreaToggleChange=e=>{this.setState({includeFeaturesMapAreaOption:e.target.checked},(()=>{this.props.onSearchSettingsUpdated("includeFeaturesOutsideMapArea",this.state.includeFeaturesMapAreaOption),this.setState({headingLabelText:e.target.checked?this.nls("disabledDefineSearchAreaLabel"):this.nls("currentMapAreaLabel")},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)}),100)}))}))},this.onDistanceUnitChange=e=>{const t=((e,t)=>{const s=b(t);return e>s?s:e})(this.state.bufferDistance,e.target.value);this.props.onSearchSettingsUpdated("bufferDistance",t),this.setState({distanceUnits:e.target.value,bufferDistance:t},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("distanceUnits",this.state.distanceUnits)}),50)}))},this.onBufferDistanceChange=e=>{this.setState({bufferDistance:null!=e?e:1},(()=>{this.props.onSearchSettingsUpdated("bufferDistance",this.state.bufferDistance)}))},this.handleSearchByChange=e=>{let t="";t=e?this.state.includeFeaturesMapAreaOption?this.nls("disabledDefineSearchAreaLabel"):this.nls("currentMapAreaLabel"):this.nls("locationLabel"),this.setState({headingLabelText:t},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)}),100)})),this.props.onSearchSettingsUpdated("searchByActiveMapArea",e)},this.onToggleInputs=()=>{this.setState({isInputSettingOpen:!this.state.isInputSettingOpen})},this.onShowDistanceSettingsChange=e=>{this.setState({showDistanceSettings:e.target.checked},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("showDistanceSettings",this.state.showDistanceSettings)}),50)}))},this.sketchToolsObj=(e,t,s)=>{const i={showPoint:e,showPolyline:t,showPolygon:s};this.props.onSearchSettingsUpdated("sketchTools",i)},this.showSketchTools=e=>{e.target.title===this.nls("point")&&this.setState({showPoint:e.target.checked},(()=>{this.sketchToolsObj(this.state.showPoint,this.state.showPolyline,this.state.showPolygon)})),e.target.title===this.nls("polyline")&&this.setState({showPolyline:e.target.checked},(()=>{this.sketchToolsObj(this.state.showPoint,this.state.showPolyline,this.state.showPolygon)})),e.target.title===this.nls("polygon")&&this.setState({showPolygon:e.target.checked},(()=>{this.sketchToolsObj(this.state.showPoint,this.state.showPolyline,this.state.showPolygon)}))},this.onShowInputAddressSettingsChange=e=>{this.setState({showInputAddress:e.target.checked},(()=>{this.props.onSearchSettingsUpdated("showInputAddress",this.state.showInputAddress)}))},this.props.config){const t=""!==this.props.config.distanceUnits?this.props.config.distanceUnits:(()=>{const t=(0,e.getAppStore)().getState().portalSelf;return"english"===(null==t?void 0:t.units)?"miles":"kilometers"})();this.state={headingLabelText:this.props.config.headingLabel,bufferDistance:this.props.config.bufferDistance,distanceUnits:t,showDistanceSettings:this.props.config.showDistanceSettings,includeFeaturesMapAreaOption:this.props.config.includeFeaturesOutsideMapArea,showPoint:null===(s=this.props.config.sketchTools)||void 0===s?void 0:s.showPoint,showPolyline:null===(a=this.props.config.sketchTools)||void 0===a?void 0:a.showPolyline,showPolygon:null===(o=this.props.config.sketchTools)||void 0===o?void 0:o.showPolygon,showInputAddress:this.props.config.showInputAddress,isInputSettingOpen:!1}}}render(){return(0,e.jsx)("div",{css:(s=this.props.theme,e.css`
    .cursor-pointer {
      cursor: pointer;
    }

    .switchLabelWidth {
      width: calc(100% - 28px);
    }

    .nm-divider-top {
      border-top: 1px solid var(--ref-palette-neutral-700)
    }

    .color-label {
      color: ${s.ref.palette.neutral[900]};
    }

    .onlyShowResultsLabel {
      width: calc(100% - 52px);
    }
  `),style:{height:"100%",width:"100%"}},(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("searchByActiveMapArea"),className:"cursor-pointer",value:"searchByActiveMapArea",onChange:()=>{this.handleSearchByChange(!0)},checked:this.props.config.searchByActiveMapArea}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{!this.props.config.searchByActiveMapArea&&this.handleSearchByChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!0)}},this.nls("searchByActiveMapArea")))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("searchByLocation"),className:"cursor-pointer",value:"searchByLocation",onChange:()=>{this.handleSearchByChange(!1)},checked:!this.props.config.searchByActiveMapArea}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.props.config.searchByActiveMapArea&&this.handleSearchByChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!1)}},this.nls("searchByLocation")))),(0,e.jsx)(t.SettingRow,{className:"ml-2",flow:"wrap"},(0,e.jsx)(i.Label,{"aria-label":this.nls("headingLabel"),title:this.nls("headingLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("headingLabel"))),(0,e.jsx)(R,{intl:this.props.intl,theme:this.props.theme,hintMessage:this.state.headingLabelText,noResultFound:"noResultFound",textStyle:this.props.config.headingLabelStyle,onTextMessageChange:this.onHeadingLabelAcceptValue,onTextFormatChange:this.updateOnHeadingStyleChange})),this.props.config.searchByActiveMapArea&&(0,e.jsx)(t.SettingRow,{className:"ml-2",label:this.nls("featuresOutsideMapArea")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("featuresOutsideMapArea"),title:this.nls("featuresOutsideMapArea"),checked:this.state.includeFeaturesMapAreaOption,onChange:this.onIncludeFeaturesMapAreaToggleChange})),this.state.includeFeaturesMapAreaOption&&this.props.config.searchByActiveMapArea&&(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("searchAreaHint"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default"},this.nls("searchAreaHint")))),!this.props.config.searchByActiveMapArea&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:"mt-4 ml-2",flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("bufferDistance"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("bufferDistance"))),(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("bufferDistance"),style:{width:"240px"},size:"sm",min:0,max:b(this.state.distanceUnits),defaultValue:this.state.bufferDistance,value:this.state.bufferDistance,onChange:this.onBufferDistanceChange})),(0,e.jsx)(t.SettingRow,{className:"ml-2",flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("distanceUnits"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("distanceUnits"))),(0,e.jsx)(i.Select,{style:{marginBottom:"1px"},"aria-label":this.nls("distanceUnits")+" "+this.state.distanceUnits,size:"sm",value:this.state.distanceUnits,onChange:e=>{this.onDistanceUnitChange(e)}},E.map(((t,s)=>(0,e.jsx)(i.Option,{role:"option",tabIndex:0,"aria-label":t.label,value:t.value,key:s},this.nls(t.value)))))),(0,e.jsx)(t.SettingRow,{className:"border-top pt-3"},(0,e.jsx)(i.CollapsablePanel,{label:this.nls("inputsCollapsible"),isOpen:this.state.isInputSettingOpen,onRequestOpen:()=>{this.onToggleInputs()},onRequestClose:()=>{this.onToggleInputs()}},(0,e.jsx)("div",{style:{height:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("showDistanceSettings"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showDistanceSettings,onChange:this.onShowDistanceSettingsChange.bind(this)}),this.nls("showDistanceSettings"))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("inputAddress"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showInputAddress,onChange:this.onShowInputAddressSettingsChange.bind(this)}),this.nls("inputAddress"))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{title:this.nls("showSketchTools"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1"},this.nls("showSketchTools")))),(0,e.jsx)(t.SettingRow,{className:"mt-2 mx-2"},(0,e.jsx)(Y,{size:"m"}),(0,e.jsx)(i.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"}},this.nls("point"),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("point"),title:this.nls("point"),checked:this.state.showPoint,onChange:this.showSketchTools}))),(0,e.jsx)(t.SettingRow,{className:"mt-1 mx-2"},(0,e.jsx)(te,{size:"m"}),(0,e.jsx)(i.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"}},this.nls("polyline"),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("polyline"),title:this.nls("polyline"),checked:this.state.showPolyline,onChange:this.showSketchTools}))),(0,e.jsx)(t.SettingRow,{className:"mt-1 mx-2"},(0,e.jsx)(le,{size:"m"}),(0,e.jsx)(i.Label,{className:"ml-2 w-100 justify-content-between",check:!0,centric:!0,style:{cursor:"pointer"}},this.nls("polygon"),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("polygon"),title:this.nls("polygon"),checked:this.state.showPolygon,onChange:this.showSketchTools})))))))));var s}}var ne=m(62838),re=m.n(ne),de=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const pe=t=>{const s=window.SVG,{className:i}=t,a=de(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:re()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var he=m(98640),ue=m(28996),ce=m.n(ue),me=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const ye=t=>{const s=window.SVG,{className:i}=t,a=me(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:ce()},a)):e.React.createElement("svg",Object.assign({className:l},a))};class ge extends e.React.PureComponent{constructor(t){super(t),this.analysisSettingPopperTrigger=e.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{1===this.state.addedLayerAnalysis.length&&this.setState({selectedAnalysis:this.props.addedLayerAnalysis.length-1})},this.componentDidUpdate=e=>{var t,s,i,a;(null===(t=null==e?void 0:e.addedLayerAnalysis)||void 0===t?void 0:t.length)!==(null===(i=null===(s=this.props)||void 0===s?void 0:s.addedLayerAnalysis)||void 0===i?void 0:i.length)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis,selectedAnalysis:this.props.addedLayerAnalysis.length-1}),(null==e?void 0:e.addedLayerAnalysis)!==(null===(a=this.props)||void 0===a?void 0:a.addedLayerAnalysis)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis})},this.onAnalysisOrderChanged=e=>{let t=-1;this.props.editCurrentLayer&&(t=e.findIndex((e=>{var t;return(null===(t=null==e?void 0:e.useDataSource)||void 0===t?void 0:t.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType})),this.setState({selectedAnalysis:t})),this.setState({addedLayerAnalysis:e},(()=>{this.props.onLayersInfoSettingsUpdated(this.state.addedLayerAnalysis,this.props.analysisIndex,this.props.editCurrentLayer.layerDsId,this.props.editCurrentLayer.analysisType)}))},this.onEditAction=(e,t,s)=>{this.props.onEditAction(!0,e,t,s),this.state.addedLayerAnalysis.some(((e,t)=>s===t&&(this.setState({selectedAnalysis:s}),!0)))},this.onRemoveAction=(e,t,s,i)=>{e.stopPropagation();const a=this.state.addedLayerAnalysis;a.splice(i,1);let l=-1;this.props.editCurrentLayer&&(l=a.findIndex((e=>e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType)),this.setState({selectedAnalysis:l})),this.setState({addedLayerAnalysis:a},(()=>{this.props.onDeleteAction(this.state.addedLayerAnalysis,t,s,l)}))},this.createAnalysisItem=(t,s)=>{var a,l;return(0,e.jsx)("div",{className:(0,e.classNames)("flex-grow-1 analysis-item cursor-pointer"),key:s},(0,e.jsx)("div",{className:"d-flex w-100 justify-content-between align-items-center"},(0,e.jsx)("div",{className:"layer-analysis-name text-truncate",title:t.label},t.label),this.props.isActiveMapAreaSelected&&t.analysisInfo.analysisType===d.Closest&&(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("warningMsgIfActiveMapArea"),title:this.nls("warningMsgIfActiveMapArea"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(ye,{color:"var(--warning-700)"}))),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onRemoveAction(e,t.useDataSource.dataSourceId,t.analysisInfo.analysisType,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onRemoveAction(e,t.useDataSource.dataSourceId,t.analysisInfo.analysisType,s)}},(0,e.jsx)(pe,{size:"s",className:"p-0"}))),(0,e.jsx)("div",{className:"hint-paper d-flex align-items-center analysis-type-name"},(0,e.jsx)("div",{className:"w-100 text-truncate",title:this.nls(null===(a=null==t?void 0:t.analysisInfo)||void 0===a?void 0:a.analysisType)},this.nls(null===(l=null==t?void 0:t.analysisInfo)||void 0===l?void 0:l.analysisType))))},this.getLayersInfoList=()=>{var t;return(0,e.jsx)("div",{className:"nearme-analysis-list-items"},(0,e.jsx)(he.List,{itemsJson:null===(t=Array.from(this.state.addedLayerAnalysis?this.state.addedLayerAnalysis:null))||void 0===t?void 0:t.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:this.props.showEditAnalysisPopper&&this.state.selectedAnalysis===t}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this.onAnalysisOrderChanged(a)},onClickItemBody:(e,t)=>{var s;const{itemJsons:i}=t.props,a=i[0],l=i[1],o=a.itemStateDetailContent;this.onEditAction(null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,o.analysisInfo.analysisType,l.indexOf(a))},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:he.TreeItemActionType.RenderOverrideItem,children:[{name:he.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:he.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:he.TreeItemActionType.RenderOverrideItemBody,children:[{name:he.TreeItemActionType.RenderOverrideItemDragHandle},{name:he.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createAnalysisItem(i.itemStateDetailContent,a.indexOf(i))}}))},this.state={selectedAnalysis:this.props.analysisIndex?this.props.analysisIndex:-1,addedLayerAnalysis:this.props.addedLayerAnalysis}}render(){return(0,e.jsx)(e.React.Fragment,null,this.getLayersInfoList())}}var fe=m(12046),Se=m.n(fe),xe=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const be=t=>{const s=window.SVG,{className:i}=t,a=xe(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:Se()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var ve=m(93303),Fe=m.n(ve),Ce=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const we=t=>{const s=window.SVG,{className:i}=t,a=Ce(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:Fe()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var Ie=m(37568),Le=m.n(Ie),Ae=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Oe=t=>{const s=window.SVG,{className:i}=t,a=Ae(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:Le()},a)):e.React.createElement("svg",Object.assign({className:l},a))};class je extends e.React.PureComponent{constructor(){super(...arguments),this.backRef=e.React.createRef(),this.nls=t=>{var s;const a=Object.assign({},l,i.defaultMessages,e.defaultMessages);return(null===(s=this.props.intl)||void 0===s?void 0:s.formatMessage)?this.props.intl.formatMessage({id:t,defaultMessage:a[t]}):a[t]},this.backRefFocus=()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.backRef)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),50)},this.onOkButtonClick=()=>{this.props.onOkButtonClicked()}}getStyle(t){var s,i;return e.css`
      .setting-header {
        padding: ${e.polished.rem(18)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .setting-title {
        font-size: ${e.polished.rem(16)};
        color: ${null===(i=null===(s=null==t?void 0:t.ref.palette)||void 0===s?void 0:s.neutral)||void 0===i?void 0:i[1e3]}
      }

      .commonOkButton {
        padding: 9px 17px 0px 17px;
      }

      .hideCursorPointer {
        cursor: default;
      }
    `}render(){return(0,e.jsx)("div",{tabIndex:-1,className:"w-100 h-100",css:this.getStyle(this.props.theme)},(0,e.jsx)("div",{tabIndex:-1,className:"w-100 d-flex align-items-center justify-content-between setting-header border-0",style:{height:"38px",marginBottom:"20px"}},this.props.hideBackArrow?(0,e.jsx)("div",{"aria-label":this.props.title,className:"setting-title mt-1",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title):(0,e.jsx)("div",{tabIndex:-1,className:"h-100"},(0,e.jsx)("div",{ref:this.backRef,tabIndex:0,className:"d-flex align-items-center h-100",style:{cursor:"pointer"},onClick:this.props.onBack,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.onBack()}},(0,e.jsx)("div",{className:"d-flex align-items-center",title:this.nls("back"),"aria-label":this.nls("back")},(0,e.jsx)(Oe,{autoFlip:!0,size:"14",className:"text-default"})),(0,e.jsx)("div",{"aria-label":this.props.title,className:"pl-2 setting-title",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title))),this.props.showCloseIcon&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.props.title+" "+this.nls("close"),title:this.nls("close"),size:"sm",icon:!0,type:"tertiary",onClick:this.props.onBack},(0,e.jsx)(pe,{autoFlip:!0,size:"14",className:"text-default"}))),this.props.children,this.props.showOkButton&&(0,e.jsx)("div",{className:"commonOkButton"},(0,e.jsx)(i.Button,{role:"button",className:(0,e.classNames)("w-100 text-dark",this.props.disableOkButton?"hideCursorPointer":""),type:"primary",disabled:this.props.disableOkButton,onClick:this.onOkButtonClick.bind(this)},this.nls("commonModalOk"))))}}const De=e.css`
  padding: 12px 0px;
  .jimu-dropdown-item {
    padding: 4px 16px !important;
    &:hover {
      background-color: var(--ref-palette-neutral-500) !important;
    }
  }
`,Te=e.css`
  display: flex;
  width: 100%;
  > .color-item {
    width: 30px;
    height: 16px;
  }
`;class Me extends e.React.PureComponent{constructor(t){super(t),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.setState({colorUpdate:this.getFieldsColor()})},this.componentDidUpdate=e=>{if(e.summaryFieldsInfo!==this.props.summaryFieldsInfo){const e=Object.assign({},this.state.colorUpdate);this.props.summaryFieldsInfo.forEach(((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor}})),this.setState({colorUpdate:e})}},this.getFieldsColor=()=>{const e={};return this.props.summaryFieldsInfo.forEach(((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor===V?this.state.colorStrip[s%this.state.colorStrip.length]:t.fieldColor}})),e},this.onStripColorChange=(t,s)=>{t.stopPropagation();const i=((t,s)=>{if(!s)return;let i=(0,e.Immutable)({});return Object.entries(t).forEach((([e,t],a)=>{const l=f(s,a),o=Object.assign({},t);o._fillColor=l,i=i.set(e,o)})),i})(this.state.colorUpdate,s);this.setState({colorUpdate:i,colorStrip:s},(()=>{this.props.updateFieldColorsValues(i,s)}))},this.onIndividualFieldColorChange=(e,t)=>{const s=Object.assign({},this.state.colorUpdate);s[e]={_fillColor:t},this.setState({colorUpdate:s},(()=>{this.props.updateFieldColorsValues(s,this.state.colorStrip)}))},this.state={colorUpdate:null,colorStrip:this.props.colorstripValue?this.props.colorstripValue:J}}render(){var t;return(0,e.jsx)("div",{style:{width:"100%",overflow:"auto"},css:r},(0,e.jsx)("div",{className:"color-list pt-1 px-4"},this.state.colorUpdate&&(null===(t=Object.entries(this.state.colorUpdate))||void 0===t?void 0:t.map((([t,s],a)=>{const l=s;return(0,e.jsx)("div",{className:"mb-2 colorItemStyle",key:a},(0,e.jsx)(i.Label,{check:!0},(0,e.jsx)("span",{className:"label text-truncate",title:l._fieldLabel},l._fieldLabel),(0,e.jsx)(A.ThemeColorPicker,{"aria-label":l._fieldLabel,specificTheme:(0,M.getTheme2)(),value:l._fillColor,onChange:e=>{this.onIndividualFieldColorChange(t,e)}})))})))),(0,e.jsx)("div",{className:"footer"},(0,e.jsx)("div",{className:"px-4",style:{marginTop:"14px"}},(0,e.jsx)(i.Dropdown,{className:"w-100"},(0,e.jsx)(i.DropdownButton,{size:"sm",title:this.nls("applyColors")},this.nls("applyColors")),(0,e.jsx)(i.DropdownMenu,{showArrow:!0,css:De},(0,e.jsx)("div",{tabIndex:0},$.map(((t,s)=>(0,e.jsx)(i.DropdownItem,{tabIndex:0,className:"my-1",key:s,onClick:e=>{var s;null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)},onKeyDown:e=>{var s;"Enter"!==e.key&&" "!==e.key||null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)}},(0,e.jsx)("div",{tabIndex:0,"aria-label":this.nls("colorStrip")+s,css:Te},t.map(((t,s)=>(0,e.jsx)("div",{className:"color-item",key:s,style:{backgroundColor:t}})))))))))))))}}var Ne=m(13089),ke=m(14962),Re=m.n(ke),Be=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Ee=t=>{const s=window.SVG,{className:i}=t,a=Be(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:Re()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var Ge=m(54578),Pe=m.n(Ge),Ve=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const Ue=t=>{const s=window.SVG,{className:i}=t,a=Ve(t,["className"]),l=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:l,src:Pe()},a)):e.React.createElement("svg",Object.assign({className:l},a))};var ze=m(84845);class We extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},l);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.handleExpressionChange=e=>{null!=e&&(e.parts.forEach((e=>{var t;e.dataSourceId&&(e.dataSourceId=null===(t=this.state.useDataSource)||void 0===t?void 0:t[0].dataSourceId)})),this.setState({updatedFieldExpression:e}),this.updateSummaryField(e.name,e))},this.updateSummaryField=(e,t)=>{const s={fieldLabel:e,selectedExpression:t};this.props.expressionInfoUpdate(s)};const t=S(this.props.currentLayerDsId.layerDsId),s=[{dataSourceId:t.id,mainDataSourceId:t.id,rootDataSourceId:t.parentDataSource.id}];this.state={useDataSource:s,updatedFieldExpression:null!==this.props.fieldsEditIndex?this.props.editingField.summaryFieldInfo:null}}render(){var t;return(0,e.jsx)(ze.ExpressionBuilder,{className:"p-2",css:(this.props.theme,e.css`
    .component-main-data-and-view {
      display: none;
    }

    .component-expression-builder .expression-editor-helper {
      height: calc(100% - 25px)!important;
    }

    .component-expression-builder .statistics-tab div {
      padding-top: 0px!important;
    }

    .expression-editor-container div {
      padding: 0px!important;
    }

    .component-expression-editor .exp-editor-helper-tab {
      margin-left: 0px!important;
      margin-right: 0px!important;
    }

    .component-field-selector .item-selector-search {
      margin-top: 18px!important;
    }
  `),fieldTypes:(0,e.Immutable)([e.JimuFieldType.Number]),widgetId:this.props.widgetId,types:(0,e.Immutable)([ze.ExpressionBuilderType.Statistics,ze.ExpressionBuilderType.Expression]),useDataSources:(0,e.Immutable)([null===(t=this.state.useDataSource)||void 0===t?void 0:t[0]]),expression:this.state.updatedFieldExpression,onChange:this.handleExpressionChange})}}class _e extends e.React.PureComponent{constructor(e){var t,s,a,o;super(e),this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onFieldLabelChange=e=>{const t=e.target.value;this.setState({summaryFieldLabel:t})},this.onFieldLabelAcceptValue=e=>{this.setState({summaryFieldLabel:e.trim()})},this.onOkButtonClicked=()=>{""!==this.state.summaryFieldLabel&&(this.setState({isEditSummaryPopperActive:!1}),this.props.onOkClick(this.state.summaryFieldLabel,this.state.showThousandSeparator,this.state.formattingOptions,this.state.significantDigit),this.props.onClose())},this.onCancelButtonClicked=()=>{this.setState({isEditSummaryPopperActive:!1}),this.props.onClose()},this.onSeparatorChange=e=>{this.setState({showThousandSeparator:e.target.checked})},this.handleFormattingChange=e=>{this.setState({formattingOptions:e.target.value}),e.target.value!==W.Round&&e.target.value!==W.Truncate||this.setState({significantDigit:2})},this.onDigitsChange=e=>{const t=Math.floor(e);this.setState({significantDigit:t})},this.state={isEditSummaryPopperActive:this.props.isOpen,showThousandSeparator:null===(t=this.props.editSummaryFields.summaryFieldInfo)||void 0===t?void 0:t.showSeparator,summaryFieldLabel:null===(s=this.props.editSummaryFields)||void 0===s?void 0:s.fieldLabel,formattingOptions:null===(a=this.props.editSummaryFields.summaryFieldInfo)||void 0===a?void 0:a.numberFormattingOption,significantDigit:null===(o=this.props.editSummaryFields.summaryFieldInfo)||void 0===o?void 0:o.significantDigits}}render(){const t=e.css`
      .hidden{
        display: none;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .separatorSwitch {
        margin-left: 130px;
      }

      .modal-content  {
        background: var(--ref-palette-neutral-400);
      }

      .invalid-value {
        border: 1px solid  ${this.props.theme.sys.color.error.main};
        box-shadow: 0 0 5px  ${this.props.theme.sys.color.error.main};
      }
    `;return(0,e.jsx)("div",null,(0,e.jsx)(i.AlertPopup,{css:t,"aria-expanded":this.state.isEditSummaryPopperActive,isOpen:this.state.isEditSummaryPopperActive,onClickOk:this.onOkButtonClicked.bind(this),onClickClose:this.onCancelButtonClicked.bind(this),title:this.props.sumOfIntersectedFieldPopupTitle},(0,e.jsx)("table",{cellPadding:10},(0,e.jsx)("tbody",null,(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"mt-2"},this.nls("label"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.TextInput,{role:"textbox","aria-label":this.nls("label")+this.state.summaryFieldLabel,size:"sm",title:this.state.summaryFieldLabel,className:""===this.state.summaryFieldLabel?"invalid-value":"",value:this.state.summaryFieldLabel,onAcceptValue:this.onFieldLabelAcceptValue,onChange:this.onFieldLabelChange}))),(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"mt-2"},this.nls("showSeparator"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.Switch,{className:"separatorSwitch",role:"switch","aria-label":this.nls("showSeparator"),title:this.nls("showSeparator"),checked:this.state.showThousandSeparator,onChange:this.onSeparatorChange}))),(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("noFormatting"),className:"cursor-pointer",value:"noFormatting",onChange:e=>{this.handleFormattingChange(e)},checked:"noFormatting"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("noFormatting")))),(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("round"),className:"cursor-pointer",value:"round",onChange:e=>{this.handleFormattingChange(e)},checked:"round"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("round")))),(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("truncate"),className:"cursor-pointer",value:"truncate",onChange:e=>{this.handleFormattingChange(e)},checked:"truncate"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("truncate"))))),"noFormatting"!==this.state.formattingOptions&&(0,e.jsx)("tr",null,(0,e.jsx)("td",{tabIndex:0,"aria-label":this.nls("significantDigitsLabel")},(0,e.jsx)(i.Label,null,this.nls("significantDigitsLabel"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("significantDigitsLabel"),className:"significantDigitsLabel",size:"sm",min:0,max:10,defaultValue:this.state.significantDigit,value:this.state.significantDigit,onChange:this.onDigitsChange})))))))}}const He=m(27931);let Je=[];class $e extends e.React.PureComponent{constructor(s){super(s),this.supportedDsTypes=(0,e.Immutable)([Ne.AllDataSourceTypes.FeatureLayer]),this.items=[],this.backRef=e.React.createRef(),this.colorSidePopperTrigger=e.React.createRef(),this.colorButtonRef=e.React.createRef(),this.addSummaryFieldsRef=e.React.createRef(),this.summaryFieldsSidePopperTrigger=e.React.createRef(),this.allSelectedLayers=[],this.defaultSelectedItem={name:""},this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.availableFeatureLayer.forEach(((e,t)=>{this.getLayerListProperty(e.id)})),this.setState({selectedLayers:this.allSelectedLayers}),this.editValueUpdate(!1)},this.getLayerListProperty=e=>{const t=S(e);if(t){const e={label:t.getLabel(),layer:{layerDsId:t.id}};this.allSelectedLayers.push(e)}},this.componentDidUpdate=(t,s)=>{this.props.editCurrentLayer.layerDsId===t.editCurrentLayer.layerDsId&&this.props.analysisIndex===t.analysisIndex&&e.lodash.isDeepEqual(this.props.analysisList,t.analysisList)||this.editValueUpdate(!1),e.lodash.isDeepEqual(this.state.analysisListSettings,s.analysisListSettings)||this.editValueUpdate(!0)},this.intersectedAreaLengthField=(e,t)=>(e.push({fieldLabel:t.fieldLabel,fieldColor:t.fieldColor,summaryFieldInfo:{summaryBy:t.summaryFieldInfo.summaryBy,showSeparator:t.summaryFieldInfo.showSeparator,numberFormattingOption:t.summaryFieldInfo.numberFormattingOption,significantDigits:t.summaryFieldInfo.significantDigits}}),e),this.setSummaryValues=e=>{let t=[];e.summaryFields.forEach((e=>{var s,i;this.setState({singleColorFields:e.fieldColor}),(null===(s=e.summaryFieldInfo)||void 0===s?void 0:s.summaryBy)===_.SumOfIntersectedArea?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfAreaLabel:e.fieldLabel,sumOfArea:!0,intersectedSummaryFieldList:t})):(null===(i=e.summaryFieldInfo)||void 0===i?void 0:i.summaryBy)===_.SumOfIntersectedLength?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfLengthLabel:e.fieldLabel,sumOfLength:!0,intersectedSummaryFieldList:t})):Je.push({fieldLabel:e.fieldLabel,fieldColor:e.fieldColor,summaryFieldInfo:e.summaryFieldInfo})}))},this.editValueUpdate=e=>{Je=[],this.getFieldsDs(this.props.editCurrentLayer.layerDsId);(e?this.state.analysisListSettings:this.props.analysisList).forEach(((e,t)=>{var s,i,a,l,o;const n=e.analysisInfo,r=S(null===(s=e.useDataSource)||void 0===s?void 0:s.dataSourceId);if((null===(i=null==e?void 0:e.useDataSource)||void 0===i?void 0:i.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Closest&&this.props.analysisIndex===t)return this.props.disableOkButton(e.analysisInfo.analysisType===d.Closest&&this.props.isActiveMapAreaSelected),this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,highlightResultsOnMap:n.highlightResultsOnMap,highlightColorOnMap:n.highlightColorOnMap,expandOnOpen:n.expandOnOpen,fieldsToExport:null==n?void 0:n.fieldsToExport,includeApproxDistance:n.includeApproxDistance}),!0;if((null===(a=e.useDataSource)||void 0===a?void 0:a.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Proximity&&this.props.analysisIndex===t)return this.props.disableOkButton(!1),this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,displayField:n.displayField?[n.displayField]:[F(null==r?void 0:r.layerDefinition)],sortFeaturesByDistance:n.sortFeaturesByDistance,sortFeaturesField:n.sortFeatures.sortFeaturesByField?[n.sortFeatures.sortFeaturesByField]:[],sortFeaturesFieldOrder:n.sortFeatures.sortFeaturesOrder,isGroupFeatures:n.groupFeaturesEnabled,groupFeaturesField:n.groupFeatures.groupFeaturesByField?[n.groupFeatures.groupFeaturesByField]:[],groupFeaturesFieldOrder:n.groupFeatures.groupFeaturesOrder,isSortGroupsByCount:n.groupFeatures.sortGroupsByCount,noValueGroupLabel:n.groupFeatures.noValueGroupLabel,subGroupFeaturesField:n.subGroupFeatures.subGroupFeaturesByField?[n.subGroupFeatures.subGroupFeaturesByField]:[],subGroupFeaturesFieldOrder:n.subGroupFeatures.subGroupFeaturesOrder,isSortSubGroupsByCount:n.subGroupFeatures.sortSubGroupsByCount,noValueSubGroupLabel:n.subGroupFeatures.noValueSubGroupLabel,expandOnOpen:n.expandOnOpen,expandFeatureDetails:n.expandFeatureDetails,highlightResultsOnMap:n.highlightResultsOnMap,highlightColorOnMap:n.highlightColorOnMap,fieldsToExport:null==n?void 0:n.fieldsToExport,includeApproxDistance:n.includeApproxDistance}),!0;if((null===(l=e.useDataSource)||void 0===l?void 0:l.dataSourceId)===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Summary&&this.props.analysisIndex===t){this.props.disableOkButton(!1),this.setEditIndex=t;const s=S(this.props.editCurrentLayer.layerDsId);return this.updateSummaryFieldListSettings=n.summaryFields,n.summaryFields.length>0&&this.setSummaryValues(n),this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,singleColorMode:n.isSingleColorMode,colorstripValues:n.selectedColorStrip||J,singleColorFields:n.summaryFields.length>0?n.singleFieldColor:V,summaryFieldsList:Je,selectedLayerGeometry:null===(o=null==s?void 0:s.layerDefinition)||void 0===o?void 0:o.geometryType,expandOnOpen:n.expandOnOpen,highlightResultsOnMap:n.highlightResultsOnMap,highlightColorOnMap:n.highlightColorOnMap,fieldsToExport:null==n?void 0:n.fieldsToExport}),!0}}))},this.updateItemValue=(e,t)=>{let s;this.state.analysisListSettings.some(((i,a)=>{var l,o,n,r,p,h;const u=S((null==t?void 0:t.dataSourceId)?null==t?void 0:t.dataSourceId:this.props.editCurrentLayer.layerDsId),c=e&&"layerLabel"in e?e.layerLabel:i.label;if(((null===(l=null==i?void 0:i.useDataSource)||void 0===l?void 0:l.dataSourceId)===(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId)&&this.state.analysisType===d.Closest&&this.props.analysisIndex===a)return this.setEditIndex=a,s={useDataSource:null!=t?t:i.useDataSource,label:c,analysisInfo:{analysisId:i.analysisInfo.analysisId,analysisType:this.state.analysisType,expandOnOpen:this.state.expandOnOpen,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap,fieldsToExport:this.state.fieldsToExport,includeApproxDistance:this.state.includeApproxDistance}},!0;if(((null===(o=i.useDataSource)||void 0===o?void 0:o.dataSourceId)===(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId)&&this.state.analysisType===d.Proximity&&this.props.analysisIndex===a){const l=i.analysisInfo,o=e&&"groupLabel"in e?e.groupLabel:(null===(n=l.groupFeatures)||void 0===n?void 0:n.noValueGroupLabel)?l.groupFeatures.noValueGroupLabel:"",d=e&&"subGroupLabel"in e?e.subGroupLabel:(null===(r=l.subGroupFeatures)||void 0===r?void 0:r.noValueSubGroupLabel)?null===(p=l.subGroupFeatures)||void 0===p?void 0:p.noValueSubGroupLabel:"";return this.setEditIndex=a,s={useDataSource:null!=t?t:i.useDataSource,label:c,analysisInfo:{analysisId:i.analysisInfo.analysisId,analysisType:this.state.analysisType,displayField:this.state.displayField.length>0?this.state.displayField[0]:F(null==u?void 0:u.layerDefinition),sortFeaturesByDistance:this.state.sortFeaturesByDistance,sortFeatures:{sortFeaturesByField:this.state.sortFeaturesField.length>0?this.state.sortFeaturesField[0]:"",sortFeaturesOrder:this.state.sortFeaturesFieldOrder},groupFeaturesEnabled:this.state.isGroupFeatures,groupFeatures:{groupFeaturesByField:this.state.groupFeaturesField.length>0?this.state.groupFeaturesField[0]:"",groupFeaturesOrder:this.state.groupFeaturesFieldOrder,sortGroupsByCount:this.state.isSortGroupsByCount,noValueGroupLabel:o},subGroupFeatures:{subGroupFeaturesByField:this.state.subGroupFeaturesField.length>0?this.state.subGroupFeaturesField[0]:"",subGroupFeaturesOrder:this.state.subGroupFeaturesFieldOrder,sortSubGroupsByCount:this.state.isSortSubGroupsByCount,noValueSubGroupLabel:d},expandOnOpen:this.state.expandOnOpen,expandFeatureDetails:this.state.expandFeatureDetails,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap,fieldsToExport:this.state.fieldsToExport,includeApproxDistance:this.state.includeApproxDistance}},!0}return(null===(h=i.useDataSource)||void 0===h?void 0:h.dataSourceId)!==(null==t?void 0:t.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==d.Summary||this.props.analysisIndex!==a?void 0:(this.setEditIndex=a,this.updateSummaryFieldListSettings=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList),s={useDataSource:null!=t?t:i.useDataSource,label:c,analysisInfo:{analysisId:i.analysisInfo.analysisId,analysisType:this.state.analysisType,isSingleColorMode:this.state.singleColorMode,singleFieldColor:this.state.singleColorFields,selectedColorStrip:this.state.colorstripValues,summaryFields:this.updateSummaryFieldListSettings,expandOnOpen:this.state.expandOnOpen,highlightResultsOnMap:this.state.highlightResultsOnMap,highlightColorOnMap:this.state.highlightColorOnMap,fieldsToExport:this.state.fieldsToExport}},!0)})),this.updateItem(this.setEditIndex,s,(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.updateItem=(e,t,s,i)=>{const a=e;if(a>-1){const e=[...this.props.analysisList.slice(0,a),Object.assign({},this.props.analysisList[a],t),...this.props.analysisList.slice(a+1)];this.props.onAnalysisUpdate(e,s,i,a),this.setState({analysisListSettings:e})}},this.onAnalysisTypeChange=e=>{this.props.disableOkButton(!1),e===d.Closest?this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,expandOnOpen:!0}):e===d.Proximity?this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,expandOnOpen:!1,expandFeatureDetails:!1}):this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,expandOnOpen:!1}),this.resetAnalysisValues(this.state.useDataSource),this.setState({analysisType:e},(()=>{this.updateItemValue()}))},this.onLayerLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({layerLabel:t})}},this.onLayerLabelAcceptValue=e=>{const t={layerLabel:e};this.updateItemValue(t,this.state.useDataSource)},this.handleSortFeaturesOptionsChange=e=>{this.setState({sortFeaturesByDistance:e},(()=>{this.updateItemValue()}))},this.onDisplayField=e=>{0===e.length?this.setState({displayField:[]},(()=>{this.updateItemValue()})):this.setState({displayField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onSortFieldSelectChange=e=>{0===e.length?this.setState({sortFeaturesField:[]},(()=>{this.updateItemValue()})):this.setState({sortFeaturesField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onGroupFieldSelectChange=t=>{0===t.length?this.setState({groupFeaturesField:[],subGroupFeaturesField:[],subGroupFeaturesFieldOrder:e.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:""},(()=>{this.updateItemValue()})):this.setState({groupFeaturesField:[t[0].jimuName]},(()=>{this.updateItemValue()}))},this.onSubGroupFieldSelectChange=e=>{0===e.length?this.setState({subGroupFeaturesField:[]},(()=>{this.updateItemValue()})):this.setState({subGroupFeaturesField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onConfiguredFieldsChanged=e=>{var t,s;let i=[];e.length>0&&e.forEach((e=>{i.push(e.jimuName)})),i.length>0&&(null===(t=this.state.fieldsToExport)||void 0===t?void 0:t.includes("esriCTApproxDistance"))?i.push("esriCTApproxDistance"):0===i.length&&(null===(s=this.state.fieldsToExport)||void 0===s?void 0:s.includes("esriCTApproxDistance"))&&(i=this.state.fieldsToExport.filter((e=>"esriCTApproxDistance"===e))),this.setState({fieldsToExport:i},(()=>{this.updateItemValue()}))},this.expandListOnChange=e=>{!e.target.checked&&this.state.proximityAnalysisType&&this.setState({expandFeatureDetails:!1}),this.setState({expandOnOpen:e.target.checked},(()=>{this.updateItemValue()}))},this.resetAnalysisValues=t=>{var s;const i=S(t.dataSourceId);this.setState({displayField:[],sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:e.OrderRule.Asc,isGroupFeatures:!1,groupFeaturesField:[],groupFeaturesFieldOrder:e.OrderRule.Asc,isSortGroupsByCount:!1,noValueGroupLabel:"",subGroupFeaturesField:[],subGroupFeaturesFieldOrder:e.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:"",fieldsToExport:I(t.dataSourceId),includeApproxDistance:!1,selectedLayerGeometry:null===(s=null==i?void 0:i.layerDefinition)||void 0===s?void 0:s.geometryType,sumOfLength:!1,sumOfArea:!1,summaryFieldsList:[],intersectedSummaryFieldList:[],sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength")},(()=>{const e={layerLabel:this.state.layerLabel,groupLabel:"",subGroupLabel:""};this.updateItemValue(e,t)}))},this.onAddSummaryFieldsClick=e=>{e.stopPropagation(),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!0,summaryEditIndex:null},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}))},this.editSummaryFields=(e,t,s)=>{e.stopPropagation(),this.setSidePopperAnchor(s),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!1,summaryEditField:t,summaryEditIndex:s},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}))},this.setSidePopperAnchor=e=>{const t=this.summaryFieldsSidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:t})},this.deleteSummaryFields=(e,t)=>{var s,i;let a;e.stopPropagation();const l=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList);l.splice(t,1),0===l.length?null===(s=this.addSummaryFieldsRef.current)||void 0===s||s.focus():null===(i=this.summaryFieldsSidePopperTrigger.current)||void 0===i||i.focus(),this.state.analysisListSettings.forEach((e=>{const t=e.analysisInfo;e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===d.Summary&&(a={useDataSource:e.useDataSource,label:e.label,analysisInfo:{analysisId:e.analysisInfo.analysisId,analysisType:e.analysisInfo.analysisType,isSingleColorMode:t.isSingleColorMode,singleFieldColor:t.singleFieldColor,selectedColorStrip:t.selectedColorStrip,summaryFields:l,expandOnOpen:t.expandOnOpen,highlightResultsOnMap:t.highlightResultsOnMap,highlightColorOnMap:t.highlightColorOnMap}})})),this.updateItem(this.setEditIndex,a,this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.editExistingIntersectedSummaryField=(e,t,s,i)=>{let a;this.state.intersectedSummaryFieldList.forEach(((l,o)=>{a=this.updateSummaryIntersectedFields(e,t,s,i,l)})),this.state.summaryEditField.summaryFieldInfo.summaryBy===_.SumOfIntersectedArea?this.setState({sumOfAreaLabel:e}):this.state.summaryEditField.summaryFieldInfo.summaryBy===_.SumOfIntersectedLength&&this.setState({sumOfLengthLabel:e}),this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],a),...this.state.intersectedSummaryFieldList.slice(1)]},(()=>{this.updateItemValue()}))},this.updateSummaryIntersectedFields=(e,t,s,i,a)=>{let l,o={};return"esriGeometryPolyline"===this.state.selectedLayerGeometry?l=_.SumOfIntersectedLength:"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(l=_.SumOfIntersectedArea),o={fieldLabel:e,fieldColor:a.fieldColor,summaryFieldInfo:{summaryBy:l,showSeparator:t,numberFormattingOption:s,significantDigits:i}},o},this.onOkButtonClick=(e,t,s,i)=>{this.editExistingIntersectedSummaryField(e,t,s,i)},this.createFieldsOptionElement=(t,s)=>(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{tabIndex:0,"aria-label":t.fieldLabel,className:"text-truncate labelAlign",title:t.fieldLabel},t.fieldLabel),(0,e.jsx)(i.Button,{role:"button","aria-label":t.fieldLabel+this.nls("editExpression"),className:"ml-1",title:this.nls("editExpression"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.editSummaryFields(e,t,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.editSummaryFields(e,t,s)}},(0,e.jsx)(be,{size:"s"})),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.deleteSummaryFields(e,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.deleteSummaryFields(e,s)}},(0,e.jsx)(pe,{size:"s"}))),this.onEditPopperClose=()=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!1})},this.updateSortedSummaryFields=e=>{this.setState({summaryFieldsList:e},(()=>{this.updateItemValue()}))},this.onColorSettingClick=()=>{this.openColorSetting(!0)},this.closeColorSettingsPanel=()=>{this.openColorSetting(!1),this.focusColorSetting()},this.focusColorSetting=()=>{setTimeout((()=>{var e;null===(e=this.colorButtonRef.current)||void 0===e||e.focus()}),50)},this.openColorSetting=e=>{this.setState({showSummaryColorSettings:e},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus(),setTimeout((()=>{var e;null===(e=this.colorSidePopperTrigger.current)||void 0===e||e.focus()}),50)}))},this.onUpdateFieldColorByCategory=(e,t,s)=>{var i,a;const l=null===(i=this.state.summaryFieldsList)||void 0===i?void 0:i.map(((i,a)=>{var l,o;return Object.assign(Object.assign({},i),{fieldColor:(null===(l=null==e?void 0:e[i.fieldLabel+"_"+a])||void 0===l?void 0:l._fillColor)?null===(o=null==e?void 0:e[i.fieldLabel+"_"+a])||void 0===o?void 0:o._fillColor:s?this.state.colorstripValues[a%this.state.colorstripValues.length]:null==t?void 0:t[a%(null==t?void 0:t.length)]})})),o=null===(a=this.state.intersectedSummaryFieldList)||void 0===a?void 0:a.map(((i,a)=>{var l,o;return Object.assign(Object.assign({},i),{fieldColor:(null===(l=null==e?void 0:e[i.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===l?void 0:l._fillColor)?null===(o=null==e?void 0:e[i.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===o?void 0:o._fillColor:s?this.state.colorstripValues[a%this.state.colorstripValues.length]:null==t?void 0:t[a%(null==t?void 0:t.length)]})}));this.setState({summaryFieldsList:l,intersectedSummaryFieldList:o,byCategoryColorFields:e,colorstripValues:t},(()=>{this.updateItemValue()}))},this.handleColorTypeChange=e=>{e===H.SingleColor?this.updateFieldColorBySingleColor(this.state.singleColorFields):e===H.ByCategory&&this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues,!0),this.setState({singleColorMode:e===H.SingleColor},(()=>{this.updateItemValue()}))},this.handleSingleColorChange=e=>{this.setState({singleColorFields:e},(()=>{this.updateFieldColorBySingleColor(this.state.singleColorFields)}))},this.updateFieldColorBySingleColor=e=>{var t,s;const i=null===(t=this.state.summaryFieldsList)||void 0===t?void 0:t.map(((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e}))),a=null===(s=this.state.intersectedSummaryFieldList)||void 0===s?void 0:s.map(((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e})));this.setState({summaryFieldsList:i,intersectedSummaryFieldList:a},(()=>{this.updateItemValue()}))},this.handleByCategorySettingColorChange=()=>{this.openColorSetting(!0)},this.handleSortOrderKeyUp=t=>{"Enter"!==t.key&&" "!==t.key||this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))},this.handleGroupOrderKeyUp=t=>{"Enter"!==t.key&&" "!==t.key||this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))},this.getFieldsDs=e=>{var t;const s=[],i=S(e);s.push({layerDsId:e}),this.setState({selectedFieldsDataSource:s,selectedLayerGeometry:null===(t=null==i?void 0:i.layerDefinition)||void 0===t?void 0:t.geometryType})},this.createDisplayFieldOption=t=>{const s=S(t.layerDsId);return(0,e.jsx)(Ne.FieldSelector,{dataSources:s?[s]:[],onChange:this.onDisplayField.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.displayField),isMultiple:!1})},this.createSortFieldSelectorOption=(t,s)=>{const a=S(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section p-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(Ne.FieldSelector,{dataSources:a?[a]:[],onChange:this.onSortFieldSelectChange.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.sortFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"sm",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleSortOrderKeyUp(e)},onClick:()=>{this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.sortFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(Ue,{size:"s",className:"sort-arrow-down-icon ml-0"}),this.state.sortFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(Ee,{size:"s",className:"sort-arrow-down-icon ml-0"}))))},this.createGroupFieldSelectorOption=(t,s)=>{const a=S(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section pl-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(Ne.FieldSelector,{dataSources:a?[a]:[],onChange:e=>{this.onGroupFieldSelectChange(e)},isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.groupFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"default",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleGroupOrderKeyUp(e)},onClick:()=>{this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.groupFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(Ue,{className:"sort-arrow-down-icon ml-0"}),this.state.groupFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(Ee,{className:"sort-arrow-down-icon ml-0"}))))},this.createSubGroupFieldSelectorOption=(t,s)=>{const a=S(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section pl-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(Ne.FieldSelector,{dataSources:a?[a]:[],onChange:e=>{this.onSubGroupFieldSelectChange(e)},isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.subGroupFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"default",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.subGroupFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleGroupOrderKeyUp(e)},onClick:()=>{this.setState({subGroupFeaturesFieldOrder:this.state.subGroupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.subGroupFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(Ue,{className:"sort-arrow-down-icon ml-0"}),this.state.subGroupFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(Ee,{className:"sort-arrow-down-icon ml-0"}))))},this.groupFeaturesOnChange=t=>{const s=S(this.state.useDataSource.dataSourceId),i="unique-value"===s.layer.renderer.type?[s.layer.renderer.field]:[];this.setState({isGroupFeatures:t.target.checked,groupFeaturesField:i,subGroupFeaturesField:[],subGroupFeaturesFieldOrder:e.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:""},(()=>{this.updateItemValue()}))},this.onGroupFeatureSettingsClick=()=>{this.setState({isGroupFeatureSetting:!this.state.isGroupFeatureSetting})},this.onSubGroupFeatureSettingsClick=()=>{this.setState({isSubGroupFeatureSetting:!this.state.isSubGroupFeatureSetting})},this.createConfigureFieldsOption=t=>{const s=S(t.layerDsId);return(0,e.jsx)(Ne.FieldSelector,{"aria-label":this.nls("configureFieldsLabel"),dataSources:s?[s]:[],onChange:this.onConfiguredFieldsChanged.bind(this),selectedFields:(0,e.Immutable)(this.state.fieldsToExport),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})},this.onUpdateApproxDistanceOption=e=>{let t=[];t=e.target.checked?[...this.state.fieldsToExport,"esriCTApproxDistance"]:this.state.fieldsToExport.filter((e=>"esriCTApproxDistance"!==e)),this.setState({includeApproxDistance:e.target.checked,fieldsToExport:t},(()=>{this.updateItemValue()}))},this.sortGroupsByCountOnChange=e=>{this.setState({isSortGroupsByCount:e.target.checked},(()=>{this.updateItemValue()}))},this.onNoValueGroupLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({noValueGroupLabel:null!=t?t:t.trim()})}},this.onNoValueGroupLabelAcceptValue=e=>{const t={groupLabel:null!=e?e:e.trim()};this.updateItemValue(t,this.state.useDataSource)},this.sortSubGroupsByCountOnChange=e=>{this.setState({isSortSubGroupsByCount:e.target.checked},(()=>{this.updateItemValue()}))},this.onNoValueSubGroupLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({noValueSubGroupLabel:null!=t?t:t.trim()})}},this.onNoValueSubGroupLabelAcceptValue=e=>{const t={subGroupLabel:null!=e?e:e.trim()};this.updateItemValue(t,this.state.useDataSource)},this.onSumOfAreaChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfArea:e.target.checked})},this.onSumOfLengthChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfLength:e.target.checked})},this.updateIntersectedFields=(e,t)=>{if(e){const e={fieldLabel:t===_.SumOfIntersectedLength?this.state.sumOfLengthLabel:this.state.sumOfAreaLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:V,summaryFieldInfo:{summaryBy:t,showSeparator:!0,numberFormattingOption:W.NoFormatting,significantDigits:0}};this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],e),...this.state.intersectedSummaryFieldList.slice(1)]},(()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)}))}else this.state.intersectedSummaryFieldList.splice(0,1),this.updateItemValue()},this.onSumOfAreaEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onSumOfLengthEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onIntersectedFieldEdit=e=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!0,sumOfIntersectedFieldPopupTitle:e===_.SumOfIntersectedArea?this.nls("editSumOfIntersectedArea"):this.nls("editSumOfIntersectedLength")}),this.state.intersectedSummaryFieldList.forEach((t=>{t.summaryFieldInfo.summaryBy===e&&this.setState({summaryEditField:t})}))},this.closeAddSummaryFieldPanel=()=>{this.setState({isAddNewSummaryField:!1},(()=>{this.addSummaryFieldsRef.current.focus()}))},this.onExpressionInfoUpdate=e=>{this.setState({isAddNewSummaryField:!1});const t={fieldLabel:e.fieldLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:V,summaryFieldInfo:e.selectedExpression};this.state.isNewFieldAdded?this.setState({summaryFieldsList:[...this.state.summaryFieldsList,t],expressionInfo:e.selectedExpression},(()=>{this.setSidePopperAnchor(this.state.summaryFieldsList.length-1),this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)})):this.setState({expressionInfo:e.selectedExpression},(()=>{this.updateExistingField(t)}))},this.updateExistingField=e=>{const t=this.state.summaryEditIndex;t>-1&&this.setState({summaryFieldsList:[...this.state.summaryFieldsList.slice(0,t),Object.assign({},this.state.summaryFieldsList[t],e),...this.state.summaryFieldsList.slice(t+1)]},(()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields,this.state.colorstripValues)}))},this.getDsRootIdsByWidgetId=()=>{var t,s;const i=[],a=(null===(s=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===s?void 0:s.appConfig).dataSources[this.props.activeDs];return(null==a?void 0:a.type)!==e.ArcGISDataSourceTypes.WebMap&&(null==a?void 0:a.type)!==e.ArcGISDataSourceTypes.WebScene||i.push(this.props.activeDs),i.length>0?(0,e.Immutable)(i):void 0},this.dataSourceChangeSave=e=>{var t;if(!e)return;const s=null===(t=this.props)||void 0===t?void 0:t.availableFeatureLayer.find((t=>t.id===e[0].dataSourceId));this.setState({layerLabel:(null==s?void 0:s.getLabel())?s.getLabel():"",useDataSource:e[0]},(()=>{this.resetAnalysisValues(this.state.useDataSource)}))},this.expandFeatureOnChange=e=>{this.setState({expandFeatureDetails:e.target.checked},(()=>{this.updateItemValue()}))},this.highlightResultsOnMapOnChange=e=>{this.setState({highlightResultsOnMap:e.target.checked},(()=>{this.updateItemValue()}))},this.onHighlightColorOnMapChange=e=>{this.setState({highlightColorOnMap:e},(()=>{this.updateItemValue()}))},this.renderGroupSettings=()=>(0,e.jsx)("div",null,(0,e.jsx)(i.Popper,{style:{width:"227px"},open:this.state.isGroupFeatureSetting,reference:"groupFeature"+this.props.widgetId,placement:"bottom-end",version:0,offset:[0,0],showArrow:!0,toggle:e=>{this.onNoValueGroupLabelAcceptValue(this.state.noValueGroupLabel),this.setState({isGroupFeatureSetting:!this.state.isGroupFeatureSetting})}},(0,e.jsx)("div",{className:"p-3"},(0,e.jsx)(t.SettingRow,{label:this.nls("sortGroupsByCount")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("sortGroupsByCount"),title:this.nls("sortGroupsByCount"),checked:this.state.isSortGroupsByCount,onChange:this.sortGroupsByCountOnChange})),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{"aria-label":this.nls("noValueGroupLabel"),title:this.nls("noValueGroupLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("noValueGroupLabel"))),(0,e.jsx)(i.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("noValueGroupLabel")+this.state.noValueGroupLabel,title:this.state.noValueGroupLabel,size:"sm",value:this.state.noValueGroupLabel,onChange:this.onNoValueGroupLabelChange}))))),this.renderSubGroupSettings=()=>(0,e.jsx)("div",null,(0,e.jsx)(i.Popper,{style:{width:"227px"},open:this.state.isSubGroupFeatureSetting,reference:"subgroupFeature"+this.props.widgetId,placement:"bottom-end",version:0,offset:[0,0],showArrow:!0,toggle:e=>{this.onNoValueSubGroupLabelAcceptValue(this.state.noValueSubGroupLabel),this.setState({isSubGroupFeatureSetting:!this.state.isSubGroupFeatureSetting})}},(0,e.jsx)("div",{className:"p-3"},(0,e.jsx)(t.SettingRow,{label:this.nls("sortGroupsByCount")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("sortGroupsByCount"),title:this.nls("sortGroupsByCount"),checked:this.state.isSortSubGroupsByCount,onChange:this.sortSubGroupsByCountOnChange})),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{"aria-label":this.nls("noValueGroupLabel"),title:this.nls("noValueGroupLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("noValueGroupLabel"))),(0,e.jsx)(i.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("noValueGroupLabel")+this.state.noValueSubGroupLabel,title:this.state.noValueSubGroupLabel,size:"sm",value:this.state.noValueSubGroupLabel,onChange:this.onNoValueSubGroupLabelChange}))))),this.state={closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!1,analysisListSettings:this.props.analysisList||[],selectedLayers:[],useDataSource:null,layerLabel:"",analysisType:"",displayField:[],sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:e.OrderRule.Asc,selectedFieldsDataSource:[],isGroupFeatures:!1,isGroupFeatureSetting:!1,groupFeaturesField:[],groupFeaturesFieldOrder:e.OrderRule.Asc,isSortGroupsByCount:!1,noValueGroupLabel:"",isSubGroupFeatureSetting:!1,subGroupFeaturesField:[],subGroupFeaturesFieldOrder:e.OrderRule.Asc,isSortSubGroupsByCount:!1,noValueSubGroupLabel:"",expandOnOpen:!1,editSummaryAreaLengthFieldPopupOpen:!1,sumOfArea:!1,sumOfLength:!1,sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength"),selectedLayerGeometry:this.props.selectedLayerGeometry,summaryFieldsList:[],intersectedSummaryFieldList:[],summaryEditIndex:null,summaryEditField:null,expressionInfo:null,sumOfIntersectedFieldPopupTitle:"",isAddNewSummaryField:!1,isNewFieldAdded:!1,showSummaryColorSettings:!1,singleColorFields:V,byCategoryColorFields:null,singleColorMode:!0,colorstripValues:J,popperFocusNode:null,expandFeatureDetails:!1,highlightResultsOnMap:!0,highlightColorOnMap:P,fieldsToExport:[],includeApproxDistance:!1},this.setEditIndex=0,this.defaultSelectedItem.name=this.nls("noSelectionItemLabel"),this.updateSummaryFieldListSettings=[]}render(){var s,a,l,r,p,h,u,c;const m=e.DataSourceManager.getInstance().getDataSource(this.props.activeDs),y=null==m?void 0:m.getChildDataSources();let g=!1;const f=[];y&&y.forEach((t=>{var s;const i=t;if("Table"!==(null===(s=null==i?void 0:i.layerDefinition)||void 0===s?void 0:s.type))if((null==t?void 0:t.type)===e.DataSourceTypes.MapService||(null==t?void 0:t.type)===e.DataSourceTypes.GroupLayer){const s=t=>{t.getChildDataSources().forEach((t=>{(null==t?void 0:t.type)===e.DataSourceTypes.GroupLayer?s(t):f.push(t.id)}))};s(t)}else if(f.length>0){f.find((e=>e.id===t.id))||(g=!0),g&&f.push(t.id)}else f.push(t.id)}));const S={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,e.Immutable)(f)},x=this.renderGroupSettings(),b=this.renderSubGroupSettings();return(0,e.jsx)("div",{css:o(this.props.theme,this.props.isActiveMapAreaSelected),style:{height:"calc(100% - 112px)",width:"100%",overflow:"auto"}},(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,{label:this.nls("selectLayer"),flow:"wrap"},(0,e.jsx)(Ne.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.state.useDataSource?(0,e.Immutable)([this.state.useDataSource]):(0,e.Immutable)([]),fromRootDsIds:S.fromRootDsIds,fromDsIds:S.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})),(0,e.jsx)(t.SettingRow,{label:this.nls("label"),flow:"wrap"},(0,e.jsx)(i.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("label")+this.state.layerLabel,title:this.state.layerLabel,size:"sm",value:this.state.layerLabel,onAcceptValue:this.onLayerLabelAcceptValue,onChange:this.onLayerLabelChange}))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title2 hint-paper"},this.nls("analysisTypeLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-4",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 analysisTypeWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls(d.Closest),className:"cursor-pointer",value:this.nls(d.Closest),onChange:()=>{this.onAnalysisTypeChange(d.Closest)},checked:this.state.analysisType===d.Closest,disabled:this.props.isActiveMapAreaSelected}),(0,e.jsx)("div",{tabIndex:0,className:(0,e.classNames)("ml-1 text-break",this.props.isActiveMapAreaSelected?"disabled-label":"cursor-pointer"),onClick:()=>{!this.props.isActiveMapAreaSelected&&this.state.analysisType!==d.Closest&&this.onAnalysisTypeChange(d.Closest)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||!this.props.isActiveMapAreaSelected&&this.state.analysisType!==d.Closest&&this.onAnalysisTypeChange(d.Closest)}},this.nls(d.Closest))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("closestAnalysisTypeTooltip"),title:this.nls("closestAnalysisTypeTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(T,null)))),this.props.isActiveMapAreaSelected&&this.state.analysisType===d.Closest&&(0,e.jsx)(i.Alert,{tabIndex:0,withIcon:!0,size:"small",type:"warning",className:"w-100 shadow mb-2 mt-2"},(0,e.jsx)("div",{className:"flex-grow-1 text-break settings-text-level"},this.nls("warningMsgIfActiveMapArea"))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 analysisTypeWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls(d.Proximity),className:"cursor-pointer",value:this.nls(d.Proximity),onChange:()=>{this.onAnalysisTypeChange(d.Proximity)},checked:this.state.analysisType===d.Proximity}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{this.state.analysisType!==d.Proximity&&this.onAnalysisTypeChange(d.Proximity)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.state.analysisType!==d.Proximity&&this.onAnalysisTypeChange(d.Proximity)}},this.nls(d.Proximity))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("proximityAnalysisTypeTooltip"),title:this.nls("proximityAnalysisTypeTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(T,null)))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 analysisTypeWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls(d.Summary),className:"cursor-pointer",value:this.nls(d.Summary),onChange:()=>{this.onAnalysisTypeChange(d.Summary)},checked:this.state.analysisType===d.Summary}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 cursor-pointer text-break",onClick:()=>{this.state.analysisType!==d.Summary&&this.onAnalysisTypeChange(d.Summary)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.state.analysisType!==d.Summary&&this.onAnalysisTypeChange(d.Summary)}},this.nls(d.Summary))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("summaryAnalysisTypeTooltip"),title:this.nls("summaryAnalysisTypeTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(T,null)))),this.state.proximityAnalysisType&&this.state.analysisType===d.Proximity&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{label:this.nls("displayFieldLabel"),flow:"wrap"},this.createDisplayFieldOption(this.state.selectedFieldsDataSource[0])),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("sortFeaturesLabel"),title:this.nls("sortFeaturesLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title3 hint-default"},this.nls("sortFeaturesLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-1 ml-4",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("distanceLabel"),className:"cursor-pointer",value:"distanceLabel",onChange:()=>{this.handleSortFeaturesOptionsChange(!0)},checked:this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!0)}},this.nls("distanceLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-2 ml-4",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("field"),className:"cursor-pointer",value:"field",onChange:()=>{this.handleSortFeaturesOptionsChange(!1)},checked:!this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!1)}},this.nls("field")))),!this.state.sortFeaturesByDistance&&(0,e.jsx)(he.List,{className:"pt-4 pb-4",size:"sm",itemsJson:null===(s=Array.from(this.state.selectedFieldsDataSource))||void 0===s?void 0:s.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:he.TreeItemActionType.RenderOverrideItem,children:[{name:he.TreeItemActionType.RenderOverrideItemBody,children:[{name:he.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createSortFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default"},this.nls("groupFeaturesLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("groupFeaturesInfoToolTip"),title:this.nls("groupFeaturesInfoToolTip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default mr-4 d-inline"},(0,e.jsx)(T,null))),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("groupFeaturesLabel"),title:this.nls("groupFeaturesLabel"),checked:this.state.isGroupFeatures,onChange:this.groupFeaturesOnChange})),this.state.isGroupFeatures&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-between"},(0,e.jsx)(he.List,{className:"pt-4 pb-4 pr-1 w-100",size:"sm",itemsJson:null===(a=Array.from(this.state.selectedFieldsDataSource))||void 0===a?void 0:a.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:he.TreeItemActionType.RenderOverrideItem,children:[{name:he.TreeItemActionType.RenderOverrideItemBody,children:[{name:he.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createGroupFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("settings"),title:this.nls("settings"),icon:!0,type:"default","aria-haspopup":"dialog",size:"default",active:this.state.isGroupFeatureSetting,id:"groupFeature"+this.props.widgetId,onClick:()=>{this.onGroupFeatureSettingsClick()}},(0,e.jsx)(we,null))),this.state.isGroupFeatureSetting&&x,this.state.groupFeaturesField.length>0&&(0,e.jsx)("div",{className:"d-flex align-items-center justify-content-between",style:{marginTop:"-28px"}},(0,e.jsx)(he.List,{className:"pt-4 pb-4 pr-1 w-100",size:"sm",itemsJson:null===(l=Array.from(this.state.selectedFieldsDataSource))||void 0===l?void 0:l.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:he.TreeItemActionType.RenderOverrideItem,children:[{name:he.TreeItemActionType.RenderOverrideItemBody,children:[{name:he.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createSubGroupFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("settings"),title:this.nls("settings"),icon:!0,type:"default","aria-haspopup":"dialog",size:"default",active:this.state.isSubGroupFeatureSetting,id:"subgroupFeature"+this.props.widgetId,onClick:()=>{this.onSubGroupFeatureSettingsClick()}},(0,e.jsx)(we,null))),this.state.isSubGroupFeatureSetting&&b)),this.state.summaryAnalysisType&&this.state.analysisType===d.Summary&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{tabIndex:-1,className:"pt-2 pb-1"},(0,e.jsx)("div",{ref:this.addSummaryFieldsRef,tabIndex:0,"aria-label":this.nls("addSummaryFields"),title:this.nls("addSummaryFields"),className:"d-flex align-items-center add-summary-field",onClick:e=>{this.onAddSummaryFieldsClick(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onAddSummaryFieldsClick(e)}},(0,e.jsx)("div",{tabIndex:-1,className:"add-summary-field-icon-container d-flex align-items-center justify-content-center mr-2"},(0,e.jsx)(i.Icon,{tabIndex:-1,icon:He,size:12})),(0,e.jsx)("div",{tabIndex:-1,className:"pt-1 text-truncate flex-grow-1"},this.nls("addSummaryFields"))),0===this.state.summaryFieldsList.length&&(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("addSummaryHintMsg"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default"},this.nls("addSummaryHintMsg")))),this.state.summaryFieldsList.length>0&&(0,e.jsx)("div",{ref:this.summaryFieldsSidePopperTrigger,className:(0,e.classNames)("nearme-summary-fields-list-items","esriGeometryPoint"===this.state.selectedLayerGeometry?"pb-2":"")},(0,e.jsx)(he.List,{itemsJson:null===(r=Array.from(this.state.summaryFieldsList||null))||void 0===r?void 0:r.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this.updateSortedSummaryFields(a)},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:he.TreeItemActionType.RenderOverrideItem,children:[{name:he.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:he.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:he.TreeItemActionType.RenderOverrideItemBody,children:[{name:he.TreeItemActionType.RenderOverrideItemDragHandle},{name:he.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createFieldsOptionElement(i.itemStateDetailContent,a.indexOf(i))}})),!this.props.isActiveMapAreaSelected&&(0,e.jsx)(e.React.Fragment,null,("esriGeometryPolyline"===this.state.selectedLayerGeometry||"esriGeometryPolygon"===this.state.selectedLayerGeometry)&&(0,e.jsx)(t.SettingRow,{label:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedLength"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedArea"):""},(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",title:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default ml-2 d-inline"},(0,e.jsx)(T,null)))),"esriGeometryPolyline"===this.state.selectedLayerGeometry&&(0,e.jsx)("div",{className:(0,e.classNames)("pb-2 d-flex align-items-center justify-content-between")},(0,e.jsx)(i.Label,{title:this.state.sumOfLengthLabel,className:"pt-2 pl-1 text-truncate cursor-pointer"},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfLength,role:"checkbox","aria-label":this.nls("sumOfIntersectedLength"),onChange:e=>{this.onSumOfLengthChange(e,_.SumOfIntersectedLength)}}),this.state.sumOfLengthLabel),this.state.sumOfLength&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfLengthEditClick(_.SumOfIntersectedLength)}},(0,e.jsx)(be,{size:"s"}))),"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(0,e.jsx)("div",{className:(0,e.classNames)("pb-2 d-flex align-items-center justify-content-between")},(0,e.jsx)(i.Label,{title:this.state.sumOfAreaLabel,className:"pt-2 pl-1 text-truncate cursor-pointer"},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfArea,role:"checkbox","aria-label":this.nls("sumOfIntersectedArea"),onChange:e=>{this.onSumOfAreaChange(e,_.SumOfIntersectedArea)}}),this.state.sumOfAreaLabel),this.state.sumOfArea&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfAreaEditClick(_.SumOfIntersectedArea)}},(0,e.jsx)(be,{size:"s"})))),((null===(p=this.updateSummaryFieldListSettings)||void 0===p?void 0:p.length)>0&&!this.props.isActiveMapAreaSelected||(null===(h=this.state.summaryFieldsList)||void 0===h?void 0:h.length)>0&&this.props.isActiveMapAreaSelected)&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:(0,e.classNames)("pt-4",this.state.summaryFieldsList.length>0||this.state.sumOfArea||this.state.sumOfLength?"pt-2 nearme-divider":""),label:this.nls("themeSettingColorMode"),flow:"wrap"}),(0,e.jsx)(t.SettingRow,{className:"mt-0",flow:"wrap"},(0,e.jsx)(i.Label,{className:"mt-1 colorModesWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("singleColor"),className:"cursor-pointer",value:"singleColor",onChange:()=>{this.handleColorTypeChange(H.SingleColor)},checked:this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(H.SingleColor)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(H.SingleColor)}},this.nls("singleColor"))),this.state.singleColorMode&&(0,e.jsx)(A.ThemeColorPicker,{specificTheme:(0,M.getTheme2)(),value:this.state.singleColorFields,onChange:e=>{this.handleSingleColorChange(e)}})),(0,e.jsx)(t.SettingRow,{className:"mt-0",flow:"wrap"},(0,e.jsx)(i.Label,{className:"mt-1 mb-1 colorModesWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("byCategory"),className:"cursor-pointer",value:"byCategory",onChange:()=>{this.handleColorTypeChange(H.ByCategory)},checked:!this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(H.ByCategory)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(H.ByCategory)}},this.nls("byCategory"))),!this.state.singleColorMode&&(0,e.jsx)(i.Button,{ref:this.colorButtonRef,role:"button","aria-label":this.nls("byCategory"),title:this.nls("byCategory"),icon:!0,type:"tertiary",size:"sm",onClick:this.handleByCategorySettingColorChange.bind(this)},(0,e.jsx)(we,null)))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.isAddNewSummaryField&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeAddSummaryFieldPanel,trigger:null===(u=this.summaryFieldsSidePopperTrigger)||void 0===u?void 0:u.current,backToFocusNode:this.state.popperFocusNode},(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:n(this.props.theme)},(0,e.jsx)(je,{theme:this.props.theme,intl:this.props.intl,title:null!==this.state.summaryEditIndex?this.nls("editSummaryField"):this.nls("addSummaryFields"),ref:this.backRef,onBack:this.closeAddSummaryFieldPanel},(0,e.jsx)(We,{intl:this.props.intl,theme:this.props.theme,widgetId:this.props.widgetId,currentLayerDsId:this.props.editCurrentLayer,fieldsEditIndex:this.state.summaryEditIndex,editingField:this.state.summaryEditField,expressionInfoUpdate:this.onExpressionInfoUpdate.bind(this)})))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.showSummaryColorSettings&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeColorSettingsPanel,trigger:null===(c=this.colorSidePopperTrigger)||void 0===c?void 0:c.current},(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:n(this.props.theme)},(0,e.jsx)(je,{theme:this.props.theme,intl:this.props.intl,title:this.nls("summaryFieldColor"),ref:this.backRef,onBack:this.closeColorSettingsPanel},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(Me,{intl:this.props.intl,theme:this.props.theme,summaryFieldsInfo:this.props.isActiveMapAreaSelected?this.state.summaryFieldsList:this.updateSummaryFieldListSettings,colorstripValue:this.state.colorstripValues,updateFieldColorsValues:this.onUpdateFieldColorByCategory}))))),this.state.editSummaryAreaLengthFieldPopupOpen&&(0,e.jsx)(_e,{theme:this.props.theme,intl:this.props.intl,isOpen:this.state.editSummaryAreaLengthFieldPopupOpen,editSummaryFields:this.state.summaryEditField,sumOfIntersectedFieldPopupTitle:this.state.sumOfIntersectedFieldPopupTitle,onClose:this.onEditPopperClose,onOkClick:this.onOkButtonClick})),!this.props.isActiveMapAreaSelected&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{label:this.nls("highlightResultsOnMapLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("highlightResultsOnMapLabel"),title:this.nls("highlightResultsOnMapLabel"),checked:this.state.highlightResultsOnMap,onChange:this.highlightResultsOnMapOnChange})),this.state.highlightResultsOnMap&&(0,e.jsx)(t.SettingRow,{label:this.nls("highlightColorLabel")},(0,e.jsx)(A.ThemeColorPicker,{specificTheme:(0,M.getTheme2)(),value:this.state.highlightColorOnMap?this.state.highlightColorOnMap:P,onChange:e=>{this.onHighlightColorOnMapChange(e)}}))),(0,e.jsx)(t.SettingRow,{label:this.nls("expandOnOpen")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("expandOnOpen"),title:this.nls("expandOnOpen"),checked:this.state.expandOnOpen,onChange:this.expandListOnChange})),this.state.proximityAnalysisType&&this.state.expandOnOpen&&(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("expandFeatureDetails"),className:"m-0 w-100",centric:!0},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.expandFeatureDetails,role:"checkbox","aria-label":this.nls("expandFeatureDetails"),onChange:e=>{this.expandFeatureOnChange(e)}}),(0,e.jsx)("div",{className:"ml-1 w-100 text-break",onClick:e=>{"span"!==e.target.tagName.toLowerCase()&&e.preventDefault()}},(0,e.jsx)("span",{className:"cursor-pointer"},this.nls("expandFeatureDetails"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("expandListTooltip"),title:this.nls("expandListTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline",onClick:e=>{e.preventDefault()}},(0,e.jsx)(T,null))))),(this.state.closestAnalysisType||this.state.proximityAnalysisType||this.state.summaryAnalysisType)&&(0,e.jsx)(t.SettingRow,{className:"border-top pt-3",label:this.nls("configureFieldsLabel"),flow:"wrap"},this.createConfigureFieldsOption(this.state.selectedFieldsDataSource[0])),!this.props.isActiveMapAreaSelected&&(this.state.closestAnalysisType||this.state.proximityAnalysisType)&&(0,e.jsx)(t.SettingRow,{className:"pt-1",label:this.nls("includeApproxDistance")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("includeApproxDistance"),title:this.nls("includeApproxDistance"),checked:this.state.includeApproxDistance,onChange:this.onUpdateApproxDistanceOption}))))}}let Ke=[];class qe extends e.React.PureComponent{constructor(t){var s,i,o,n,r,p;super(t),this.analysisLayersPopperTrigger=e.React.createRef(),this.backRef=e.React.createRef(),this.mvManager=a.MapViewManager.getInstance(),this.allDsLayers=[],this.nls=t=>{const s=Object.assign({},l,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.componentDidMount=()=>{var e,t;Ke=this.collectionOfLayerInfos();const s=[];(null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0&&(null===(t=this.props.activeDsLayersConfig)||void 0===t||t.layersInfo.map((e=>(s.push(e),!0))),this.setState({newAddedLayerAnalysis:s}))},this.componentDidUpdate=e=>{e.activeDsSearchConfig.searchByActiveMapArea!==this.props.activeDsSearchConfig.searchByActiveMapArea&&(Ke=this.collectionOfLayerInfos())},this.onlyShowResultsOptionChange=e=>{this.setState({showLayersResultOption:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("onlyShowLayersResult",this.state.showLayersResultOption)}))},this.onToggleResults=()=>{this.setState({isResultSettingsOpen:!this.state.isResultSettingsOpen})},this.displayFeatureCountStateChange=e=>{this.setState({displayFeatureCount:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayFeatureCount",this.state.displayFeatureCount)}))},this.onShowDistFromInputLocToolsChange=e=>{this.setState({showDistFromInputLocation:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("showDistFromInputLocation",this.state.showDistFromInputLocation)}))},this.displayAnalysisIconStateChange=e=>{this.setState({displayAnalysisIcon:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayAnalysisIcon",this.state.displayAnalysisIcon)}))},this.displayMapSymbolsStateChange=e=>{this.setState({displayMapSymbols:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayMapSymbols",this.state.displayMapSymbols)}))},this.collectionOfLayerInfos=()=>{const e=[];this.props.allFeatureLayers.forEach(((e,t)=>{if(e.value===this.props.selectedDs){e.availableLayers.forEach((e=>{const t=S(e.layerDsId);this.allDsLayers.push(t)}))}}));for(let t=0;t<this.allDsLayers.length;t++)for(let s=0;s<G.length;s++)this.props.activeDsSearchConfig.searchByActiveMapArea&&G[s]===d.Closest||e.push({analysisType:G[s],featureLayer:this.allDsLayers[t]});return e},this.onAddAnalysisClick=()=>{var e,t,s,i,a,l;if((null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0){const e=[];for(let t=0;t<Ke.length;t++)for(let s=0;s<this.state.newAddedLayerAnalysis.length;s++)Ke[t].analysisType===this.state.newAddedLayerAnalysis[s].analysisInfo.analysisType&&Ke[t].featureLayer.id===this.state.newAddedLayerAnalysis[s].useDataSource.dataSourceId&&e.push(t);const o=[];Ke.forEach(((t,s)=>{e.includes(s)||o.push(s)}));const n={dataSourceId:null===(s=null===(t=Ke[null==o?void 0:o[0]])||void 0===t?void 0:t.featureLayer)||void 0===s?void 0:s.id,mainDataSourceId:null===(a=null===(i=Ke[null==o?void 0:o[0]])||void 0===i?void 0:i.featureLayer)||void 0===a?void 0:a.id,rootDataSourceId:this.props.selectedDs};if(o.length>0){const e=U.find((e=>e.analysisType===Ke[o[0]].analysisType)),t=S(Ke[o[0]].featureLayer.id),s={useDataSource:n,label:null==t?void 0:t.getLabel(),analysisInfo:e},i=s.analysisInfo;i.analysisId=w(),i.fieldsToExport=I(Ke[o[0]].featureLayer.id),Ke[o[0]].analysisType===d.Proximity&&(i.displayField=F(null==t?void 0:t.layerDefinition)),s.analysisInfo=i,this.setState({newAddedLayerAnalysis:[...this.state.newAddedLayerAnalysis,s],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:Ke[o[0]].featureLayer.id,analysisType:Ke[o[0]].analysisType},selectedLayerGeometryType:null===(l=null==t?void 0:t.layerDefinition)||void 0===l?void 0:l.geometryType}),this.setState({showEditAnalysisPopper:!0})}else this.displayDefaultClosestOrProximity(Ke,!0)}else this.displayDefaultClosestOrProximity(Ke,!1)},this.displayDefaultClosestOrProximity=(e,t)=>{const s={dataSourceId:e[0].featureLayer.id,mainDataSourceId:e[0].featureLayer.id,rootDataSourceId:this.props.selectedDs},i=S(e[0].featureLayer.id),a={useDataSource:s,label:null==i?void 0:i.getLabel(),analysisInfo:this.props.activeDsSearchConfig.searchByActiveMapArea?U[1]:U[0]},l=a.analysisInfo;l.analysisId=w(),a.analysisInfo=l,a.analysisInfo.fieldsToExport=I(e[0].featureLayer.id),this.setState({newAddedLayerAnalysis:t?[...this.state.newAddedLayerAnalysis,a]:[a],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:e[0].featureLayer.id,analysisType:e[0].analysisType},showEditAnalysisPopper:!0})},this.closeEditAnalysisPopper=()=>{var e,t,s;this.setSidePopperAnchor(this.state.analysisIndex);const i=null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo;this.setState({newAddedLayerAnalysis:(null===(s=null===(t=this.props.activeDsLayersConfig)||void 0===t?void 0:t.layersInfo)||void 0===s?void 0:s.length)>0?i.asMutable():[],showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)}))},this.editOkButtonCLick=()=>{this.setState({showEditAnalysisPopper:!1,newAddedLayerAnalysis:this.isAnalysisEdited?this.state.updatedAddedLayerAnalysis:this.state.newAddedLayerAnalysis},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis),setTimeout((()=>{this.props.getAddedLayersInfoUseDs()}),100)})),this.isAnalysisEdited=!1},this.onEditButtonClick=(e,t,s,i)=>{this.setSidePopperAnchor(i),this.setState({showEditAnalysisPopper:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}})},this.setSidePopperAnchor=e=>{var t;const s=null===(t=this.analysisLayersPopperTrigger.current)||void 0===t?void 0:t.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:s})},this.onDeleteButtonClick=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:i},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e),setTimeout((()=>{this.props.getAddedLayersInfoUseDs()}),100),-1===this.state.analysisIndex&&this.state.editCurrentLayer.layerDsId===t&&this.state.editCurrentLayer.analysisType===s&&(this.setSidePopperAnchor(this.state.analysisIndex),this.setState({showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)})))}))},this.updateLayersInfoSettings=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:t,editCurrentLayer:{layerDsId:s,analysisType:i}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e)}))},this.onAnalysisInfoUpdate=(e,t,s,i)=>{this.isAnalysisEdited=!0,this.setState({updatedAddedLayerAnalysis:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}})},this.onDisableOkButton=e=>{this.setState({disableSidePopperOkButton:e})},this.props.activeDsLayersConfig&&(this.state={showEditAnalysisPopper:!1,newAddedLayerAnalysis:(null===(i=null===(s=this.props.activeDsLayersConfig)||void 0===s?void 0:s.layersInfo)||void 0===i?void 0:i.length)>0?null===(o=this.props.activeDsLayersConfig)||void 0===o?void 0:o.layersInfo:[],updatedAddedLayerAnalysis:(null===(r=null===(n=this.props.activeDsLayersConfig)||void 0===n?void 0:n.layersInfo)||void 0===r?void 0:r.length)>0?null===(p=this.props.activeDsLayersConfig)||void 0===p?void 0:p.layersInfo:[],displayFeatureCount:this.props.activeDsLayersConfig.displayFeatureCount,showDistFromInputLocation:this.props.activeDsLayersConfig.showDistFromInputLocation,displayAnalysisIcon:this.props.activeDsLayersConfig.displayAnalysisIcon,layersAnalysisType:"",analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""},selectedLayerGeometryType:"",popperFocusNode:null,disableSidePopperOkButton:!1,displayMapSymbols:this.props.activeDsLayersConfig.displayMapSymbols,isResultSettingsOpen:!1,showLayersResultOption:this.props.activeDsLayersConfig.onlyShowLayersResult}),this.isAnalysisEdited=!1}render(){var s;return(0,e.jsx)("div",{css:o(this.props.theme,this.props.activeDsSearchConfig.searchByActiveMapArea),style:{height:"100%",width:"100%"}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:this.onAddAnalysisClick.bind(this)},this.nls("addAnalysisLabel"))),0===this.state.newAddedLayerAnalysis.length&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Alert,{tabIndex:0,withIcon:!0,text:this.nls("noAnalysisConfiguredMsg"),type:"warning"})),this.state.newAddedLayerAnalysis&&this.state.newAddedLayerAnalysis.length>0&&(0,e.jsx)("div",{ref:this.analysisLayersPopperTrigger,tabIndex:-1,className:"w-100 mb-4 mt-2"},(0,e.jsx)(ge,{intl:this.props.intl,theme:this.props.theme,addedLayerAnalysis:this.state.newAddedLayerAnalysis,showEditAnalysisPopper:this.state.showEditAnalysisPopper,analysisIndex:this.state.analysisIndex,editCurrentLayer:this.state.editCurrentLayer,onEditAction:this.onEditButtonClick,onDeleteAction:this.onDeleteButtonClick.bind(this),onLayersInfoSettingsUpdated:this.updateLayersInfoSettings,isActiveMapAreaSelected:this.props.activeDsSearchConfig.searchByActiveMapArea})),(0,e.jsx)(t.SettingRow,{className:"border-top pt-3"},(0,e.jsx)(i.CollapsablePanel,{label:this.nls("resultsCollapsible"),isOpen:this.state.isResultSettingsOpen,onRequestOpen:()=>{this.onToggleResults()},onRequestClose:()=>{this.onToggleResults()}},(0,e.jsx)("div",{style:{height:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("displayFeatureCountLabel"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.displayFeatureCount,onChange:this.displayFeatureCountStateChange.bind(this)}),this.nls("displayFeatureCountLabel"))),(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("displayAnalysisIconLabel"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.displayAnalysisIcon,onChange:this.displayAnalysisIconStateChange.bind(this)}),this.nls("displayAnalysisIconLabel"))),(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("mapSymbolsLabel"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.displayMapSymbols,onChange:this.displayMapSymbolsStateChange.bind(this)}),this.nls("mapSymbolsLabel"))),!this.props.activeDsSearchConfig.searchByActiveMapArea&&(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("showDistFromInputLoc"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showDistFromInputLocation,onChange:this.onShowDistFromInputLocToolsChange.bind(this)}),this.nls("showDistFromInputLoc"))),!this.props.activeDsSearchConfig.searchByActiveMapArea&&(0,e.jsx)(t.SettingRow,{className:"ml-2"},(0,e.jsx)(i.Label,{check:!0,centric:!0,style:{cursor:"pointer"}},(0,e.jsx)(i.Checkbox,{role:"checkbox","aria-label":this.nls("onlyShowResults"),style:{cursor:"pointer"},className:"mr-2",checked:this.state.showLayersResultOption,onChange:this.onlyShowResultsOptionChange.bind(this)}),this.nls("onlyShowResults")),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("onlyShowResults")+" "+this.nls("onlyShowResultsTooltip"),title:this.nls("onlyShowResultsTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default mr-2 d-inline"},(0,e.jsx)(T,null))))))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.showEditAnalysisPopper&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeEditAnalysisPopper.bind(this),trigger:null===(s=this.analysisLayersPopperTrigger)||void 0===s?void 0:s.current,backToFocusNode:this.state.popperFocusNode},(0,e.jsx)("div",{className:"bg-default border-color-gray-400",css:n(this.props.theme)},(0,e.jsx)(je,{theme:this.props.theme,intl:this.props.intl,title:this.nls("editAnalysis"),ref:this.backRef,hideBackArrow:!0,showCloseIcon:!0,disableOkButton:this.state.disableSidePopperOkButton,onBack:this.closeEditAnalysisPopper,showOkButton:!0,onOkButtonClicked:this.editOkButtonCLick},(0,e.jsx)($e,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,isActiveMapAreaSelected:this.props.activeDsSearchConfig.searchByActiveMapArea,activeDs:this.props.selectedDs,analysisIndex:this.state.analysisIndex,availableFeatureLayer:this.allDsLayers,editCurrentLayer:this.state.editCurrentLayer,analysisList:this.state.newAddedLayerAnalysis,selectedLayerGeometry:this.state.selectedLayerGeometryType,onAnalysisUpdate:this.onAnalysisInfoUpdate,disableOkButton:this.onDisableOkButton})))))}}var Ze=function(e,t,s,i){return new(s||(s=Promise))((function(a,l){function o(e){try{r(i.next(e))}catch(e){l(e)}}function n(e){try{r(i.throw(e))}catch(e){l(e)}}function r(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,n)}r((i=i.apply(e,t||[])).next())}))};class Ye extends s.BaseWidgetSetting{constructor(t){super(t),this.mvManager=a.MapViewManager.getInstance(),this._mapLoadedTimer=null,this.nls=e=>{var t;const s=Object.assign({},l,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var t,s;let i;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];(null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[a])?(i=!1,this.checkLayersAvailability(this.props.useMapWidgetIds)):(this.resetAnalysisLayersConfig(this.props.useMapWidgetIds),i=!0)}else i=!0;this.updateConfigForMapWidget(i),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings","noResultsFoundText"],this.props.config.generalSettings.noResultsFoundText?this.props.config.generalSettings.noResultsFoundText:this.nls("noDataMessageDefaultText"))})}),50),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings","highlightColor"],this.props.config.generalSettings.highlightColor?this.props.config.generalSettings.highlightColor:this.props.theme2.sys.color.primary.dark)})}),50)},this.componentDidUpdate=()=>{var t,s;let i;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];i=!(null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[a])}else i=!0;this.setState({mapWidgetExists:!i,isNoMapSelected:i})},this.onMapWidgetSelected=e=>{let t;this.resetAnalysisLayersConfig(e),e.length>0?(t=!1,this.checkLayersAvailability(e)):t=!0,this.updateConfigForMapWidget(t)},this.resetAnalysisLayersConfig=t=>{const s=this.props.config.set("configInfo",{});s.set("useMapWidget",t.length>0);const i={id:this.props.id,useMapWidgetIds:t.length>0?t:null,config:s};0===t.length?(i.useDataSources=(0,e.Immutable)([]),this.props.onSettingChange(i,[])):this.props.onSettingChange(i)},this.updateConfigForMapWidget=e=>{this.setState({mapWidgetExists:!e,isNoMapSelected:e})},this.setDefaultConfigForDataSource=t=>{if(!this.props.config.configInfo.hasOwnProperty(t)){const s=z;s.searchSettings.headingLabel=this.nls("locationLabel"),this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",t],s)});let i=[];i=Object.assign(i,this.props.useDataSources),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:(0,e.Immutable)(i)})}),100)}},this.waitForChildDataSourcesReady=t=>Ze(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const s=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==s?void 0:s.isDataSourceSet)&&!s.areChildDataSourcesCreated()?s.childDataSourcesReady().then((()=>s)).catch((e=>s)):Promise.resolve(s)})),this.checkLayersAvailability=t=>Ze(this,void 0,void 0,(function*(){const s=this.mvManager.getJimuMapViewGroup(t);if(null==s?void 0:s.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);const i=[];for(const l in s.jimuMapViews)if(s.jimuMapViews[l].dataSourceId)if(s.jimuMapViews[l].status===e.JimuMapViewStatus.Loaded){const e=[],t=s.jimuMapViews[l].dataSourceId;this.setDefaultConfigForDataSource(t);const o=a.MapViewManager.getInstance().getJimuMapViewById(s.jimuMapViews[l].id);yield this.waitForChildDataSourcesReady(o).finally((()=>Ze(this,void 0,void 0,(function*(){yield v(s.jimuMapViews[l].id).then((t=>{this.setState({isLayerAvailable:!0,jimuMapViewId:s.jimuMapViews[l].id}),(s.jimuMapViews[l].isActive||void 0===s.jimuMapViews[l].isActive)&&this.setState({activeDataSource:t.length>0?s.jimuMapViews[l].dataSourceId:""}),t.forEach((t=>{e.push({layerDsId:t.id})}));this.canAddDataSource(s.jimuMapViews[l].dataSourceId,i)&&i.push({label:this.getDataSourceLabel(s.jimuMapViews[l].dataSourceId),value:s.jimuMapViews[l].dataSourceId,isValid:t.length>0,availableLayers:e})}))}))))}else this._mapLoadedTimer=setTimeout((()=>{this.checkLayersAvailability(t)}),50);else this.setState({isLayerAvailable:!1});this.setState({dataSources:i},(()=>{this.updateConfigAsPerNewWebMap()}))}else this._mapLoadedTimer=setTimeout((()=>{this.checkLayersAvailability(t)}),50)})),this.canAddDataSource=(e,t)=>{let s=!0;return t.some((t=>{t.value===e&&(s=!1)})),s},this.getDataSourceLabel=e=>{if(!e)return"";return S(e).getLabel()||e},this.updateConfigAsPerNewWebMap=()=>Ze(this,void 0,void 0,(function*(){var t;let s=[];if((null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t.length)>0){const t=this.mvManager.getJimuMapViewGroup(this.props.useMapWidgetIds[0]),i=this.props.config.configInfo.asMutable({deep:!0});if(null==t?void 0:t.jimuMapViews){for(const e in t.jimuMapViews)t.jimuMapViews[e].dataSourceId?s.push(t.jimuMapViews[e].dataSourceId):s=[];for(const e in i)s.includes(e)||delete i[e];for(const s in t.jimuMapViews){const a=t.jimuMapViews[s].dataSourceId;i[a]&&t.jimuMapViews[s].status===e.JimuMapViewStatus.Loaded&&(yield v(t.jimuMapViews[s].id).then((e=>{var t,s;const l=[];e.forEach((e=>{l.push(e.id)})),null===(s=null===(t=this.props.config.configInfo[a].analysisSettings)||void 0===t?void 0:t.layersInfo)||void 0===s||s.forEach((e=>{if(!l.includes(e.useDataSource.dataSourceId)){const t=i[a].analysisSettings.layersInfo,s=t.findIndex((t=>t.useDataSource.dataSourceId===e.useDataSource.dataSourceId));s>-1&&t.splice(s,1)}}))})))}setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",(0,e.Immutable)(i))})}),100),setTimeout((()=>{this.saveUseDataSourcesProps(i)}),200)}}})),this.showDsPanel=e=>{this.setState({activeDataSource:e,isAnalysisSettingsOpen:!1},(()=>{this.setState({isAnalysisSettingsOpen:!0})})),this.setDefaultConfigForDataSource(e)},this.isDataSourceValid=t=>{var s;return 0===this.state.dataSources.length?{isValid:!1,invalidMessage:this.nls("warningMsgIfNoLayersOnMap")}:(null===(s=e.DataSourceManager.getInstance().getDataSource(t))||void 0===s?void 0:s.getChildDataSources().length)>0?{isValid:!0}:{isValid:!1,invalidMessage:this.nls("warningMsgIfNoLayersOnMap")}},this.onCloseDataItemPanel=()=>{this.setState({showDataItemPanel:!1}),this.index=0},this.onToggleGeneralSettings=()=>{this.setState({isGeneralSettingsOpen:!this.state.isGeneralSettingsOpen})},this.updateGeneralSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings",e],t)})},this.updateSearchSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"searchSettings",e],t)})},this.updateAnalysisSettings=(e,t)=>{const s=this.props.config.setIn(["configInfo",this.state.activeDataSource,"analysisSettings",e],t),i=this.getInitOutDataSource(s.configInfo);this.props.onSettingChange({id:this.props.id,config:s},i)},this.saveUseDataSourcesProps=e=>{const t=this.getInitOutDataSource(e||this.props.config.configInfo);setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:L(e||this.props.config.configInfo)},t)}),200)},this.getInitOutDataSource=t=>{var s,i;if(!this.props.useMapWidgetIds||0===this.props.useMapWidgetIds.length)return[];try{const a=[];for(const l in t)null===(i=null===(s=null==t?void 0:t[l])||void 0===s?void 0:s.analysisSettings.layersInfo)||void 0===i||i.forEach(((t,s)=>{var i,l,o,n;const r=t.label+" ("+this.nls(t.analysisInfo.analysisType)+")",p=e.DataSourceManager.getInstance(),h=null==p?void 0:p.getDataSource(t.useDataSource.dataSourceId),u=null!==(i=t.analysisInfo.analysisId)&&void 0!==i?i:s.toString();let c,m;if(t.analysisInfo.analysisType===d.Summary)c=this.getInitSchema(r,t.analysisInfo.summaryFields);else{c=h.getSchema();let e=[];e=(null===(o=null===(l=t.analysisInfo)||void 0===l?void 0:l.fieldsToExport)||void 0===o?void 0:o.length)>0?t.analysisInfo.fieldsToExport:I(t.useDataSource.dataSourceId),m=Object.keys(null==c?void 0:c.fields).filter((t=>e.includes(t))).reduce(((e,t)=>(e[t]=null==c?void 0:c.fields[t],e)),{})}const y={id:C(this.props.widgetId,t.analysisInfo.analysisType,u),type:e.DataSourceTypes.FeatureLayer,label:r,isOutputFromWidget:!0,schema:{idField:c.idField,fields:m||c.fields},geometryType:h.getGeometryType()};t.analysisInfo.analysisType!==d.Summary&&(null===(n=null==t?void 0:t.analysisInfo)||void 0===n?void 0:n.includeApproxDistance)&&(y.schema.fields.esriCTApproxDistance={alias:this.nls("showDistFromInputLoc"),esriType:e.EsriFieldType.String,format:null,type:e.JimuFieldType.String,jimuName:"esriCTApproxDistance",name:"esriCTApproxDistance"}),a.push(y)}));return a}catch(e){return console.warn("Failed to create output data source in near me widget. ",e),[]}},this.getInitSchema=(t="",s)=>{const i={},a=[{alias:"OBJECTID",type:e.JimuFieldType.Number,jimuName:"OBJECTID",name:"OBJECTID"},{alias:this.nls("count"),type:e.JimuFieldType.Number,jimuName:"esriCTCOUNT",name:"esriCTCOUNT"}];return s.forEach((t=>{const s=t.fieldLabel.replace(/ /g,"");a.push({alias:t.fieldLabel,type:e.JimuFieldType.String,jimuName:s,name:s})})),null==a||a.forEach(((e,t)=>{0===t?i.OBJECTID=e:"esriCTCOUNT"===(null==e?void 0:e.name)?i.esriCTCOUNT=e:i[null==e?void 0:e.jimuName]=e})),{label:t,idField:"OBJECTID",fields:i}},this.index=0,this.state={dataSources:[],showDataItemPanel:!1,dataSourceName:"",isNoMapSelected:!0,mapWidgetExists:!0,isAnalysisSettingsOpen:!1,isGeneralSettingsOpen:!0,isOutputSettingsOpen:!0,isLayerAvailable:!1,activeDataSource:null,popperFocusNode:null,jimuMapViewId:""}}render(){var s,a,l,o,n;const r=null===(l=null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[null===(a=this.props.useMapWidgetIds)||void 0===a?void 0:a[0]])||void 0===l?void 0:l.useDataSources,d=null===(o=this.props.config.configInfo)||void 0===o?void 0:o[this.state.activeDataSource];return(0,e.jsx)("div",{css:(p=this.props.theme,e.css`
    .widget-setting-near-me {
      height: 100%;

      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .nearme-analysis-tooltip {
        margin-bottom: 0rem!important;
        width: 177px;
      }

      .placeholder-container {
        height: calc(100% - 180px);

        .placeholder {
          flex-direction: column;

          .icon {
            color: var(--ref-palette-neutral-800);
          }

          .hint {
            font-size: ${e.polished.rem(14)};
            font-weight: 500;
            color: var(--ref-palette-neutral-1000);
            max-width: ${e.polished.rem(160)};
          }
        }
      }

      .color-label {
        color: ${p.ref.palette.neutral[900]};
      }

      .jimu-tree {
        width: 100%;
      }

      .data-item {
        display: flex;
        flex: 1;
        padding: 0.5rem 0.6rem;
        line-height: 23px;
        cursor: pointer;

        .data-item-name {
          word-break: break-word;
        }
      }
    }
  `),className:"h-100"},(0,e.jsx)("div",{className:"widget-setting-near-me"},(0,e.jsx)(t.SettingSection,{className:(0,e.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected&&!(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0)})},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"text-truncate setting-text-level-0",title:this.nls("selectMapWidgetLabel")},this.nls("selectMapWidgetLabel"))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(t.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&(!this.state.isLayerAvailable||!((null==r?void 0:r.length)>0))&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Alert,{tabIndex:0,onClose:function(){},open:!(this.state.isLayerAvailable&&(null==r?void 0:r.length)>0),text:this.nls("warningMsgIfNoLayersOnMap"),type:"warning"}))),this.state.isNoMapSelected&&!(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0)&&(0,e.jsx)("div",{className:"d-flex placeholder-container justify-content-center align-items-center"},(0,e.jsx)("div",{className:"d-flex text-center placeholder justify-content-center align-items-center "},(0,e.jsx)(c,{size:48,className:"d-flex icon mb-2"}),(0,e.jsx)("p",{className:"hint"},this.nls("selectMapHint")))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&this.state.isLayerAvailable&&(null==r?void 0:r.length)>0&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("analysisSettingsLabel"),title:this.nls("analysisSettingsLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label title2 text-paper"},this.nls("analysisSettingsLabel")))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break title3 hint-default"},this.nls("mapSettingsHintMsg")))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"w-100"},this.state.dataSources.length>0&&(0,e.jsx)(t.MultipleJimuMapConfig,{mapWidgetId:null===(n=this.props.useMapWidgetIds)||void 0===n?void 0:n[0],onClick:this.showDsPanel,isDataSourceValid:this.isDataSourceValid,sidePopperContent:this.state.isAnalysisSettingsOpen&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("defineSearchAreaLabel"),title:this.nls("defineSearchAreaLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title2 text-paper"},this.nls("defineSearchAreaLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("defineSearchAreaLabel")+" "+this.nls("defineSearchAreaTooltip"),title:this.nls("defineSearchAreaTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(T,null)))),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(oe,{intl:this.props.intl,theme:this.props.theme2,config:null==d?void 0:d.searchSettings,onSearchSettingsUpdated:this.updateSearchSettings})),(0,e.jsx)(t.SettingRow,{className:"border-top pt-3"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("analysisLabel"),title:this.nls("analysisLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 title2 text-paper"},this.nls("analysisLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("analysisLabel")+" "+this.nls("configureAnalysisTooltip"),title:this.nls("configureAnalysisTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"title3 text-default d-inline"},(0,e.jsx)(T,null)))),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(qe,{widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,selectedDs:this.state.activeDataSource,activeDsSearchConfig:null==d?void 0:d.searchSettings,activeDsLayersConfig:null==d?void 0:d.analysisSettings,allFeatureLayers:this.state.dataSources,useDataSourceConfig:this.props.useDataSources,onAnalysisSettingsUpdated:this.updateAnalysisSettings,getAddedLayersInfoUseDs:this.saveUseDataSourcesProps}))))})))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(i.CollapsablePanel,{label:this.nls("generalSettingsLabel"),"aria-label":this.nls("generalSettingsLabel"),isOpen:this.state.isGeneralSettingsOpen,onRequestOpen:()=>{this.onToggleGeneralSettings()},onRequestClose:()=>{this.onToggleGeneralSettings()}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(B,{intl:this.props.intl,theme:this.props.theme2,config:this.props.config.generalSettings,onGeneralSettingsUpdated:this.updateGeneralSettings})))))));var p}}function Qe(e){m.p=e}})(),y})())}}}));